define(function(){if("undefined"==typeof a)var a;var b=function(){"undefined"==typeof DOMParser||a?(a=!0,DOMParser=function(){},DOMParser.prototype.parseFromString=function(a,b){if("undefined"!=typeof ActiveXObject){var c=new ActiveXObject("MSXML.DomDocument");return c.async=!1,c.loadXML(a),c}if("undefined"!=typeof XMLHttpRequest){var c=new XMLHttpRequest;return b||(b="text/xml"),c.open("GET","data:"+b+";charset=utf-8,"+encodeURIComponent(a),!1),c.overrideMimeType&&c.overrideMimeType(b),c.send(null),c.responseXML}},this.hasAttributes=function(a){var b;return b=a.attributes&&a.attributes.length?!0:!1}):this.hasAttributes=function(a){var b;return b=a.attributes&&a.attributes.length?!0:!1},this.importNode=function(a,b){if("undefined"==typeof a.importNode)var c=this._importNode(a,b,!0);else var c=a.importNode(b,!0);return c},this._importNode=function(a,b,c){switch(b.nodeType){case 1:var d=a.createElement(b.nodeName);if(b.attributes&&b.attributes.length>0)for(var e=0,f=b.attributes.length;f>e;)d.setAttribute(b.attributes[e].nodeName,b.getAttribute(b.attributes[e++].nodeName));if(c&&b.childNodes&&b.childNodes.length>0)for(var e=0,f=b.childNodes.length;f>e;)d.appendChild(this._importNode(a,b.childNodes[e++],c));return d;case 3:case 4:case 8:}},this.parser=new DOMParser;var b='<docco><institution institution-parts="long" delimiter=", " substitute-use-first="1" use-last="1"><institution-part name="long"/></institution></docco>',c=this.parser.parseFromString(b,"text/xml"),d=c.getElementsByTagName("institution");this.institution=d.item(0);var e=c.getElementsByTagName("institution-part");this.institutionpart=e.item(0),this.ns="http://purl.org/net/xbiblio/csl"};b.prototype.clean=function(a){return a=a.replace(/<\?[^?]+\?>/g,""),a=a.replace(/<![^>]+>/g,""),a=a.replace(/^\s+/,""),a=a.replace(/\s+$/,""),a=a.replace(/^\n*/,"")},b.prototype.getStyleId=function(a){var b="",c=a.getElementsByTagName("id");return c&&c.length&&(c=c.item(0)),c&&(b=c.textContent),b||(b=c.innerText),b||(b=c.innerHTML),b},b.prototype.children=function(a){var b,c,d,e;if(a){for(e=[],b=a.childNodes,c=0,d=b.length;d>c;c+=1)"#text"!=b[c].nodeName&&e.push(b[c]);return e}return[]},b.prototype.nodename=function(a){var b=a.nodeName;return b},b.prototype.attributes=function(a){var b,c,d,e,f;if(b=new Object,a&&this.hasAttributes(a))for(c=a.attributes,e=0,f=c.length;f>e;e+=1)d=c[e],b["@"+d.name]=d.value;return b},b.prototype.content=function(a){var b;return b="undefined"!=typeof a.textContent?a.textContent:"undefined"!=typeof a.innerText?a.innerText:a.txt},b.prototype.namespace={xml:"http://www.w3.org/XML/1998/namespace"},b.prototype.numberofnodes=function(a){return a?a.length:0},b.prototype.getAttributeName=function(a){var b=a.name;return b},b.prototype.getAttributeValue=function(a,b,c){var d="";return c&&(b=c+":"+b),a&&this.hasAttributes(a)&&a.getAttribute(b)&&(d=a.getAttribute(b)),d},b.prototype.getNodeValue=function(a,b){var c="";if(b){var d=a.getElementsByTagName(b);d.length>0&&(c="undefined"!=typeof d[0].textContent?d[0].textContent:"undefined"!=typeof d[0].innerText?d[0].innerText:d[0].text)}else c=a;return c&&c.childNodes&&(0==c.childNodes.length||1==c.childNodes.length&&"#text"==c.firstChild.nodeName)&&(c="undefined"!=typeof c.textContent?c.textContent:"undefined"!=typeof c.innerText?c.innerText:c.text),c},b.prototype.setAttributeOnNodeIdentifiedByNameAttribute=function(a,b,c,d,e){var f,g,h,i;for("@"===d.slice(0,1)&&(d=d.slice(1)),h=a.getElementsByTagName(b),f=0,g=h.length;g>f;f+=1)i=h[f],i.getAttribute("name")==c&&i.setAttribute(d,e)},b.prototype.deleteNodeByNameAttribute=function(a,b){var c,d,e,f;for(f=a.childNodes,c=0,d=f.length;d>c;c+=1)e=f[c],e&&e.nodeType!=e.TEXT_NODE&&this.hasAttributes(e)&&e.getAttribute("name")==b&&a.removeChild(f[c])},b.prototype.deleteAttribute=function(a,b){a.removeAttribute(b)},b.prototype.setAttribute=function(a,b,c){return a.ownerDocument||(a=a.firstChild),["function","unknown"].indexOf(typeof a.setAttribute)>-1&&a.setAttribute(b,c),!1},b.prototype.nodeCopy=function(a){var b=a.cloneNode(!0);return b},b.prototype.getNodesByName=function(a,b,c){var d,e,f,g,h;for(d=[],e=a.getElementsByTagName(b),g=0,h=e.length;h>g;g+=1)f=e.item(g),(!c||this.hasAttributes(f)&&f.getAttribute("name")==c)&&d.push(f);return d},b.prototype.nodeNameIs=function(a,b){return b==a.nodeName?!0:!1},b.prototype.makeXml=function(a){a||(a="<docco><bogus/></docco>"),a=a.replace(/\s*<\?[^>]*\?>\s*\n*/g,"");var b=this.parser.parseFromString(a,"application/xml");return b.firstChild},b.prototype.insertChildNodeAfter=function(a,b,c,d){var e;return e=this.importNode(b.ownerDocument,d),a.replaceChild(e,b),a},b.prototype.insertPublisherAndPlace=function(a){for(var b=a.getElementsByTagName("group"),c=0,d=b.length;d>c;c+=1){for(var e=b.item(c),f=[],g=0,h=e.childNodes.length;h>g;g+=1)1!==e.childNodes.item(g).nodeType&&f.push(g);if(e.childNodes.length-f.length===2){for(var i=[],g=0,h=2;h>g;g+=1)if(!(f.indexOf(g)>-1)){for(var j=e.childNodes.item(g),k=[],l=0,m=j.childNodes.length;m>l;l+=1)1!==j.childNodes.item(l).nodeType&&k.push(l);if(j.childNodes.length-k.length===0&&(i.push(j.getAttribute("variable")),j.getAttribute("suffix")||j.getAttribute("prefix"))){i=[];break}}i.indexOf("publisher")>-1&&i.indexOf("publisher-place")>-1&&e.setAttribute("has-publisher-and-publisher-place",!0)}}},b.prototype.addMissingNameNodes=function(a){for(var b=a.getElementsByTagName("names"),c=0,d=b.length;d>c;c+=1){var e=b.item(c),f=e.getElementsByTagName("name");if((!f||0===f.length)&&"substitute"!==e.parentNode.tagName.toLowerCase()){var g=e.ownerDocument,h=g.createElement("name");e.appendChild(h)}}},b.prototype.addInstitutionNodes=function(a){var b,d,e,f,g,h,i,j;for(b=a.getElementsByTagName("names"),i=0,j=b.length;j>i;i+=1)if(d=b.item(i),g=d.getElementsByTagName("name"),0!=g.length&&(e=d.getElementsByTagName("institution"),0==e.length)){f=this.importNode(a.ownerDocument,this.institution),theinstitutionpart=f.getElementsByTagName("institution-part").item(0),h=g.item(0),d.insertBefore(f,h.nextSibling);for(var k=0,l=c.INSTITUTION_KEYS.length;l>k;k+=1){var m=c.INSTITUTION_KEYS[k],n=h.getAttribute(m);n&&theinstitutionpart.setAttribute(m,n)}for(var o=h.getElementsByTagName("name-part"),k=0,l=o.length;l>k;k+=1)if("family"===o[k].getAttribute("name"))for(var p=0,q=c.INSTITUTION_KEYS.length;q>p;p+=1){var m=c.INSTITUTION_KEYS[p],n=o[k].getAttribute(m);n&&theinstitutionpart.setAttribute(m,n)}}},b.prototype.flagDateMacros=function(a){var b,c,d,e;for(nodes=a.getElementsByTagName("macro"),b=0,c=nodes.length;c>b;b+=1)d=nodes.item(b),e=d.getElementsByTagName("date"),e.length&&d.setAttribute("macro-has-date","true")},Array.indexOf||(Array.prototype.indexOf=function(a){var b,c;for(b=0,c=this.length;c>b;b+=1)if(this[b]===a)return b;return-1});var c={PROCESSOR_VERSION:"1.0.539",CONDITION_LEVEL_TOP:1,CONDITION_LEVEL_BOTTOM:2,PLAIN_HYPHEN_REGEX:/(?:[^\\]-|\u2013)/,LOCATOR_LABELS_REGEXP:new RegExp("^((art|ch|Ch|subch|col|fig|l|n|no|op|p|pp|para|subpara|pt|r|sec|subsec|Sec|sv|sch|tit|vrs|vol)\\.)\\s+(.*)"),STATUTE_SUBDIV_GROUPED_REGEX:/((?:^| )(?:art|ch|Ch|subch|p|pp|para|subpara|pt|r|sec|subsec|Sec|sch|tit)\.)/g,STATUTE_SUBDIV_PLAIN_REGEX:/(?:(?:^| )(?:art|ch|Ch|subch|p|pp|para|subpara|pt|r|sec|subsec|Sec|sch|tit)\.)/,STATUTE_SUBDIV_STRINGS:{"art.":"article","bk.":"book","ch.":"chapter","Ch.":"Chapter","subch.":"subchapter","p.":"page","pp.":"page","para.":"paragraph","subpara.":"subparagraph","pt.":"part","r.":"rule","sec.":"section","subsec.":"subsection","Sec.":"Section","sch.":"schedule","tit.":"title","col.":"column","fig.":"figure","fol.":"folio","l.":"line","n.":"note","no.":"issue","op.":"opus","sv.":"sub-verbo","vrs.":"verse","vol.":"volume"},STATUTE_SUBDIV_STRINGS_REVERSE:{article:"art.",book:"bk.",chapter:"ch.",Chapter:"Ch.",subchapter:"subch.",page:"p.",paragraph:"para.",subparagraph:"subpara.",part:"pt.",rule:"r.",section:"sec.",subsection:"subsec.",Section:"Sec.",schedule:"sch.",title:"tit.",column:"col.",figure:"fig.",folio:"fol.",line:"l.",note:"n.",issue:"no.",opus:"op.","sub-verbo":"sv.","sub verbo":"sv.",verse:"vrs.",volume:"vol."},LOCATOR_LABELS_MAP:{art:"article",bk:"book",ch:"chapter",Ch:"Chapter",subch:"subchapter",col:"column",fig:"figure",fol:"folio",l:"line",n:"note",no:"issue",op:"opus",p:"page",pp:"page",para:"paragraph",subpara:"subparagraph",pt:"part",r:"rule",sec:"section",subsec:"subsection",Sec:"Section",sv:"sub-verbo",sch:"schedule",tit:"title",vrs:"verse",vol:"volume"},NestedBraces:[["(","["],[")","]"]],checkNestedBraceOpen:new RegExp(".*\\("),checkNestedBraceClose:new RegExp(".*\\)"),LangPrefsMap:{title:"titles","title-short":"titles","container-title":"journals","collection-title":"journals",publisher:"publishers",authority:"publishers","publisher-place":"places","event-place":"places",number:"number",edition:"number",issue:"number",volume:"number"},AbbreviationSegments:function(){this["container-title"]={},this["collection-title"]={},this["institution-entire"]={},this["institution-part"]={},this.nickname={},this.number={},this.title={},this.place={},this.hereinafter={},this.classic={},this["container-phrase"]={},this["title-phrase"]={}},GENDERS:["masculine","feminine"],ERROR_NO_RENDERED_FORM:1,PREVIEW:"Just for laughs.",ASSUME_ALL_ITEMS_REGISTERED:2,START:0,END:1,SINGLETON:2,SEEN:6,SUCCESSOR:3,SUCCESSOR_OF_SUCCESSOR:4,SUPPRESS:5,SINGULAR:0,PLURAL:1,LITERAL:!0,BEFORE:1,AFTER:2,DESCENDING:1,ASCENDING:2,ONLY_FIRST:1,ALWAYS:2,ONLY_LAST:3,FINISH:1,POSITION_FIRST:0,POSITION_SUBSEQUENT:1,POSITION_IBID:2,POSITION_IBID_WITH_LOCATOR:3,MARK_TRAILING_NAMES:!0,POSITION_TEST_VARS:["position","first-reference-note-number","near-note"],AREAS:["citation","citation_sort","bibliography","bibliography_sort"],MULTI_FIELDS:["event","publisher","publisher-place","event-place","title","container-title","collection-title","authority","edition","genre","title-short","medium","jurisdiction","archive","archive-place"],CITE_FIELDS:["first-reference-note-number","locator","locator-revision"],MINIMAL_NAME_FIELDS:["literal","family"],SWAPPING_PUNCTUATION:[".","!","?",":",","],TERMINAL_PUNCTUATION:[":",".",";","!","?"," "],NONE:0,NUMERIC:1,POSITION:2,COLLAPSE_VALUES:["citation-number","year","year-suffix"],DATE_PARTS:["year","month","day"],DATE_PARTS_ALL:["year","month","day","season"],DATE_PARTS_INTERNAL:["year","month","day","year_end","month_end","day_end"],NAME_PARTS:["family","given","dropping-particle","non-dropping-particle","suffix","literal"],DECORABLE_NAME_PARTS:["given","family","suffix"],DISAMBIGUATE_OPTIONS:["disambiguate-add-names","disambiguate-add-givenname","disambiguate-add-year-suffix"],GIVENNAME_DISAMBIGUATION_RULES:["all-names","all-names-with-initials","primary-name","primary-name-with-initials","by-cite"],NAME_ATTRIBUTES:["and","delimiter-precedes-last","delimiter-precedes-et-al","initialize-with","initialize","name-as-sort-order","sort-separator","et-al-min","et-al-use-first","et-al-subsequent-min","et-al-subsequent-use-first","form","prefix","suffix","delimiter"],PARALLEL_MATCH_VARS:["container-title"],PARALLEL_TYPES:["bill","gazette","regulation","legislation","legal_case","treaty","article-magazine","article-journal"],PARALLEL_COLLAPSING_MID_VARSET:["volume","issue","container-title","section","collection-number"],LOOSE:0,STRICT:1,TOLERANT:2,PREFIX_PUNCTUATION:/[.;:]\s*$/,SUFFIX_PUNCTUATION:/^\s*[.;:,\(\)]/,NUMBER_REGEXP:/(?:^\d+|\d+$)/,NAME_INITIAL_REGEXP:/^([A-Z\u0590-\u05ff\u0080-\u017f\u0400-\u042f\u0600-\u06ff\u0370\u0372\u0376\u0386\u0388-\u03ab\u03e2\u03e4\u03e6\u03e8\u03ea\u03ec\u03ee\u03f4\u03f7\u03fd-\u03ff])([a-zA-Z\u0080-\u017f\u0400-\u052f\u0600-\u06ff\u0370-\u03ff\u1f00-\u1fff]*|)/,ROMANESQUE_REGEXP:/[-0-9a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ROMANESQUE_NOT_REGEXP:/[^a-zA-Z\u0590-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/g,STARTSWITH_ROMANESQUE_REGEXP:/^[&a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ENDSWITH_ROMANESQUE_REGEXP:/[.;:&a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]$/,ALL_ROMANESQUE_REGEXP:/^[a-zA-Z\u0590-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]+$/,VIETNAMESE_SPECIALS:/[\u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]/,VIETNAMESE_NAMES:/^(?:(?:[.AaBbCcDdEeGgHhIiKkLlMmNnOoPpQqRrSsTtUuVvXxYy \u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]{2,6})(\s+|$))+$/,NOTE_FIELDS_REGEXP:/\{:(?:[\-_a-z]+|[A-Z]+):[^\}]+\}/g,NOTE_FIELD_REGEXP:/\{:([\-_a-z]+|[A-Z]+):\s*([^\}]+)\}/,DISPLAY_CLASSES:["block","left-margin","right-inline","indent"],NAME_VARIABLES:["author","editor","translator","contributor","collection-editor","composer","container-author","director","editorial-director","interviewer","original-author","recipient"],NUMERIC_VARIABLES:["call-number","chapter-number","collection-number","edition","page","issue","locator","number","number-of-pages","number-of-volumes","volume","citation-number"],DATE_VARIABLES:["locator-date","issued","event-date","accessed","container","original-date","publication-date","original-date","available-date","submitted"],TAG_ESCAPE:function(a){var b,c,d,e,f;for(b=a.match(/((?:\"|\')|(?:(?:<span\s+class=\"no(?:case|decor)\">).*?(?:<\/span>|<\/?(?:i|sc|b)>)))/g),c=a.split(/(?:(?:\"|\')|(?:(?:<span\s+class=\"no(?:case|decor)\">).*?(?:<\/span>|<\/?(?:i|sc|b)>)))/g),f=[c[0]],e=1,d=c.length;d>e;e+=1)f.push(b[e-1]),f.push(c[e]);return c=f.slice()},TAG_USEALL:function(a){var b,c,d,e;for(b=[""],c=a.indexOf("<"),d=a.indexOf(">");c>-1&&d>-1;)e=c>d?c+1:d+1,d>c&&-1===a.slice(c+1,d).indexOf("<")?(b[b.length-1]+=a.slice(0,c),b.push(a.slice(c,d+1)),b.push(""),a=a.slice(e)):(b[b.length-1]+=a.slice(0,d+1),a=a.slice(e)),c=a.indexOf("<"),d=a.indexOf(">");return b[b.length-1]+=a,b},SKIP_WORDS:["about","above","across","afore","after","against","along","alongside","amid","amidst","among","amongst","anenst","apropos","apud","around","as","aside","astride","at","athwart","atop","barring","before","behind","below","beneath","beside","besides","between","beyond","but","by","circa","despite","down","during","except","for","forenenst","from","given","in","inside","into","lest","like","modulo","near","next","notwithstanding","of","off","on","onto","out","over","per","plus","pro","qua","sans","since","than","through"," thru","throughout","thruout","till","to","toward","towards","under","underneath","until","unto","up","upon","versus","vs.","v.","vs","v","via","vis-à-vis","with","within","without","according to","ahead of","apart from","as for","as of","as per","as regards","aside from","back to","because of","close to","due to","except for","far from","inside of","instead of","near to","next to","on to","out from","out of","outside of","prior to","pursuant to","rather than","regardless of","such as","that of","up to","where as","or","yet","so","for","and","nor","a","an","the","de","d'","von","van","c","et","ca"],FORMAT_KEY_SEQUENCE:["@strip-periods","@font-style","@font-variant","@font-weight","@text-decoration","@vertical-align","@quotes"],INSTITUTION_KEYS:["font-style","font-variant","font-weight","text-decoration","text-case"],SUFFIX_CHARS:"a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z",ROMAN_NUMERALS:[["","i","ii","iii","iv","v","vi","vii","viii","ix"],["","x","xx","xxx","xl","l","lx","lxx","lxxx","xc"],["","c","cc","ccc","cd","d","dc","dcc","dccc","cm"],["","m","mm","mmm","mmmm","mmmmm"]],CREATORS:["author","editor","contributor","translator","recipient","interviewer","composer","original-author","container-author","collection-editor"],LANGS:{"af-ZA":"Afrikaans","ar-AR":"Arabic","bg-BG":"Bulgarian","ca-AD":"Catalan","cs-CZ":"Czech","da-DK":"Danish","de-AT":"Austrian","de-CH":"German (CH)","de-DE":"German (DE)","el-GR":"Greek","en-GB":"English (GB)","en-US":"English (US)","es-ES":"Spanish","et-EE":"Estonian",eu:"European","fa-IR":"Persian","fi-FI":"Finnish","fr-CA":"French (CA)","fr-FR":"French (FR)","he-IL":"Hebrew","hr-HR":"Croatian","hu-HU":"Hungarian","is-IS":"Icelandic","it-IT":"Italian","ja-JP":"Japanese","km-KH":"Khmer","ko-KR":"Korean","lt-LT":"Lithuanian","lv-LV":"Latvian","mn-MN":"Mongolian","nb-NO":"Norwegian (Bokmål)","nl-NL":"Dutch","nn-NO":"Norwegian (Nynorsk)","pl-PL":"Polish","pt-BR":"Portuguese (BR)","pt-PT":"Portuguese (PT)","ro-RO":"Romanian","ru-RU":"Russian","sk-SK":"Slovak","sl-SI":"Slovenian","sr-RS":"Serbian","sv-SE":"Swedish","th-TH":"Thai","tr-TR":"Turkish","uk-UA":"Ukranian","vi-VN":"Vietnamese","zh-CN":"Chinese (CN)","zh-TW":"Chinese (TW)"},LANG_BASES:{af:"af_ZA",ar:"ar_AR",bg:"bg_BG",ca:"ca_AD",cs:"cs_CZ",da:"da_DK",de:"de_DE",el:"el_GR",en:"en_US",es:"es_ES",et:"et_EE",eu:"eu",fa:"fa_IR",fi:"fi_FI",fr:"fr_FR",he:"he_IL",hu:"hu_HU",is:"is_IS",it:"it_IT",ja:"ja_JP",km:"km_KH",ko:"ko_KR",lt:"lt_LT",mn:"mn_MN",nb:"nb_NO",nl:"nl_NL",nn:"nn-NO",pl:"pl_PL",pt:"pt_PT",ro:"ro_RO",ru:"ru_RU",sk:"sk_SK",sl:"sl_SI",sr:"sr_RS",sv:"sv_SE",th:"th_TH",tr:"tr_TR",uk:"uk_UA",vi:"vi_VN",zh:"zh_CN"},SUPERSCRIPTS:{"ª":"a","²":"2","³":"3","¹":"1","º":"o","ʰ":"h","ʱ":"ɦ","ʲ":"j","ʳ":"r","ʴ":"ɹ","ʵ":"ɻ","ʶ":"ʁ","ʷ":"w","ʸ":"y","ˠ":"ɣ","ˡ":"l","ˢ":"s","ˣ":"x","ˤ":"ʕ","ᴬ":"A","ᴭ":"Æ","ᴮ":"B","ᴰ":"D","ᴱ":"E","ᴲ":"Ǝ","ᴳ":"G","ᴴ":"H","ᴵ":"I","ᴶ":"J","ᴷ":"K","ᴸ":"L","ᴹ":"M","ᴺ":"N","ᴼ":"O","ᴽ":"Ȣ","ᴾ":"P","ᴿ":"R","ᵀ":"T","ᵁ":"U","ᵂ":"W","ᵃ":"a","ᵄ":"ɐ","ᵅ":"ɑ","ᵆ":"ᴂ","ᵇ":"b","ᵈ":"d","ᵉ":"e","ᵊ":"ə","ᵋ":"ɛ","ᵌ":"ɜ","ᵍ":"g","ᵏ":"k","ᵐ":"m","ᵑ":"ŋ","ᵒ":"o","ᵓ":"ɔ","ᵔ":"ᴖ","ᵕ":"ᴗ","ᵖ":"p","ᵗ":"t","ᵘ":"u","ᵙ":"ᴝ","ᵚ":"ɯ","ᵛ":"v","ᵜ":"ᴥ","ᵝ":"β","ᵞ":"γ","ᵟ":"δ","ᵠ":"φ","ᵡ":"χ","⁰":"0","ⁱ":"i","⁴":"4","⁵":"5","⁶":"6","⁷":"7","⁸":"8","⁹":"9","⁺":"+","⁻":"−","⁼":"=","⁽":"(","⁾":")","ⁿ":"n","℠":"SM","™":"TM","㆒":"一","㆓":"二","㆔":"三","㆕":"四","㆖":"上","㆗":"中","㆘":"下","㆙":"甲","㆚":"乙","㆛":"丙","㆜":"丁","㆝":"天","㆞":"地","㆟":"人","ˀ":"ʔ","ˁ":"ʕ","ۥ":"و","ۦ":"ي"},SUPERSCRIPTS_REGEXP:new RegExp("[ª²³¹ºʰʱʲʳʴʵʶʷʸˠˡˢˣˤᴬᴭᴮᴰᴱᴲᴳᴴᴵᴶᴷᴸᴹᴺᴼᴽᴾᴿᵀᵁᵂᵃᵄᵅᵆᵇᵈᵉᵊᵋᵌᵍᵏᵐᵑᵒᵓᵔᵕᵖᵗᵘᵙᵚᵛᵜᵝᵞᵟᵠᵡ⁰ⁱ⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿ℠™㆒㆓㆔㆕㆖㆗㆘㆙㆚㆛㆜㆝㆞㆟ˀˁۥۦ]","g"),locale:{},locale_opts:{},locale_dates:{}};if("undefined"!=typeof require&&"undefined"!=typeof module&&"exports"in module){var d=!0,e=require("./csl_nodejs_jsdom").CSL_NODEJS_JSDOM;exports.CSL=c}c.TERMINAL_PUNCTUATION_REGEXP=new RegExp("^(["+c.TERMINAL_PUNCTUATION.slice(0,-1).join("")+"])(.*)"),c.CLOSURES=new RegExp(".*[\\]\\)]"),"object"==typeof console&&"function"==typeof console.log?(c.debug=function(a){console.log("CSL: "+a)},c.error=function(a){console.log("CSL error: "+a)}):(c.debug=function(){},c.error=function(a){throw"CSL error: "+a});var f;f="undefined"!=typeof d?e:"undefined"!=typeof CSL_E4X?CSL_E4X:"undefined"!=typeof CSL_JSON?CSL_JSON:b,c.System={},c.System.Xml={Parsing:f},c.getSortCompare=function(a){if(c.stringCompare)return c.stringCompare;var b,d={sensitivity:"base",ignorePunctuation:!0,numeric:!0};a||(a="en-US"),b=function(b,c){return b.toLocaleLowerCase().localeCompare(c.toLocaleLowerCase(),a,d)};var e=function(a){return a.replace(/^[\[\]\'\"]*/g,"")},f=function(){return b("[x","x")?function(a,c){return b(e(a),e(c))}:!1},g=f(),h=function(a,c){return g?g(a,c):b(a,c)};return h},c.ambigConfigDiff=function(a,b){var c,d,e,f;if(a.names.length!==b.names.length)return 1;for(c=0,d=a.names.length;d>c;c+=1){if(a.names[c]!==b.names[c])return 1;for(e=0,f=a.givens[c];f>e;e+=1)if(a.givens[c][e]!==b.givens[c][e])return 1}return a.disambiguate!=b.disambiguate?1:a.year_suffix!==b.year_suffix?1:0},c.cloneAmbigConfig=function(a,b,c){var d,e,f,g,h,i={};for(i.names=[],i.givens=[],i.year_suffix=!1,i.disambiguate=!1,d=0,e=a.names.length;e>d;d+=1)h=a.names[d],i.names[d]=h;for(d=0,e=a.givens.length;e>d;d+=1){for(h=[],f=0,g=a.givens[d].length;g>f;f+=1)h.push(a.givens[d][f]);i.givens.push(h)}return b?(i.year_suffix=b.year_suffix,i.disambiguate=b.disambiguate):(i.year_suffix=a.year_suffix,i.disambiguate=a.disambiguate),i},c.getAmbigConfig=function(){var a,b;return a=this.tmp.disambig_request,a||(a=this.tmp.disambig_settings),b=c.cloneAmbigConfig(a)},c.getMaxVals=function(){return this.tmp.names_max.mystack.slice()},c.getMinVal=function(){return this.tmp["et-al-min"]},c.tokenExec=function(a,b,c){var d,e,f,g,h,i;i=!1,d=a.next,e=!1;var j=function(b){return b?(this.tmp.jump.replace("succeed"),a.succeed):(this.tmp.jump.replace("fail"),a.fail)};for(a.test&&(d=j.call(this,a.test(b,c))),h=a.execs.length,g=0;h>g;g+=1)f=a.execs[g],e=f.call(a,this,b,c),e&&(d=e);return d},c.expandMacro=function(a){var b,d,e,f;if(b=a.postponed_macro,this.build.macro_stack.indexOf(b)>-1)throw'CSL processor error: call to macro "'+b+'" would cause an infinite loop';this.build.macro_stack.push(b);var g=!1,h=!1;if(d=this.sys.xml.getNodesByName(this.cslXml,"macro",b),d.length&&(h=this.sys.xml.getAttributeValue(d[0],"cslid"),g=this.sys.xml.getAttributeValue(d[0],"macro-has-date")),g&&(f=function(a,b){a.tmp.extension&&(a.tmp["doing-macro-with-date"]=!0)},a.execs.push(f)),a.tokentype=c.START,a.cslid=h,c.Node.group.build.call(a,this,this[this.build.area].tokens,!0),!this.sys.xml.getNodeValue(d))throw'CSL style error: undefined macro "'+b+'"';var i=c.makeBuilder(this);i(d[0]),e=new c.Token("group",c.END),a.decorations&&(e.decorations=a.decorations.slice()),g&&(f=function(a,b){a.tmp.extension&&(a.tmp["doing-macro-with-date"]=!1)},e.execs.push(f)),c.Node.group.build.call(e,this,this[this.build.area].tokens,!0),this.build.macro_stack.pop()},c.XmlToToken=function(a,b){var d,e,f,g,h,i,j,k;if(d=a.sys.xml.nodename(this),!a.build.skip||a.build.skip===d){if(!d)return e=a.sys.xml.content(this),void(e&&(a.build.text=e));if(!c.Node[a.sys.xml.nodename(this)])throw'Undefined node name "'+d+'".';if(f=[],g=a.sys.xml.attributes(this),h=c.setDecorations.call(this,a,g),i=new c.Token(d,b),b!==c.END||"if"===d||"else-if"===d||"layout"===d){for(j in g)if(g.hasOwnProperty(j)){if(b===c.END&&"@language"!==j&&"@locale"!==j)continue;if(g.hasOwnProperty(j))if(c.Attributes[j])try{c.Attributes[j].call(i,a,""+g[j])}catch(l){throw c.error(l),"CSL processor error, "+j+" attribute: "+l}else c.debug('warning: undefined attribute "'+j+'" in style')}i.decorations=h}else b===c.END&&g["@variable"]&&(i.hasVariable=!0);k=a[a.build.area].tokens,c.Node[d].build.call(i,a,k)}},c.DateParser=function(){var a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;for(a=[["明治",1867],["大正",1911],["昭和",1925],["平成",1988]],b={},x=a.length,h=0;x>h;h+=1)i=a[h][0],j=a[h][1],b[i]=j;for(y=[],h=0;x>h;h+=1)j=a[h][0],y.push(j);for(y=y.join("|"),d="(?:"+y+")(?:[0-9]+)",d=new RegExp(d),z="(?:"+y+")(?:[0-9]+)",z=new RegExp(z,"g"),f=/(\u6708|\u5E74)/g,e=/\u65E5/,g=/\u301c/g,k="(?:[?0-9]{1,2}%%NUMD%%){0,2}[?0-9]{4}(?![0-9])",l="[?0-9]{4}(?:%%NUMD%%[?0-9]{1,2}){0,2}(?![0-9])",m="[?0-9]{1,3}",n="[%%DATED%%]",o="[?~]",p="[a-zA-Z]+",q="("+l+"|"+k+"|"+m+"|"+n+"|"+o+"|"+p+")",r=new RegExp(q.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"-")),s=new RegExp(q.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"/")),t=new RegExp(q.replace(/%%NUMD%%/g,"/").replace(/%%DATED%%/g,"-")),u=[],v=[],x=u.length,h=0;x>h;h+=1)w=new RegExp(u[h]+".*"),v.push(w);this.mstrings="january february march april may june july august september october november december spring summer fall winter spring summer",this.mstrings=this.mstrings.split(" "),this.setOrderDayMonth=function(){this.monthguess=1,this.dayguess=0},this.setOrderMonthDay=function(){this.monthguess=0,this.dayguess=1},this.setOrderMonthDay(),this.resetMonths=function(){var a,b,c,d;for(this.msets=[],a=0,b=this.mstrings.length;b>a;a+=1)this.msets.push([this.mstrings[a]]);for(this.mabbrevs=[],a=0,b=this.msets.length;b>a;a+=1)for(this.mabbrevs.push([]),c=0,d=this.msets[a].length;d>c;c+=1)this.mabbrevs[a].push(this.msets[a][0].slice(0,3));for(this.mrexes=[],a=0,b=this.mabbrevs.length;b>a;a+=1)this.mrexes.push(new RegExp("(?:"+this.mabbrevs[a].join("|")+")"))},this.resetMonths(),this.addMonths=function(a){var b,d,e,f,g,h,i,j;if("string"==typeof a&&(a=a.split(/\s+/)),12!==a.length&&16!==a.length)return void c.debug("month [+season] list of "+a.length+", expected 12 or 16. Ignoring.");for(b=0,d=a.length;d>b;b+=1){var k=!1,l=!1,m=3,n={};for(e=0,f=this.mabbrevs.length;f>e;e+=1){if(n[e]={},e===b){for(g=0,h=this.mabbrevs[b].length;h>g;g+=1)if(this.mabbrevs[b][g]===a[b].slice(0,this.mabbrevs[b][g].length)){l=!0;break}}else for(g=0,h=this.mabbrevs[e].length;h>g;g+=1)if(k=this.mabbrevs[e][g].length,this.mabbrevs[e][g]===a[b].slice(0,k)){for(;this.msets[e][g].slice(0,k)===a[b].slice(0,k);){if(k>a[b].length||k>this.msets[e][g].length){c.debug("unable to disambiguate month string in date parser: "+a[b]);break}k+=1}m=k,n[e][g]=k}for(i in n)if(n.hasOwnProperty(i))for(j in n[i])n[i].hasOwnProperty(j)&&(k=n[i][j],i=parseInt(i,10),j=parseInt(j,10),this.mabbrevs[i][j]=this.msets[i][j].slice(0,k))}l||(this.msets[b].push(a[b]),this.mabbrevs[b].push(a[b].slice(0,m)))}for(this.mrexes=[],b=0,d=this.mabbrevs.length;d>b;b+=1)this.mrexes.push(new RegExp("(?:"+this.mabbrevs[b].join("|")+")"))},this.parse=function(a){var i,j,k,l,m,n,o,p,q,u,w,y,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R;if(a&&(a=""+a,a=a.replace(/\s*[0-9]{2}:[0-9]{2}(?::[0-9]+)/,""),m=a.match(f))){if(a=a.replace(/\s+/,"","g"),a=a.replace(e,"","g"),a=a.replace(f,"-","g"),a=a.replace(g,"/","g"),a=a.replace("-/","/","g"),a=a.replace(/-$/,"","g"),K=a.split(d),k=[],J=a.match(z)){var S=[];for(h=0,x=J.length;x>h;h+=1)S=S.concat(J[h].match(/([^0-9]+)([0-9]+)/).slice(1));for(h=0,x=K.length;x>h;h+=1)k.push(K[h]),h!==x-1&&(L=2*h,k.push(S[L]),k.push(S[L+1]))}else k=K;for(l=k.length,h=1;l>h;h+=3)k[h+1]=b[k[h]]+parseInt(k[h+1],10),k[h]="";a=k.join(""),a=a.replace(/\s*-\s*$/,"").replace(/\s*-\s*\//,"/"),a=a.replace(/\.\s*$/,""),a=a.replace(/\.(?! )/,""),i=a.indexOf("/"),j=a.indexOf("-")}if(a=a.replace(/([A-Za-z])\./g,"$1"),n="",o="",p={},'"'===a.slice(0,1)&&'"'===a.slice(-1))return p.literal=a.slice(1,-1),p;for(i>-1&&j>-1?(q=a.split("/"),q.length>3?(u="-",w="/",k=a.split(t)):(u="/",w="-",k=a.split(s))):(a=a.replace("/","-"),u="-",w="-",k=a.split(r)),y=[],x=k.length,h=0;x>h;h+=1)G=k[h],m=G.match(/^\s*([\-\/]|[a-zA-Z]+|[\-~?0-9]+)\s*$/),m&&y.push(m[1]);for(A=y.indexOf(u),B=[],C=!1,A>-1?(B.push([0,A]),B.push([A+1,y.length]),C=!0):B.push([0,y.length]),D="",M=0,N=B.length;N>M;M+=1){for(H=B[M],E=y.slice(H[0],H[1]),O=0,P=E.length;P>O;O+=1)if(I=E[O],I.indexOf(w)>-1)this.parseNumericDate(p,w,D,I);else if(I.match(/[0-9]{4}/))p["year"+D]=I.replace(/^0*/,"");else{for(F=!1,Q=0,R=this.mrexes.length;R>Q;Q+=1){if(I.toLocaleLowerCase().match(this.mrexes[Q])){p["month"+D]=""+(parseInt(Q,10)+1),F=!0;break}F||(I.match(/^[0-9]+$/)&&(n=parseInt(I,10)),I.toLocaleLowerCase().match(/^bc/)&&n?(p["year"+D]=""+-1*n,n=""):I.toLocaleLowerCase().match(/^ad/)&&n&&(p["year"+D]=""+n,n=""))}for(F=!1,Q=0,R=v.length;R>Q;Q+=1)if(I.toLocaleLowerCase().match(v[Q])){p["season"+D]=""+(parseInt(Q,10)+1),F=!0;break}F||("~"===I||"?"===I||"c"===I||I.match(/^cir/)?p.circa="1":!I.toLocaleLowerCase().match(/(?:mic|tri|hil|eas)/)||p["season"+D]||(o=I))}n&&(p["day"+D]=n,n=""),o&&!p["season"+D]&&(p["season"+D]=o,o=""),D="_end"}if(C)for(O=0,P=c.DATE_PARTS_ALL.length;P>O;O+=1)G=c.DATE_PARTS_ALL[O],p[G]&&!p[G+"_end"]?p[G+"_end"]=p[G]:!p[G]&&p[G+"_end"]&&(p[G]=p[G+"_end"]);return p.year||(p={literal:a}),this.use_array&&this.toArray(p),p},this.returnAsArray=function(){this.use_array=!0},this.returnAsKeys=function(){this.use_array=!1},this.toArray=function(a){var b,c,d;a["date-parts"]=[],a["date-parts"].push([]);var e=0;for(b=0,c=3;c>b&&(d=["year","month","day"][b],a[d]);b+=1)e+=1,a["date-parts"][0].push(a[d]),delete a[d];for(a["date-parts"].push([]),b=0,c=e;c>b&&(d=["year_end","month_end","day_end"][b],a[d]);b+=1)a["date-parts"][1].push(a[d]),delete a[d];a["date-parts"][0].length!==a["date-parts"][1].length&&a["date-parts"].pop()},this.parseNumericDate=function(a,b,c,d){var e,f,g;for(e=d.split(b),f=0,g=e.length;g>f;f+=1)if(4===e[f].length){a["year"+c]=e[f].replace(/^0*/,""),e=f?e.slice(0,f):e.slice(1);break}for(f=0,g=e.length;g>f;f+=1)e[f]=parseInt(e[f],10);1===e.length||2===e.length&&!e[1]?a["month"+c]=""+e[0]:2===e.length&&(e[this.monthguess]>12?(a["month"+c]=""+e[this.dayguess],a["day"+c]=""+e[this.monthguess]):(a["month"+c]=""+e[this.monthguess],a["day"+c]=""+e[this.dayguess]))}},c.Engine=function(a,b,d,e){function f(a){var a=a.slice(),b=new RegExp("((?:[?!:]*\\s+|-|^)(?:"+a.join("|")+")(?=[!?:]*\\s+|-|$))");return b}var g,h;this.processor_version=c.PROCESSOR_VERSION,this.csl_version="1.0",this.sys=a,a.variableWrapper&&(c.VARIABLE_WRAPPER_PREPUNCT_REX=new RegExp("^(["+[" "].concat(c.SWAPPING_PUNCTUATION).join("")+"]*)(.*)")),this.sys.xml=new c.System.Xml.Parsing,"undefined"==typeof CSL_JSON&&"string"!=typeof b&&(b=""),c.getAbbreviation&&(this.sys.getAbbreviation=c.getAbbreviation),this.sys.stringCompare&&(c.stringCompare=this.sys.stringCompare),this.sys.AbbreviationSegments=c.AbbreviationSegments,this.parallel=new c.Parallel(this),this.transform=new c.Transform(this),this.setParseNames=function(a){this.opt["parse-names"]=a},this.opt=new c.Engine.Opt,this.tmp=new c.Engine.Tmp,this.build=new c.Engine.Build,this.fun=new c.Engine.Fun(this),this.configure=new c.Engine.Configure,this.citation_sort=new c.Engine.CitationSort,this.bibliography_sort=new c.Engine.BibliographySort,this.citation=new c.Engine.Citation(this),this.bibliography=new c.Engine.Bibliography,this.output=new c.Output.Queue(this),this.dateput=new c.Output.Queue(this),this.cslXml=this.sys.xml.makeXml(b),(this.opt.development_extensions.csl_reverse_lookup_support||this.sys.csl_reverse_lookup_support)&&(this.build.cslNodeId=0,this.setCslNodeIds=function(a,b){var c=this.sys.xml.children(a);this.sys.xml.setAttribute(a,"cslid",this.build.cslNodeId),this.opt.nodenames.push(b),this.build.cslNodeId+=1;for(var d=0,e=this.sys.xml.numberofnodes(c);e>d;d+=1)b=this.sys.xml.nodename(c[d]),b&&this.setCslNodeIds(c[d],b)},this.setCslNodeIds(this.cslXml,"style")),this.sys.xml.addMissingNameNodes(this.cslXml),this.sys.xml.addInstitutionNodes(this.cslXml),this.sys.xml.insertPublisherAndPlace(this.cslXml),this.sys.xml.flagDateMacros(this.cslXml),g=this.sys.xml.attributes(this.cslXml),"undefined"==typeof g["@sort-separator"]&&this.sys.xml.setAttribute(this.cslXml,"sort-separator",", "),this.opt["initialize-with-hyphen"]=!0,this.setStyleAttributes(),this.opt.xclass=a.xml.getAttributeValue(this.cslXml,"class"),this.opt.styleID=this.sys.xml.getStyleId(this.cslXml),this.opt.styleName=this.sys.xml.getStyleId(this.cslXml,!0),c.getSuppressJurisdictions&&(this.opt.suppressJurisdictions=c.getSuppressJurisdictions(this.opt.styleID)),"1.1m"===this.opt.version.slice(0,4)&&(this.opt.development_extensions.static_statute_locator=!0,this.opt.development_extensions.handle_parallel_articles=!0,this.opt.development_extensions.main_title_from_short_title=!0,this.opt.development_extensions.strict_page_numbers=!0,this.opt.development_extensions.rtl_support=!0,this.opt.development_extensions.expect_and_symbol_form=!0,this.opt.development_extensions.require_explicit_legal_case_title_short=!0),d&&(d=d.replace("_","-")),this.opt["default-locale"][0]&&(this.opt["default-locale"][0]=this.opt["default-locale"][0].replace("_","-")),d&&e&&(this.opt["default-locale"]=[d]),d&&!e&&this.opt["default-locale"][0]&&(d=this.opt["default-locale"][0]),0===this.opt["default-locale"].length&&(d||(d="en-US"),this.opt["default-locale"].push("en-US")),d||(d=this.opt["default-locale"][0]),h=c.localeResolve(d),this.opt.lang=h.best,this.opt["default-locale"][0]=h.best,
this.locale={},this.opt["default-locale-sort"]||(this.opt["default-locale-sort"]=this.opt["default-locale"][0]),this.localeConfigure(h),this.locale[this.opt.lang].opts["skip-words-regexp"]=f(this.locale[this.opt.lang].opts["skip-words"]),this.output.adjust=new c.Output.Queue.adjust(this.getOpt("punctuation-in-quote")),this.registry=new c.Registry(this),this.buildTokenLists("citation"),this.buildTokenLists("bibliography"),this.configureTokenLists(),this.disambiguate=new c.Disambiguation(this),this.splice_delimiter=!1,this.fun.dateparser=new c.DateParser,this.fun.flipflopper=new c.Util.FlipFlopper(this),this.setCloseQuotesArray(),this.fun.ordinalizer.init(this),this.fun.long_ordinalizer.init(this),this.fun.page_mangler=c.Util.PageRangeMangler.getFunction(this,"page"),this.fun.year_mangler=c.Util.PageRangeMangler.getFunction(this,"year"),this.setOutputFormat("html")},c.Engine.prototype.setCloseQuotesArray=function(){var a;a=[],a.push(this.getTerm("close-quote")),a.push(this.getTerm("close-inner-quote")),a.push('"'),a.push("'"),this.opt.close_quotes_array=a},c.makeBuilder=function(a){function b(b){c.XmlToToken.call(b,a,c.START)}function d(b){c.XmlToToken.call(b,a,c.END)}function e(b){c.XmlToToken.call(b,a,c.SINGLETON)}function f(g){var h;if(a.sys.xml.numberofnodes(a.sys.xml.children(g))){h=g,b(h);for(var i=0;i<a.sys.xml.numberofnodes(a.sys.xml.children(h));i+=1)g=a.sys.xml.children(h)[i],null!==a.sys.xml.nodename(g)&&("date"===a.sys.xml.nodename(g)&&(c.Util.fixDateNode.call(a,h,i,g),g=a.sys.xml.children(h)[i]),f(g,b,d,e));d(h)}else e(g)}return f},c.Engine.prototype.buildTokenLists=function(a){var b,d=c.makeBuilder(this);if(b=this.sys.xml.getNodesByName(this.cslXml,a),this.sys.xml.getNodeValue(b)){this.build.area=a;var e=b[0];d(e)}},c.Engine.prototype.setStyleAttributes=function(){var a,b,d;a={};var e=this.cslXml,f=this.cslXml.tagName?(""+this.cslXml.tagName).toLowerCase():"";if("style"!==f&&"cslstyle"!==f&&this.cslXml.getElementsByTagName)var e=this.cslXml.getElementsByTagName("style")[0];a.name=this.sys.xml.nodename(e),b=this.sys.xml.attributes(e);for(d in b)b.hasOwnProperty(d)&&c.Attributes[d].call(a,this,b[d])},c.Engine.prototype.getTerm=function(a,b,d,e,f,g){a&&a.match(/[A-Z]/)&&a===a.toUpperCase()&&(c.debug("Warning: term key is in uppercase form: "+a),a=a.toLowerCase());var h;h=g?this.opt["default-locale"][0]:this.opt.lang;var i=c.Engine.getField(c.LOOSE,this.locale[h].terms,a,b,d,e);if(i||"range-delimiter"!==a||(i="–"),"undefined"==typeof i){if(f===c.STRICT)throw'Error in getTerm: term "'+a+'" does not exist.';f===c.TOLERANT&&(i="")}return i&&(this.tmp.cite_renders_content=!0),i},c.Engine.prototype.getDate=function(a,b){var c;return c=b?this.opt["default-locale"]:this.opt.lang,this.locale[c].dates[a]?this.locale[c].dates[a]:!1},c.Engine.prototype.getOpt=function(a){return"undefined"!=typeof this.locale[this.opt.lang].opts[a]?this.locale[this.opt.lang].opts[a]:!1},c.Engine.prototype.getVariable=function(a,b,d,e){return c.Engine.getField(c.LOOSE,a,b,d,e)},c.Engine.prototype.getDateNum=function(a,b){return"undefined"==typeof a?0:a[b]},c.Engine.getField=function(a,b,d,e,f,g){var h,i,j,k,l,m;if(h="","undefined"==typeof b[d]){if(a===c.STRICT)throw'Error in getField: term "'+d+'" does not exist.';return void 0}for(m=g&&b[d][g]?b[d][g]:b[d],i=[],"symbol"===e?i=["symbol","short"]:"verb-short"===e?i=["verb-short","verb"]:"long"!==e&&(i=[e]),i=i.concat(["long"]),l=i.length,k=0;l>k;k+=1)if(j=i[k],"string"==typeof m||"number"==typeof m)h=m;else if("undefined"!=typeof m[j]){h="string"==typeof m[j]||"number"==typeof m[j]?m[j]:"number"==typeof f?m[j][f]:m[j][0];break}return h},c.Engine.prototype.configureTokenLists=function(){var a,b,d,e,f,g,h,i,j,k,l;for(a=["year","month","day"],j=c.AREAS.length,d=0;j>d;d+=1)for(b=c.AREAS[d],k=this[b].tokens.length-1,h=k;h>-1;h+=-1){if(e=this[b].tokens[h],"date"===e.name&&c.END===e.tokentype&&(f=[]),"date-part"===e.name&&e.strings.name)for(l=a.length,i=0;l>i;i+=1)g=a[i],g===e.strings.name&&f.push(e.strings.name);"date"===e.name&&c.START===e.tokentype&&(f.reverse(),e.dateparts=f),e.next=h+1,e.name&&c.Node[e.name].configure&&c.Node[e.name].configure.call(e,this,h)}return this.version=c.version,this.state},c.Engine.prototype.retrieveItems=function(a){var b;b=[];for(var c=0,d=a.length;d>c;c+=1)b.push(this.retrieveItem(""+a[c]));return b},c.ITERATION=0,c.Engine.prototype.retrieveItem=function(a){var b,d,e,f,g;if(this.opt.development_extensions.normalize_lang_keys_to_lowercase&&"boolean"==typeof this.opt.development_extensions.normalize_lang_keys_to_lowercase){for(var h=0,i=this.opt["default-locale"].length;i>h;h+=1)this.opt["default-locale"][h]=this.opt["default-locale"][h].toLowerCase();for(var h=0,i=this.opt["locale-translit"].length;i>h;h+=1)this.opt["locale-translit"][h]=this.opt["locale-translit"][h].toLowerCase();for(var h=0,i=this.opt["locale-translat"].length;i>h;h+=1)this.opt["locale-translat"][h]=this.opt["locale-translat"][h].toLowerCase();this.opt.development_extensions.normalize_lang_keys_to_lowercase=100}if(c.ITERATION+=1,b=this.sys.retrieveItem(""+a),this.opt.development_extensions.normalize_lang_keys_to_lowercase){if(b.multi){if(b.multi._keys)for(var j in b.multi._keys)for(var k in b.multi._keys[j])k!==k.toLowerCase()&&(b.multi._keys[j][k.toLowerCase()]=b.multi._keys[j][k],delete b.multi._keys[j][k]);if(b.multi.main)for(var j in b.multi.main)b.multi.main[j]=b.multi.main[j].toLowerCase()}for(var h=0,i=c.CREATORS.length;h>i;h+=1){var l=c.CREATORS[h];if(b[l]&&b[l].multi)for(var m=0,n=b[l].length;n>m;m+=1){var o=b[l][m];if(o.multi){if(o.multi._key)for(var k in o.multi._key)k!==k.toLowerCase()&&(o.multi._key[k.toLowerCase()]=o.multi._key[k],delete o.multi._key[k]);o.multi.main&&(o.multi.main=o.multi.main.toLowerCase())}}}}if(b.page){b["page-first"]=b.page;var p=""+b.page;d=p.split(/\s*(?:&|,|-|\u2013)\s*/),"\\"!==d[0].slice(-1)&&(b["page-first"]=d[0])}if(this.opt.development_extensions.field_hack&&b.note&&(d=b.note.match(c.NOTE_FIELDS_REGEXP))){for(e=0,f=d.length;f>e;e+=1){if(g=d[e].match(c.NOTE_FIELD_REGEXP),!b[g[1]]&&c.DATE_VARIABLES.indexOf(g[1])>-1)b[g[1]]={raw:g[2]};else if(!b[g[1]]&&c.NAME_VARIABLES.indexOf(g[1])>-1){b[g[1]]||(b[g[1]]=[]);var q=g[2].split(/\s*\|\|\s*/);1===q.length?b[g[1]].push({family:q[0],isInstitution:!0}):2===q.length&&b[g[1]].push({family:q[0],given:q[1]})}else b[g[1]]&&"type"!==g[1]||(b[g[1]]=g[2].replace(/^\s+/,"").replace(/\s+$/,""));b.note.replace(c.NOTE_FIELD_REGEXP,"")}}for(var h=1,i=c.DATE_VARIABLES.length;i>h;h+=1){var r=b[c.DATE_VARIABLES[h]];r&&(this.opt.development_extensions.raw_date_parsing&&r.raw&&(r=this.fun.dateparser.parse(r.raw)),b[c.DATE_VARIABLES[h]]=this.dateParseArray(r))}if(this.opt.development_extensions.static_statute_locator&&b.type&&["bill","gazette","legislation","treaty"].indexOf(b.type)>-1){var s,t=["type","title","jurisdiction","genre","volume","container-title"],u=[];for(h=0,i=t.length;i>h;h+=1)s=t[h],b[s]&&u.push(b[s]);for(t=["original-date","issued"],h=0,t.length;i>h;h+=1)if(s=t[h],b[s]&&b[s].year){var v=b[s].year;u.push(v);break}b.legislation_id=u.join("::")}if(b["title-short"]||(b["title-short"]=b.shortTitle),this.opt.development_extensions.main_title_from_short_title&&(b["title-main"]=b.title,b["title-sub"]=!1,b.title&&b["title-short"])){var w=b["title-short"];offset=w.length,b.title.slice(0,offset)===w&&b.title.slice(offset).match(/^\s*:/)&&(b["title-main"]=b.title.slice(0,offset).replace(/\s+$/,""),b["title-sub"]=b.title.slice(offset).replace(/^\s*:\s*/,""))}var x=["legal_case","legislation","gazette","regulation"].indexOf(b.type)>-1;if(!x&&b.title&&this.sys.getAbbreviation){var y=!1;b.jurisdiction||(y=!0);var z=this.transform.loadAbbreviation(b.jurisdiction,"title",b.title,b.type,!0);this.transform.abbrevs[z].title&&this.transform.abbrevs[z].title[b.title]&&(b["title-short"]=this.transform.abbrevs[z].title[b.title])}if(b["container-title-short"]=b.journalAbbreviation,b["container-title"]&&this.sys.getAbbreviation){var z=this.transform.loadAbbreviation(b.jurisdiction,"container-title",b["container-title"]);this.transform.abbrevs[z]["container-title"]&&this.transform.abbrevs[z]["container-title"][b["container-title"]]&&(b["container-title-short"]=this.transform.abbrevs[z]["container-title"][b["container-title"]])}return b},c.Engine.prototype.setOpt=function(a,b,c){"style"===a.name||"cslstyle"===a.name?this.opt[b]=c:["citation","bibliography"].indexOf(a.name)>-1?this[a.name].opt[b]=c:-1===["name-form","name-delimiter","names-delimiter"].indexOf(b)&&(a.strings[b]=c)},c.Engine.prototype.fixOpt=function(a,b,c){["citation","bibliography"].indexOf(a.name)>-1&&(this[a.name].opt[b]||"undefined"==typeof this.opt[b]||(this[a.name].opt[b]=this.opt[b])),("name"===a.name||"names"===a.name)&&"undefined"==typeof a.strings[c]&&"undefined"!=typeof this[this.build.root].opt[b]&&(a.strings[c]=this[this.build.root].opt[b])},c.Engine.prototype.remapSectionVariable=function(a){for(var b=0,d=a.length;d>b;b+=1){var e=a[b][0],f=a[b][1],g=!1;if(["bill","gazette","legislation","treaty"].indexOf(e.type)>-1){f.force_pluralism=0,f.label||(f.label="page");var h=["section","","",""];if(this.opt.development_extensions.static_statute_locator&&e.section?(i=e.section.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/),c.STATUTE_SUBDIV_STRINGS[i[0]]?(h[0]=" "+i[0]+" ",h[1]=i.slice(1).join(" ")):(h[0]=" sec. ",h[1]=i.slice(0).join(" "))):this.opt.development_extensions.clobber_locator_if_no_statute_section&&(f.locator=void 0,f.label=void 0),f.locator){var i=f.locator.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/);c.STATUTE_SUBDIV_STRINGS[i[0]]?(h[2]=" "+i[0]+" ",h[3]=i.slice(1).join(" ")):f.label?(h[2]=" "+c.STATUTE_SUBDIV_STRINGS_REVERSE[f.label]+" ",h[3]=i.slice(0).join(" ")):h[3]=i.join(" "),h[3]&&"&"===h[3].slice(0,1)&&(h[3]=" "+h[3])}if(h[2]||(h[2]=h[0]),h[3]){if(h[3].match(/^[^0-9a-zA-Z]/)){var j=h[3].split(/\s+/);h[0]===h[2]&&j[1]&&!c.STATUTE_SUBDIV_STRINGS[j[1].replace(/\s+/,"").replace(/\s+/,"")]&&(f.force_pluralism=1),h[2]=""}}else h[2]="";h[1]||(h[0]="");var g=h.join("");if(g=g.replace(/^\s+/,"").replace(/\s+$/,""))if(i=g.split(/\s+/),c.STATUTE_SUBDIV_STRINGS[i[0]]){for(var k=i.length-2;k>0;k+=-2)i[k]===i[0]&&(f.force_pluralism=1,i=i.slice(0,k).concat(i.slice(k+1)));f.label=c.STATUTE_SUBDIV_STRINGS[i[0]],f.locator=i.slice(1).join(" "),0===f.force_pluralism&&delete f.force_pluralism}else f.locator=i.slice(0).join(" ")}}},c.Engine.prototype.setNumberLabels=function(a){if(a.number&&["bill","gazette","legislation","treaty"].indexOf(a.type)>-1&&this.opt.development_extensions.static_statute_locator&&!this.tmp.shadow_numbers.number){this.tmp.shadow_numbers.number={},this.tmp.shadow_numbers.number.values=[],this.tmp.shadow_numbers.number.plural=0,this.tmp.shadow_numbers.number.numeric=!1,this.tmp.shadow_numbers.number.label=!1;var b=""+a.number;b=b.replace("\\","","g");var d=b.split(/\s/)[0],e=c.STATUTE_SUBDIV_STRINGS[d];if(e){var f=b.match(c.STATUTE_SUBDIV_GROUPED_REGEX),g=b.split(c.STATUTE_SUBDIV_PLAIN_REGEX);if(g.length>1){for(var h=[],i=1,j=g.length;j>i;i+=1){var k=f[i-1].replace(/^\s*/,"");h.push(k.replace("sec.","Sec.").replace("ch.","Ch.")),h.push(g[i].replace(/\s*$/,"").replace(/^\s*/,""))}b=h.join(" ")}else b=g[0];this.tmp.shadow_numbers.number.values.push(["Blob",b,!1]),this.tmp.shadow_numbers.number.numeric=!1}else this.tmp.shadow_numbers.number.values.push(["Blob",b,!1]),this.tmp.shadow_numbers.number.numeric=!0}},c.substituteOne=function(a){return function(b,c){return c?a.replace("%%STRING%%",c):""}},c.substituteTwo=function(a){return function(b){var c=a.replace("%%PARAM%%",b);return function(a,b){return b?c.replace("%%STRING%%",b):""}}},c.Mode=function(a){var b,d,e,f,g,h;b={},d=c.Output.Formats[a];for(e in d)if("@"===e.slice(0,1)){if(f=!1,g=d[e],h=e.split("/"),"string"==typeof g&&g.indexOf("%%STRING%%")>-1)f=g.indexOf("%%PARAM%%")>-1?c.substituteTwo(g):c.substituteOne(g);else if("boolean"!=typeof g||g){if("function"!=typeof g)throw"CSL.Compiler: Bad "+a+" config entry for "+e+": "+g;f=g}else f=c.Output.Formatters.passthrough;1===h.length?b[h[0]]=f:2===h.length&&(b[h[0]]||(b[h[0]]={}),b[h[0]][h[1]]=f)}else b[e]=d[e];return b},c.setDecorations=function(a,b){var d,e,f;d=[];for(f in c.FORMAT_KEY_SEQUENCE)e=c.FORMAT_KEY_SEQUENCE[f],b[e]&&(d.push([e,b[e]]),delete b[e]);return d},c.Engine.prototype.normalDecorIsOrphan=function(a,b){if("normal"===b[1]){var c,d=!1;c="citation"===this.tmp.area?[this.citation.opt.layout_decorations].concat(a.alldecor):a.alldecor;for(var e=c.length-1;e>-1;e+=-1)for(var f=c[e].length-1;f>-1;f+=-1)c[e][f][0]===b[0]&&"normal"!==c[e][f][1]&&(d=!0);if(!d)return!0}return!1},c.Engine.prototype.getCitationLabel=function(a){var b="",d=this.getTrigraphParams(),e=d[0],f=this.getTerm("reference","short",0);"undefined"==typeof f&&(f="reference"),f=f.replace(".",""),f=f.slice(0,1).toUpperCase()+f.slice(1);for(var g=0,h=c.CREATORS.length;h>g;g+=1){var i=c.CREATORS[g];if(a[i]){var j=a[i];e=j.length>d.length?d[d.length-1]:d[j.length-1];for(var k=0,l=j.length;l>k&&k!==e.authors.length;k+=1){var m=this.nameOutput.getName(j[k],"locale-translit",!0),n=m.name;n&&n.family?(f=n.family,f=f.replace(/^([ \'\u2019a-z]+\s+)/,"")):n&&n.literal&&(f=n.literal);var o=f.toLowerCase().match(/^(a\s+|the\s+|an\s+)/);if(o&&(f=f.slice(o[1].length)),f=f.replace(c.ROMANESQUE_NOT_REGEXP,"","g"),!f)break;f=f.slice(0,e.authors[k]),f.length>1?f=f.slice(0,1).toUpperCase()+f.slice(1).toLowerCase():1===f.length&&(f=f.toUpperCase()),b+=f}break}}var p="0000";return a.issued&&a.issued.year&&(p=""+a.issued.year),p=p.slice(-1*e.year),b+=p},c.Engine.prototype.getTrigraphParams=function(){var a=[],b=this.opt.trigraph.split(":");if(!this.opt.trigraph||"A"!==this.opt.trigraph.slice(0,1))throw"Bad trigraph definition: "+this.opt.trigraph;for(var c=0,d=b.length;d>c;c+=1){for(var e=b[c],f={authors:[],year:0},g=0,h=e.length;h>g;g+=1)switch(e.slice(g,g+1)){case"A":f.authors.push(1);break;case"a":f.authors[f.authors.length-1]+=1;break;case"0":f.year+=1;break;default:throw"Invalid character in trigraph definition: "+this.opt.trigraph}a.push(f)}return a},c.Engine.prototype.setOutputFormat=function(a){this.opt.mode=a,this.fun.decorate=c.Mode(a),this.output[a]||(this.output[a]={},this.output[a].tmp={})},c.Engine.prototype.getSortFunc=function(){return function(a,b){return a=a.split("-"),b=b.split("-"),a.length<b.length?1:a.length>b.length?-1:(a=a.slice(-1)[0],b=b.slice(-1)[0],a.length<b.length?1:a.length>b.length?-1:0)}},c.Engine.prototype.setLangTagsForCslSort=function(a){var b,c;if(a)for(this.opt["locale-sort"]=[],b=0,c=a.length;c>b;b+=1)this.opt["locale-sort"].push(a[b]);this.opt["locale-sort"].sort(this.getSortFunc())},c.Engine.prototype.setLangTagsForCslTransliteration=function(a){var b,c;if(this.opt["locale-translit"]=[],a)for(b=0,c=a.length;c>b;b+=1)this.opt["locale-translit"].push(a[b]);this.opt["locale-translit"].sort(this.getSortFunc())},c.Engine.prototype.setLangTagsForCslTranslation=function(a){var b,c;if(this.opt["locale-translat"]=[],a)for(b=0,c=a.length;c>b;b+=1)this.opt["locale-translat"].push(a[b]);this.opt["locale-translat"].sort(this.getSortFunc())},c.Engine.prototype.setLangPrefsForCites=function(a,b){var c=this.opt["cite-lang-prefs"];b||(b=function(a){return a.toLowerCase()});for(var d=["Persons","Institutions","Titles","Journals","Publishers","Places"],e=0,f=d.length;f>e;e+=1){var g=b(d[e]),h=d[e].toLowerCase();if(a[g]){for(var i=[];a[g].length>1;)i.push(a[g].pop());var j={orig:1,translit:2,translat:3};for(2===i.length&&j[i[0]]<j[i[1]]&&i.reverse();i.length;)a[g].push(i.pop());for(var k=c[h];k.length;)k.pop();for(var l=0,m=a[g].length;m>l;l+=1)k.push(a[g][l])}}},c.Engine.prototype.setLangPrefsForCiteAffixes=function(a){if(a&&48===a.length){for(var b,c=this.opt.citeAffixes,d=0,e=["persons","institutions","titles","journals","publishers","places"],f=["translit","orig","translit","translat"],g=0,h=e.length;h>g;g+=1)for(var i=0,j=f.length;j>i;i+=1)b="",d%8===4?c[e[g]]["locale-"+f[i]].prefix||c[e[g]]["locale-"+f[i]].suffix||(b=a[d]?a[d]:"",c[e[g]]["locale-"+f[i]].prefix=b,b=a[d]?a[d+1]:"",c[e[g]]["locale-"+f[i]].suffix=b):(b=a[d]?a[d]:"",c[e[g]]["locale-"+f[i]].prefix=b,b=a[d]?a[d+1]:"",c[e[g]]["locale-"+f[i]].suffix=b),d+=2;this.opt.citeAffixes=c}},c.Engine.prototype.setAutoVietnameseNamesOption=function(a){a?this.opt["auto-vietnamese-names"]=!0:this.opt["auto-vietnamese-names"]=!1},c.Engine.prototype.setAbbreviations=function(a){this.sys.setAbbreviations&&this.sys.setAbbreviations(a)},c.Output={},c.Output.Queue=function(a){this.levelname=["top"],this.state=a,this.queue=[],this.empty=new c.Token("empty");var b={};b.empty=this.empty,this.formats=new c.Stack(b),this.current=new c.Stack(this.queue)},c.Output.Queue.prototype.pop=function(){var a=this.current.value();return a.length?a.pop():a.blobs.pop()},c.Output.Queue.prototype.getToken=function(a){var b=this.formats.value()[a];return b},c.Output.Queue.prototype.mergeTokenStrings=function(a,b){var d,e,f,g;if(d=this.formats.value()[a],e=this.formats.value()[b],f=d,e){d||(d=new c.Token(a,c.SINGLETON),d.decorations=[]),f=new c.Token(a,c.SINGLETON),g="";for(g in d.strings)d.strings.hasOwnProperty(g)&&(f.strings[g]=d.strings[g]);for(g in e.strings)e.strings.hasOwnProperty(g)&&(f.strings[g]=e.strings[g]);f.decorations=d.decorations.concat(e.decorations)}return f},c.Output.Queue.prototype.addToken=function(a,b,d){var e,f;if(e=new c.Token("output"),"string"==typeof d&&(d=this.formats.value()[d]),d&&d.strings){for(f in d.strings)d.strings.hasOwnProperty(f)&&(e.strings[f]=d.strings[f]);e.decorations=d.decorations}"string"==typeof b&&(e.strings.delimiter=b),this.formats.value()[a]=e},c.Output.Queue.prototype.pushFormats=function(a){a||(a={}),a.empty=this.empty,this.formats.push(a)},c.Output.Queue.prototype.popFormats=function(a){this.formats.pop()},c.Output.Queue.prototype.startTag=function(a,b){var c={};this.state.tmp["doing-macro-with-date"]&&this.state.tmp.extension&&(b=this.empty,a="empty"),c[a]=b,this.pushFormats(c),this.openLevel(a)},c.Output.Queue.prototype.endTag=function(a){this.closeLevel(),this.popFormats()},c.Output.Queue.prototype.openLevel=function(a,b){var d,e;if("object"==typeof a)d=new c.Blob(void 0,a);else if("undefined"==typeof a)d=new c.Blob(void 0,this.formats.value().empty,"empty");else{if(!this.formats.value()||!this.formats.value()[a])throw'CSL processor error: call to nonexistent format token "'+a+'"';d=new c.Blob(void 0,this.formats.value()[a],a)}this.nestedBraces&&(d.strings.prefix=d.strings.prefix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),d.strings.prefix=d.strings.prefix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1]),d.strings.suffix=d.strings.suffix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),d.strings.suffix=d.strings.suffix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1])),e=this.current.value(),e.push(d),this.current.push(d)},c.Output.Queue.prototype.closeLevel=function(a){a&&a!==this.current.value().levelname&&c.error("Level mismatch error:  wanted "+a+" but found "+this.current.value().levelname),this.current.pop()},c.Output.Queue.prototype.append=function(a,b,d,e,f){var g,h,i,j=!0;if(d&&(e=!0),this.state.tmp["doing-macro-with-date"]&&!d){if("macro-with-date"!==b)return!1;"macro-with-date"===b&&(b="empty")}if("undefined"==typeof a)return!1;if("number"==typeof a&&(a=""+a),!d&&this.state.tmp.element_trace&&"suppress-me"===this.state.tmp.element_trace.value())return!1;if(h=!1,b?"literal"===b?(g=!0,j=!1):g="string"==typeof b?this.formats.value()[b]:b:g=this.formats.value().empty,!g)throw"CSL processor error: unknown format token name: "+b;if(g.strings&&"undefined"==typeof g.strings.delimiter&&(g.strings.delimiter=""),"string"==typeof a&&a.length&&(a=a.replace(/ ([:;?!\u00bb])/g," $1").replace(/\u00ab /g,"« "),this.last_char_rendered=a.slice(-1),a=a.replace(/\s+'/g,"  '").replace(/^'/g," '"),e?d&&(this.state.tmp.term_predecessor_name=!0):this.state.tmp.term_predecessor=!0),h=new c.Blob(a,g),this.nestedBraces&&(h.strings.prefix=h.strings.prefix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),h.strings.prefix=h.strings.prefix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1]),h.strings.suffix=h.strings.suffix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),h.strings.suffix=h.strings.suffix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1])),i=this.current.value(),"undefined"==typeof i&&0===this.current.mystack.length&&(this.current.mystack.push([]),i=this.current.value()),"string"==typeof h.blobs&&(e?d&&(this.state.tmp.term_predecessor_name=!0):this.state.tmp.term_predecessor=!0),d||this.state.parallel.AppendBlobPointer(i),"string"==typeof a){i.push(h),h.strings["text-case"]&&(h.blobs=c.Output.Formatters[h.strings["text-case"]](this.state,a)),this.state.tmp.strip_periods&&!f&&(h.blobs=h.blobs.replace(/\.([^a-z]|$)/g,"$1"));for(var k=h.decorations.length-1;k>-1;k+=-1)"@quotes"===h.decorations[k][0]&&"true"===h.decorations[k][1]&&(h.punctuation_in_quote=this.state.getOpt("punctuation-in-quote")),h.blobs.match(c.ROMANESQUE_REGEXP)||"@font-style"===h.decorations[k][0]&&(h.decorations=h.decorations.slice(0,k).concat(h.decorations.slice(k+1)));this.state.fun.flipflopper.init(a,h),this.state.fun.flipflopper.processTags()}else j?i.push(h):i.push(a);return!0},c.Output.Queue.prototype.string=function(a,b,d){var e,f,g,h,i,j=c.getSafeEscape(this.state),k=b.slice(),l=[];if(0===k.length)return l;var m="";d?m=d.strings.delimiter:(a.tmp.count_offset_characters=!1,a.tmp.offset_characters=0),d&&d.new_locale&&(d.old_locale=a.opt.lang,a.opt.lang=d.new_locale);var n,o,p,q;for(e=0,f=k.length;f>e;e+=1){if(n=k[e],n.strings.first_blob&&(a.tmp.count_offset_characters=n.strings.first_blob),"string"==typeof n.blobs){if("number"==typeof n.num)l.push(n);else if(n.blobs){i=j(n.blobs);var r=i.length;if(!a.tmp.suppress_decorations)for(g=0,h=n.decorations.length;h>g;g+=1)q=n.decorations[g],"@showid"!==q[0]&&(a.normalDecorIsOrphan(n,q)||(i=a.fun.decorate[q[0]][q[1]].call(n,a,i,q[2])));if(i&&i.length){if(i=j(n.strings.prefix,a.tmp.nestedBraces)+i+j(n.strings.suffix,a.tmp.nestedBraces),(a.opt.development_extensions.csl_reverse_lookup_support||a.sys.csl_reverse_lookup_support)&&!a.tmp.suppress_decorations)for(g=0,h=n.decorations.length;h>g;g+=1)q=n.decorations[g],"@showid"===q[0]&&(i=a.fun.decorate[q[0]][q[1]].call(n,a,i,q[2]));l.push(i),a.tmp.count_offset_characters&&(a.tmp.offset_characters+=r+n.strings.suffix.length+n.strings.prefix.length)}}}else if(n.blobs.length){var s=a.output.string(a,n.blobs,n);l=l.concat(s)}n.strings.first_blob&&(a.registry.registry[n.strings.first_blob].offset=a.tmp.offset_characters,a.tmp.count_offset_characters=!1)}for(e=0,f=l.length-1;f>e;e+=1)"number"!=typeof l[e].num||"number"!=typeof l[e+1].num||l[e+1].UGLY_DELIMITER_SUPPRESS_HACK||(l[e].strings.suffix=l[e].strings.suffix+(m?m:""),l[e+1].successor_prefix="",l[e+1].UGLY_DELIMITER_SUPPRESS_HACK=!0);var t=0;for(e=0,f=l.length;f>e;e+=1)"string"==typeof l[e]&&(t=parseInt(e,10)+1,e<l.length-1&&"object"==typeof l[e+1]&&(m&&!l[e+1].UGLY_DELIMITER_SUPPRESS_HACK&&(l[e]+=j(m)),l[e+1].UGLY_DELIMITER_SUPPRESS_HACK=!0));d&&(d.decorations.length||d.strings.suffix||d.strings.prefix)&&(t=l.length);var u=a.output.renderBlobs(l.slice(0,t),m,!0,d);if(u&&d&&(d.decorations.length||d.strings.suffix||d.strings.prefix)){if(!a.tmp.suppress_decorations)for(e=0,f=d.decorations.length;f>e;e+=1)q=d.decorations[e],["@cite","@bibliography","@display","@showid"].indexOf(q[0])>-1||a.normalDecorIsOrphan(n,q)||"string"==typeof u&&(u=a.fun.decorate[q[0]][q[1]].call(d,a,u,q[2]));if(i=u,o=d.strings.suffix,i&&i.length&&(p=d.strings.prefix,i=j(p,a.tmp.nestedBraces)+i+j(o,a.tmp.nestedBraces),a.tmp.count_offset_characters&&(a.tmp.offset_characters+=p.length+o.length)),u=i,!a.tmp.suppress_decorations)for(e=0,f=d.decorations.length;f>e;e+=1)q=d.decorations[e],-1!==["@cite","@bibliography","@display","@showid"].indexOf(q[0])&&"string"==typeof u&&(u=a.fun.decorate[q[0]][q[1]].call(d,a,u,q[2]))}var v=l.slice(t,l.length);return!v.length&&u?l=[u]:v.length&&!u?l=v:u&&v.length&&(l=[u].concat(v)),"undefined"==typeof d?(this.queue=[],this.current.mystack=[],this.current.mystack.push(this.queue),a.tmp.suppress_decorations&&(l=a.output.renderBlobs(l,void 0,!0))):"boolean"==typeof d&&(l=a.output.renderBlobs(l,void 0,!0)),d&&d.new_locale&&(a.opt.lang=d.old_locale),l},c.Output.Queue.prototype.clearlevel=function(){var a,b,c;for(a=this.current.value(),c=a.blobs.length,b=0;c>b;b+=1)a.blobs.pop()},c.Output.Queue.prototype.renderBlobs=function(a,b,d,e){var f,g,h,i,j,k,l,m,n,o,p,q;if(q=c.getSafeEscape(this.state),b||(b=""),f=this.state,g="",h=[],i="",l=a.length,"citation"===this.state.tmp.area&&!this.state.tmp.just_looking&&1===l&&"object"==typeof a[0]&&e)return a[0].strings.prefix=e.strings.prefix+a[0].strings.prefix,a[0].strings.suffix=a[0].strings.suffix+e.strings.suffix,a[0].decorations=a[0].decorations.concat(e.decorations),a[0].params=e.params,a[0];var r=!0;for(k=0;l>k;k+=1)a[k].checkNext?(a[k].checkNext(a[k+1],r),r=!1):r=!0;var s=!0;for(k=a.length-1;k>0;k+=-1)a[k].checkLast?s&&a[k].checkLast(a[k-1])&&(s=!1):s=!0;for(l=a.length,k=0;l>k;k+=1)if(j=a[k],g&&(i=b),"string"==typeof j)g+=q(i),g+=j,f.tmp.count_offset_characters&&(f.tmp.offset_characters+=i.length);else if(j.status!==c.SUPPRESS){o=j.formatter.format(j.num,j.gender);var t=o.replace(/<[^>]*>/g,"").length;this.append(o,"empty",!0);var u=this.pop(),v=f.tmp.count_offset_characters;if(o=this.string(f,[u],!1),f.tmp.count_offset_characters=v,j.strings["text-case"]&&(o=c.Output.Formatters[j.strings["text-case"]](this.state,o)),o&&this.state.tmp.strip_periods&&(o=o.replace(/\.([^a-z]|$)/g,"$1")),!f.tmp.suppress_decorations)for(n=j.decorations.length,m=0;n>m;m+=1)p=j.decorations[m],f.normalDecorIsOrphan(j,p)||(o=f.fun.decorate[p[0]][p[1]].call(j,f,o,p[2]));o=q(j.strings.prefix)+o+q(j.strings.suffix);var w="";j.status===c.END?w=q(j.range_prefix):j.status===c.SUCCESSOR?w=q(j.successor_prefix):j.status===c.START?w="":j.status===c.SEEN&&(w=q(j.splice_prefix)),g+=w,g+=o,f.tmp.count_offset_characters&&(f.tmp.offset_characters+=w.length+j.strings.prefix.length+t+j.strings.suffix.length)}return g},c.Output.Queue.purgeEmptyBlobs=function(a){if("object"==typeof a&&"object"==typeof a.blobs&&a.blobs.length)for(var b=a.blobs.length-1;b>-1;b--){c.Output.Queue.purgeEmptyBlobs(a.blobs[b]);var d=a.blobs[b];if(!d||!d.blobs||!d.blobs.length){for(var e=[];a.blobs.length-1>b;)e.push(a.blobs.pop());for(a.blobs.pop();e.length;)a.blobs.push(e.pop())}}},c.Output.Queue.adjust=function(a){function b(a){return"number"==typeof a.num||a.blobs&&1===a.blobs.length&&"number"==typeof a.blobs[0].num}function c(a){return"number"==typeof a.num?!0:a.blobs&&"object"==typeof a.blobs?c(a.blobs[a.blobs.length-1])?!0:void 0:!1}function d(a,b){var c=!1,d=["@font-style","@font-variant","@font-weight","@text-decoration","@vertical-align"];if(b&&d.push("@quotes"),a.decorations)for(var e=0,f=a.decorations.length;f>e;e++)if(d.indexOf(a.decorations[e][0])>-1){c=!0;break}return c}function e(a){if(a.decorations)for(var b=0,c=a.decorations.length;c>b;b++)if("@quotes"===a.decorations[b][0])return!0;return"object"!=typeof a.blobs?!1:e(a.blobs[a.blobs.length-1])?!0:!1}function f(a,b){if(a.strings.suffix.slice(0,1)===b)return!0;if("string"==typeof a.blobs)return a.blobs.slice(-1)===b?!0:!1;for(var c=0,d=a.blobs.length;d>c;c++)if(f(a.blobs[c]))return!0;return!1}function g(a,b,c,d,e){function f(){SecondStrings[d]=SecondStrings[d].slice(1)}function g(){FirstStrings[b]=FirstStrings[b].slice(0,-1)}function h(a){SecondStrings[d]=a+SecondStrings[d]}function i(a){FirstStrings[b]+=a}function j(){return t[p]}function k(){FirstStrings[b].slice(-1);return n[o]}function l(){var a=n[o][p];"string"==typeof a?(g(),f(),h(a)):(h(o),g())}function m(){var a=t[p][o];"string"==typeof a?(g(),f(),i(a)):(i(p),f())}FirstStrings="blobs"===b?a:a.strings,SecondStrings="blobs"===d?c:c.strings;var o=FirstStrings[b].slice(-1),p=SecondStrings[d].slice(0,1),q=e?g:f,r=e?k:j,s=e?l:m,u=o===p;u?q():r()&&s()}function h(a){if("object"==typeof a&&"object"==typeof a.blobs&&a.blobs.length)for(var b=d(a,!0),c=a.blobs.length-1;c>-1;c--){c===a.blobs.length-1;this.upward(a.blobs[c]);var e=a.strings,f=a.blobs[c].strings;if(0===c){" "===e.prefix.slice(-1)&&" "===f.prefix.slice(0,1)&&(f.prefix=f.prefix.slice(1));var g=f.prefix.slice(0,1);b||!r[g]||e.prefix||(e.prefix+=g,f.prefix=f.prefix.slice(1))}if(c===a.blobs.length-1){var g=f.suffix.slice(-1);!b&&[" "].indexOf(g)>-1&&(e.suffix.slice(0,1)!==g&&(e.suffix=g+e.suffix),f.suffix=f.suffix.slice(0,-1))}e.delimiter&&c>0&&r[e.delimiter.slice(-1)]&&e.delimiter.slice(-1)===f.prefix.slice(0,1)&&(f.prefix=f.prefix.slice(1))}}function i(a){if("object"==typeof a&&"object"==typeof a.blobs&&a.blobs.length)for(var b=a.blobs.length-1;b>-1;b--)if(this.leftward(a.blobs[b]),b<a.blobs.length-1&&!a.strings.delimiter){var c=a.blobs[b],e=c.strings.suffix.slice(-1),f=a.blobs[b+1],h=f.strings.prefix.slice(0,1),i=d(c)||d(f),j="number"==typeof e||"number"==typeof h;if(!i&&!j&&q[h]&&!j){var k=h===c.strings.suffix.slice(-1),l=!c.strings.suffix&&"string"==typeof c.blobs&&c.blobs.slice(-1)===h;k||l?f.strings.prefix=f.strings.prefix.slice(1):g(c,"suffix",f,"prefix")}}}function j(a){if("object"==typeof a&&"object"==typeof a.blobs&&a.blobs.length){for(var h=a.strings,i=!1,j=0,k=a.blobs.length;k>j;j++)if(b(a.blobs[j])){i=!0;break}if(!i&&h.delimiter&&q[h.delimiter.slice(0,1)]){for(var l=h.delimiter.slice(0,1),j=a.blobs.length-2;j>-1;j--){var m=a.blobs[j].strings;m.suffix+=l}h.delimiter=h.delimiter.slice(1)}for(var n=d(a,!0),j=(b(a),a.blobs.length-1);j>-1;j--){var o=a.blobs[j],m=a.blobs[j].strings,p=d(o,!0),s=b(o);if(j===a.blobs.length-1){if(!n||e(o)){var t=h.suffix.slice(0,1);q[t]&&(c(o)||g(o,"suffix",a,"suffix"))," "===m.suffix.slice(-1)&&h.suffix.slice(0,1)&&(h.suffix=h.suffix.slice(1))}else f(o,a.strings.suffix.slice(0,1))&&(a.strings.suffix=a.strings.suffix.slice(1));r[m.suffix.slice(0,1)]&&("string"==typeof o.blobs&&o.blobs.slice(-1)===m.suffix.slice(0,1)&&(m.suffix=m.suffix.slice(1)),m.suffix.slice(-1)===h.suffix.slice(0,1)&&(m.suffix=m.suffix.slice(0,-1)))}else if(h.delimiter)r[h.delimiter.slice(0,1)]&&h.delimiter.slice(0,1)===m.suffix.slice(-1)&&(a.blobs[j].strings.suffix=a.blobs[j].strings.suffix.slice(0,-1));else{var u=a.blobs[j+1].strings;b(o)||p||!r[m.suffix.slice(-1)]||m.suffix.slice(-1)!==u.prefix.slice(0,1)||(u.prefix=u.prefix.slice(1))}s||p||!q[m.suffix.slice(0,1)]||"string"!=typeof o.blobs||g(o,"blobs",o,"suffix"),this.downward(a.blobs[j])}}}function k(b){if("object"==typeof b&&"object"==typeof b.blobs&&b.blobs.length){for(var c,d=0,e=b.blobs.length;e>d;d++){for(var f=b.blobs[d],h=!1,i=0,j=f.decorations.length;j>i;i++){var k=f.decorations[i];"@quotes"===k[0]&&(h=!0)}if(h)if(a){var l=f.strings.suffix.slice(0,1);if("string"==typeof f.blobs)for(;o[l];)g(f,"blobs",f,"suffix"),l=f.strings.suffix.slice(0,1);else for(;o[l];)g(f.blobs[f.blobs.length-1],"suffix",f,"suffix"),l=f.strings.suffix.slice(0,1)}else if("string"==typeof f.blobs)for(var l=f.blobs.slice(-1);p[l];)g(f,"blobs",f,"suffix",!0),l=f.blobs.slice(-1);else for(var l=f.blobs[f.blobs.length-1].strings.suffix.slice(-1);p[l];)g(f.blobs[f.blobs.length-1],"suffix",f,"suffix",!0),l=f.blobs[f.blobs.length-1].strings.suffix.slice(-1);c=this.fix(b.blobs[d]),f.blobs&&"string"==typeof f.blobs&&(c=f.blobs.slice(-1))}return c}}var l={";":!0,":":!0},m={".":!0,"!":!0,"?":!0};this.upward=h,this.leftward=i,this.downward=j,this.fix=k;var n={"!":{".":"!","?":"!?",":":"!",",":"!,",";":"!;"},"?":{"!":"?!",".":"?",":":"?",",":"?,",";":"?;"},".":{"!":".!","?":".?",":":".:",",":".,",";":".;"},":":{"!":"!","?":"?",".":":",",":":,",";":":;"},",":{"!":",!","?":",?",":":",:",".":",.",";":",;"},";":{"!":"!","?":"?",":":";",",":";,",".":";"}},o={},p={},q={},r={};for(var s in n)q[s]=!0,r[s]=!0,l[s]||(o[s]=!0),m[s]||(p[s]=!0);r[" "]=!0,r[" "]=!0;var t={};for(var s in n)for(var u in n[s])t[u]||(t[u]={}),t[u][s]=n[s][u]},c.Engine.Opt=function(){this.has_disambiguate=!1,this.mode="html",this.dates={},this["locale-sort"]=[],
this["locale-translit"]=[],this["locale-translat"]=[],this.citeAffixes={persons:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},institutions:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},titles:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},journals:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},publishers:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},places:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}}},this["default-locale"]=[],this.update_mode=c.NONE,this.bib_mode=c.NONE,this.sort_citations=!1,this["et-al-min"]=0,this["et-al-use-first"]=1,this["et-al-use-last"]=!1,this["et-al-subsequent-min"]=!1,this["et-al-subsequent-use-first"]=!1,this["demote-non-dropping-particle"]="display-and-sort",this["parse-names"]=!0,this.citation_number_slug=!1,this.trigraph="Aaaa00:AaAa00:AaAA00:AAAA00",this.development_extensions={},this.development_extensions.field_hack=!0,this.development_extensions.locator_date_and_revision=!0,this.development_extensions.locator_parsing_for_plurals=!0,this.development_extensions.locator_label_parse=!0,this.development_extensions.raw_date_parsing=!0,this.development_extensions.clean_up_csl_flaws=!0,this.development_extensions.flip_parentheses_to_braces=!0,this.development_extensions.jurisdiction_subfield=!0,this.development_extensions.static_statute_locator=!1,this.development_extensions.csl_reverse_lookup_support=!1,this.development_extensions.clobber_locator_if_no_statute_section=!1,this.development_extensions.wrap_url_and_doi=!1,this.development_extensions.allow_force_lowercase=!1,this.development_extensions.handle_parallel_articles=!1,this.development_extensions.thin_non_breaking_space_html_hack=!1,this.development_extensions.apply_citation_wrapper=!1,this.development_extensions.main_title_from_short_title=!1,this.development_extensions.normalize_lang_keys_to_lowercase=!1,this.development_extensions.strict_text_case_locales=!1,this.development_extensions.rtl_support=!1,this.development_extensions.strict_page_numbers=!1,this.development_extensions.expect_and_symbol_form=!1,this.development_extensions.require_explicit_legal_case_title_short=!1,this.nodenames=[],this.gender={},this["cite-lang-prefs"]={persons:["orig"],institutions:["orig"],titles:["orig","translat"],journals:["translit"],publishers:["orig"],places:["orig"],number:["translat"]},this.has_layout_locale=!1},c.Engine.Tmp=function(){this.names_max=new c.Stack,this.names_base=new c.Stack,this.givens_base=new c.Stack,this.value=[],this.namepart_decorations={},this.namepart_type=!1,this.area="citation",this.root="citation",this.extension="",this.can_substitute=new c.Stack(0,c.LITERAL),this.element_rendered_ok=!1,this.element_trace=new c.Stack("style"),this.nameset_counter=0,this.group_context=new c.Stack([!1,!1,!1],c.LITERAL),this.term_predecessor=!1,this.jump=new c.Stack(0,c.LITERAL),this.decorations=new c.Stack,this.tokenstore_stack=new c.Stack,this.last_suffix_used="",this.last_names_used=[],this.last_years_used=[],this.years_used=[],this.names_used=[],this.taintedItemIDs={},this.taintedCitationIDs={},this.initialize_with=new c.Stack,this.disambig_request=!1,this["name-as-sort-order"]=!1,this.suppress_decorations=!1,this.disambig_settings=new c.AmbigConfig,this.bib_sort_keys=[],this.prefix=new c.Stack("",c.LITERAL),this.suffix=new c.Stack("",c.LITERAL),this.delimiter=new c.Stack("",c.LITERAL),this.cite_locales=[],this.cite_affixes={citation:!1,bibliography:!1,citation_sort:!1,bibliography_sort:!1},this.strip_periods=0,this.shadow_numbers={}},c.Engine.Fun=function(a){this.match=new c.Util.Match,this.suffixator=new c.Util.Suffixator(c.SUFFIX_CHARS),this.romanizer=new c.Util.Romanizer,this.ordinalizer=new c.Util.Ordinalizer(a),this.long_ordinalizer=new c.Util.LongOrdinalizer},c.Engine.Build=function(){this["alternate-term"]=!1,this.in_bibliography=!1,this.in_style=!1,this.skip=!1,this.postponed_macro=!1,this.layout_flag=!1,this.name=!1,this.form=!1,this.term=!1,this.macro={},this.macro_stack=[],this.text=!1,this.lang=!1,this.area="citation",this.root="citation",this.extension="",this.substitute_level=new c.Stack(0,c.LITERAL),this.names_level=0,this.render_nesting_level=0,this.render_seen=!1},c.Engine.Configure=function(){this.fail=[],this.succeed=[]},c.Engine.Citation=function(a){this.opt={},this.tokens=[],this.srt=new c.Registry.Comparifier(a,"citation_sort"),this.opt.collapse=[],this.opt["disambiguate-add-names"]=!1,this.opt["disambiguate-add-givenname"]=!1,this.opt["disambiguate-add-year-suffix"]=!1,this.opt["givenname-disambiguation-rule"]="by-cite",this.opt["near-note-distance"]=5,this.opt.topdecor=[],this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="citation"},c.Engine.Bibliography=function(){this.opt={},this.tokens=[],this.opt.collapse=[],this.opt.topdecor=[],this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt["line-spacing"]=1,this.opt["entry-spacing"]=1,this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="bibliography"},c.Engine.BibliographySort=function(){this.tokens=[],this.opt={},this.opt.sort_directions=[],this.keys=[],this.opt.topdecor=[],this.root="bibliography"},c.Engine.CitationSort=function(){this.tokens=[],this.opt={},this.opt.sort_directions=[],this.keys=[],this.opt.topdecor=[],this.root="citation"},c.Engine.prototype.previewCitationCluster=function(a,b,d,e){var f=this.opt.mode;this.setOutputFormat(e);var g=this.processCitationCluster(a,b,d,c.PREVIEW);return this.setOutputFormat(f),g[1]},c.Engine.prototype.appendCitationCluster=function(a){for(var b=[],c=this.registry.citationreg.citationByIndex.length,d=0;c>d;d+=1){var e=this.registry.citationreg.citationByIndex[d];b.push([""+e.citationID,e.properties.noteIndex])}return this.processCitationCluster(a,b,[])[1]},c.Engine.prototype.processCitationCluster=function(a,b,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;this.debug=!1,this.tmp.citation_errors=[];var v={bibchange:!1};this.setCitationId(a);var w,x,y;if(e===c.PREVIEW){w=this.registry.citationreg.citationByIndex.slice(),x=this.registry.reflist.slice();var z=b.concat([[""+a.citationID,a.properties.noteIndex]]).concat(d),A={},B=[];for(g=0,h=z.length;h>g;g+=1)for(f=this.registry.citationreg.citationById[z[g][0]],i=0,j=f.citationItems.length;j>i;i+=1)A[f.citationItems[i].id]=!0,B.push(""+f.citationItems[i].id);for(y={},g=0,h=x.length;h>g;g+=1)if(!A[x[g].id]){var C=this.registry.registry[x[g].id].ambig,D=this.registry.ambigcites[C];if(D)for(i=0,j=D.length;j>i;i+=1)y[D[i]]=c.cloneAmbigConfig(this.registry.registry[D[i]].disambig)}}this.tmp.taintedCitationIDs={};var E=[],F={};for(g=0,h=a.citationItems.length;h>g;g+=1){q={};for(o in a.citationItems[g])q[o]=a.citationItems[g][o];if(p=this.retrieveItem(""+q.id),p.id&&this.transform.loadAbbreviation("default","hereinafter",p.id),this.remapSectionVariable([[p,q]]),this.opt.development_extensions.locator_date_and_revision&&q.locator){q.locator=""+q.locator;var G=q.locator.indexOf("|");if(G>-1){var H=q.locator;q.locator=H.slice(0,G),H=H.slice(G+1),t=H.match(/^([0-9]{4}-[0-9]{2}-[0-9]{2}).*/),t&&(q["locator-date"]=this.fun.dateparser.parse(t[1]),H=H.slice(t[1].length)),q["locator-revision"]=H.replace(/^\s+/,"").replace(/\s+$/,"")}}this.opt.development_extensions.locator_label_parse&&(!q.locator||-1!==["bill","gazette","legislation","treaty"].indexOf(p.type)||q.label&&"page"!==q.label||(t=c.LOCATOR_LABELS_REGEXP.exec(q.locator),t&&(q.label=c.LOCATOR_LABELS_MAP[t[2]],q.locator=t[3])));var I=[p,q];E.push(I),a.citationItems[g].item=p}a.sortedItems=E;var J=[];for(g=0,h=b.length;h>g;g+=1)f=b[g],this.registry.citationreg.citationById[f[0]].properties.noteIndex=f[1],J.push(this.registry.citationreg.citationById[f[0]]);for(J.push(a),g=0,h=d.length;h>g;g+=1)f=d[g],this.registry.citationreg.citationById[f[0]].properties.noteIndex=f[1],J.push(this.registry.citationreg.citationById[f[0]]);this.registry.citationreg.citationByIndex=J,this.registry.citationreg.citationsByItemId={},this.opt.update_mode===c.POSITION&&(s=[],r=[],u={});var K=[];for(g=0,h=J.length;h>g;g+=1){for(J[g].properties.index=g,i=0,j=J[g].sortedItems.length;j>i;i+=1)q=J[g].sortedItems[i],this.registry.citationreg.citationsByItemId[q[1].id]||(this.registry.citationreg.citationsByItemId[q[1].id]=[],K.push(""+q[1].id)),-1===this.registry.citationreg.citationsByItemId[q[1].id].indexOf(J[g])&&this.registry.citationreg.citationsByItemId[q[1].id].push(J[g]);this.opt.update_mode===c.POSITION&&(J[g].properties.noteIndex?r.push(J[g]):(J[g].properties.noteIndex=0,s.push(J[g])))}if(e!==c.ASSUME_ALL_ITEMS_REGISTERED&&this.updateItems(K),!this.opt.citation_number_sort&&E&&E.length>1&&this.citation_sort.tokens.length>0){for(g=0,h=E.length;h>g;g+=1)E[g][1].sortkeys=c.getSortKeys.call(this,E[g][0],"citation_sort");if(this.opt.grouped_sort&&!a.properties.unsorted){for(g=0,h=E.length;h>g;g+=1){var L=E[g][1].sortkeys;this.tmp.authorstring_request=!0;var M=this.registry.registry[E[g][0].id].disambig;this.tmp.authorstring_request=!0,c.getAmbiguousCite.call(this,E[g][0],M);var N=this.registry.authorstrings[E[g][0].id];this.tmp.authorstring_request=!1,E[g][1].sortkeys=[N].concat(L)}E.sort(this.citation.srt.compareCompositeKeys);var O=!1,P=!1,Q=!1;for(g=0,h=E.length;h>g;g+=1)E[g][1].sortkeys[0]!==O&&(Q=E[g][1].sortkeys[0],P=E[g][1].sortkeys[1]),E[g][1].sortkeys[0]=""+P+g,O=Q}a.properties.unsorted||E.sort(this.citation.srt.compareCompositeKeys)}var R;if(this.opt.update_mode===c.POSITION)for(g=0;2>g;g+=1){R=[s,r][g];var S={},T={};for(i=0,j=R.length;j>i;i+=1){var U=R[i];for(R[i].properties.noteIndex||(R[i].properties.noteIndex=0),R[i].properties.noteIndex=parseInt(R[i].properties.noteIndex,10),i>0&&R[i-1].properties.noteIndex>R[i].properties.noteIndex&&(u={},S={},T={}),k=0,l=U.sortedItems.length;l>k;k+=1)this.registry.registry[U.sortedItems[k][1].id].parallel||(u[U.properties.noteIndex]?u[U.properties.noteIndex]+=1:u[U.properties.noteIndex]=1);for(k=0,l=R[i].sortedItems.length;l>k;k+=1){q=R[i].sortedItems[k];var V=q[0].id,W=q[1].locator,X=q[1].label;q[0].legislation_id&&(V=q[0].legislation_id);var Y;if(k>0&&(Y=U.sortedItems[k-1][0].legislation_id?U.sortedItems[k-1][0].legislation_id:U.sortedItems[k-1][1].id),e!==c.PREVIEW||U.citationID==a.citationID){var Z={};if(Z.position=q[1].position,Z["first-reference-note-number"]=q[1]["first-reference-note-number"],Z["near-note"]=q[1]["near-note"],q[1]["first-reference-note-number"]=0,q[1]["near-note"]=!1,this.registry.citationreg.citationsByItemId[V]&&"note"===this.opt.xclass&&this.opt.has_disambiguate){var $=this.registry.registry[V]["citation-count"],_=this.registry.citationreg.citationsByItemId[V].length;if(this.registry.registry[V]["citation-count"]=this.registry.citationreg.citationsByItemId[V].length,"number"==typeof $){var aa=2>$,ba=2>_;if(aa!==ba)for(var ca=0,da=this.registry.citationreg.citationsByItemId[V].length;da>ca;ca++)F[this.registry.registry[V].ambig]=!0,this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[V][ca].citationID]=!0}else for(var ca=0,da=this.registry.citationreg.citationsByItemId[V].length;da>ca;ca++)F[this.registry.registry[V].ambig]=!0,this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[V][ca].citationID]=!0}var ea;if("undefined"==typeof S[V])S[V]=U.properties.noteIndex,this.registry.registry[V]&&(this.registry.registry[V]["first-reference-note-number"]=U.properties.noteIndex),T[V]=U.properties.noteIndex,q[1].position=c.POSITION_FIRST;else{var fa=!1,ga=!1;if(i>0&&(ea=R[i-1].sortedItems.slice(-1)[0][1].id,R[i-1].sortedItems[0].slice(-1)[0].legislation_id&&(ea=R[i-1].sortedItems[0].slice(-1)[0].legislation_id)),i>0&&0===parseInt(k,10)&&R[i-1].properties.noteIndex!==R[i].properties.noteIndex){var ha=R[i-1].sortedItems,ia=!1,ja=R[i-1].sortedItems[0][0].id;for(R[i-1].sortedItems[0][0].legislation_id&&(ja=R[i-1].sortedItems[0][0].legislation_id),(ja==V&&R[i-1].properties.noteIndex>=R[i].properties.noteIndex-1||R[i-1].sortedItems[0][1].id==this.registry.registry[q[1].id].parallel)&&(1===u[R[i-1].properties.noteIndex]||0===R[i-1].properties.noteIndex)&&(ia=!0),m=0,n=ha.slice(1).length;n>m;m+=1){var ka=ha.slice(1)[m];this.registry.registry[ka[1].id].parallel&&this.registry.registry[ka[1].id].parallel!=this.registry.registry[ka[1].id]||(ia=!1)}ia?fa=!0:ga=!0}else k>0&&Y==V?fa=!0:0===k&&R[i-1].properties.noteIndex==R[i].properties.noteIndex&&R[i-1].sortedItems.length&&ea==V?fa=!0:ga=!0;var la,ma,na,oa,pa;if(fa&&(la=k>0?U.sortedItems[k-1][1]:R[i-1].sortedItems[0][1],la.locator?(na=la.label?la.label:"",ma=""+la.locator+na):ma=la.locator,W?(pa=X?X:"",oa=""+W+pa):oa=W),fa&&ma&&!oa&&(fa=!1,ga=!0),fa&&(!ma&&oa?q[1].position=c.POSITION_IBID_WITH_LOCATOR:ma||oa?ma&&oa===ma?q[1].position=c.POSITION_IBID:ma&&oa&&oa!==ma?q[1].position=c.POSITION_IBID_WITH_LOCATOR:(fa=!1,ga=!0):q[1].position=c.POSITION_IBID),ga&&(q[1].position=c.POSITION_SUBSEQUENT),(ga||fa)&&S[V]!=U.properties.noteIndex&&(q[1]["first-reference-note-number"]=S[V],this.registry.registry[V])){var qa=this.registry.citationreg.citationsByItemId[V][0].properties.noteIndex,ra=U.properties.noteIndex;this.registry.registry[V]["first-reference-note-number"]=qa>ra?ra:qa}}if(U.properties.noteIndex){var sa=parseInt(U.properties.noteIndex,10)-parseInt(T[V],10);q[1].position!==c.POSITION_FIRST&&sa<=this.citation.opt["near-note-distance"]&&(q[1]["near-note"]=!0),T[V]=U.properties.noteIndex}if(U.citationID!=a.citationID)for(m=0,n=c.POSITION_TEST_VARS.length;n>m;m+=1){var ta=c.POSITION_TEST_VARS[m];q[1][ta]!==Z[ta]&&("first-reference-note-number"===ta&&(F[this.registry.registry[V].ambig]=!0),this.tmp.taintedCitationIDs[U.citationID]=!0,"first-reference-note-number"===ta&&(this.tmp.taintedItemIDs[V]=!0))}this.sys.variableWrapper&&(q[1].index=U.properties.index,q[1].noteIndex=U.properties.noteIndex)}else"undefined"==typeof S[q[1].id]?(S[V]=U.properties.noteIndex,T[V]=U.properties.noteIndex):T[V]=U.properties.noteIndex}}}if(this.opt.citation_number_sort&&E&&E.length>1&&this.citation_sort.tokens.length>0){for(g=0,h=E.length;h>g;g+=1)E[g][1].sortkeys=c.getSortKeys.call(this,E[g][0],"citation_sort");a.properties.unsorted||E.sort(this.citation.srt.compareCompositeKeys)}for(o in this.tmp.taintedItemIDs)if(this.tmp.taintedItemIDs.hasOwnProperty(o)&&(R=this.registry.citationreg.citationsByItemId[o]))for(g=0,h=R.length;h>g;g+=1)this.tmp.taintedCitationIDs[R[g].citationID]=!0;var ua=[];if(e===c.PREVIEW){try{ua=this.process_CitationCluster.call(this,a.sortedItems,a.citationID)}catch(va){c.error("Error running CSL processor for preview: "+va)}for(this.registry.citationreg.citationByIndex=w,this.registry.citationreg.citationById={},g=0,h=w.length;h>g;g+=1)this.registry.citationreg.citationById[w[g].citationID]=w[g];var wa=[];for(g=0,h=x.length;h>g;g+=1)wa.push(""+x[g].id);this.updateItems(wa);for(o in y)y.hasOwnProperty(o)&&(this.registry.registry[o].disambig=y[o])}else{for(var xa in F)this.disambiguate.run(xa,a);var ya;for(o in this.tmp.taintedCitationIDs)if(o!=a.citationID){var za=this.registry.citationreg.citationById[o];this.tmp.citation_pos=za.properties.index,this.tmp.citation_note_index=za.properties.noteIndex,this.tmp.citation_id=""+za.citationID,ya=[],ya.push(za.properties.index),ya.push(this.process_CitationCluster.call(this,za.sortedItems,za.citationID)),ua.push(ya)}this.tmp.taintedItemIDs={},this.tmp.taintedCitationIDs={},this.tmp.citation_pos=a.properties.index,this.tmp.citation_note_index=a.properties.noteIndex,this.tmp.citation_id=""+a.citationID,ya=[],ya.push(b.length),ya.push(this.process_CitationCluster.call(this,E)),ua.push(ya),ua.sort(function(a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:0})}return v.citation_errors=this.tmp.citation_errors.slice(),[v,ua]},c.Engine.prototype.process_CitationCluster=function(a,b){var d;return this.parallel.StartCitation(a),d=c.getCitationCluster.call(this,a,b)},c.Engine.prototype.makeCitationCluster=function(a){var b,d,e,f,g,h,i;for(b=[],g=a.length,f=0;g>f;f+=1){h={};for(var j in a[f])h[j]=a[f][j];if(i=this.retrieveItem(""+h.id),this.opt.development_extensions.locator_label_parse&&h.locator&&-1===["bill","gazette","legislation","treaty"].indexOf(i.type)&&(!h.label||"page"===h.label)){var k=c.LOCATOR_LABELS_REGEXP.exec(h.locator);k&&(h.label=c.LOCATOR_LABELS_MAP[k[2]],h.locator=k[3])}d=[i,h],b.push(d)}if(this.remapSectionVariable(b),b&&b.length>1&&this.citation_sort.tokens.length>0){for(g=b.length,f=0;g>f;f+=1)b[f][1].sortkeys=c.getSortKeys.call(this,b[f][0],"citation_sort");b.sort(this.citation.srt.compareCompositeKeys)}return this.tmp.citation_errors=[],this.parallel.StartCitation(b),e=c.getCitationCluster.call(this,b)},c.getAmbiguousCite=function(a,b,d){var e,f,g=this.tmp.group_context.value().slice();b?this.tmp.disambig_request=b:this.tmp.disambig_request=!1;var h={position:1};this.registry.registry[a.id]&&this.registry.citationreg.citationsByItemId&&this.registry.citationreg.citationsByItemId[a.id]&&this.registry.citationreg.citationsByItemId[a.id].length&&d&&"by-cite"===this.citation.opt["givenname-disambiguation-rule"]&&(h["first-reference-note-number"]=this.registry.registry[a.id]["first-reference-note-number"]),this.tmp.area="citation",e=this.parallel.use_parallels,this.parallel.use_parallels=!1,this.tmp.suppress_decorations=!0,this.tmp.just_looking=!0,c.getCite.call(this,a,h);for(var i=0,j=this.output.queue.length;j>i;i+=1)c.Output.Queue.purgeEmptyBlobs(this.output.queue[i]);if(this.opt.development_extensions.clean_up_csl_flaws)for(var k=0,l=this.output.queue.length;l>k;k+=1)this.output.adjust.upward(this.output.queue[k]),this.output.adjust.leftward(this.output.queue[k]),this.output.adjust.downward(this.output.queue[k]),this.output.adjust.fix(this.output.queue[k]);return f=this.output.string(this,this.output.queue),this.tmp.just_looking=!1,this.tmp.suppress_decorations=!1,this.parallel.use_parallels=e,this.tmp.group_context.replace(g,"literal"),f},c.getSpliceDelimiter=function(a,b){if(a&&!this.tmp.have_collapsed&&"string"==typeof this.citation.opt["after-collapse-delimiter"])this.tmp.splice_delimiter=this.citation.opt["after-collapse-delimiter"];else if(this.tmp.have_collapsed&&"in-text"===this.opt.xclass&&this.opt.update_mode!==c.NUMERIC)this.tmp.splice_delimiter=", ";else if(this.tmp.use_cite_group_delimiter)this.tmp.splice_delimiter=this.citation.opt.cite_group_delimiter;else if(this.tmp.cite_locales[b-1]){var d=this.tmp.cite_affixes[this.tmp.area][this.tmp.cite_locales[b-1]];d&&d.delimiter&&(this.tmp.splice_delimiter=d.delimiter)}return this.tmp.splice_delimiter||(this.tmp.splice_delimiter=""),this.tmp.splice_delimiter},c.getCitationCluster=function(a,b){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;if(this.tmp.last_primary_names_string=!1,this.tmp.nestedBraces=!1,u=c.getSafeEscape(this),this.tmp.area="citation",d="",e=[],this.tmp.last_suffix_used="",this.tmp.last_names_used=[],this.tmp.last_years_used=[],this.tmp.backref_index=[],this.tmp.cite_locales=[],b&&(this.registry.citationreg.citationById[b].properties.backref_index=!1,this.registry.citationreg.citationById[b].properties.backref_citation=!1),"note"===this.opt.xclass){for(var w=[],x=!1,y=!1,z=!1,A=[],B=0,C=a.length;C>B;B+=1){var D=a[B][0].type,E=a[B][0].title,F=a[B][1].position,G=a[B][0].id;E&&"legal_case"===D&&G!==z&&F&&((E!==x||0===w.length)&&(A=[],w.push(A)),A.push(a[B][1])),x=E,y=F,z=G}for(B=0,C=w.length;C>B;B+=1)if(A=w[B],!(A.length<2)){var H=A.slice(-1)[0].locator;if(H)for(var I=0,J=A.length-1;J>I;I+=1)A[I].locator&&(H=!1);H&&(A[0].locator=H,delete A.slice(-1)[0].locator,A[0].label=A.slice(-1)[0].label,A.slice(-1)[0].label&&delete A.slice(-1)[0].label)}}for(f=[],g=a.length,h=0;g>h;h+=1){if(p=a[h][0],i=a[h][1],j=this.tmp.have_collapsed,k={},h>0?c.getCite.call(this,p,i,""+a[h-1][0].id):(this.tmp.term_predecessor=!1,c.getCite.call(this,p,i)),this.tmp.cite_renders_content||(v={citationID:""+this.tmp.citation_id,index:this.tmp.citation_pos,noteIndex:this.tmp.citation_note_index,itemID:""+p.id,citationItems_pos:h,error_code:c.ERROR_NO_RENDERED_FORM},this.tmp.citation_errors.push(v)),h===a.length-1&&this.parallel.ComposeSet(),k.splice_delimiter=c.getSpliceDelimiter.call(this,j,h),i&&i["author-only"]&&(this.tmp.suppress_decorations=!0),h>0){t=a[h-1][1];var K=t.suffix&&"."===t.suffix.slice(-1),L=!t.suffix&&i.prefix&&"."===i.prefix.slice(0,1);if(K||L){var M=k.splice_delimiter.indexOf(" ");M>-1&&!L?k.splice_delimiter=k.splice_delimiter.slice(M):k.splice_delimiter=""}}k.suppress_decorations=this.tmp.suppress_decorations,k.have_collapsed=this.tmp.have_collapsed,f.push(k)}this.tmp.has_purged_parallel=!1,this.parallel.PruneOutputQueue(this),l=0,o=this.output.queue.slice();var N=({strings:{suffix:this.citation.opt.layout_suffix,delimiter:this.citation.opt.layout_delimiter}},this.citation.opt.layout_suffix),O=this.tmp.cite_locales[this.tmp.cite_locales.length-1];O&&this.tmp.cite_affixes[this.tmp.area][O]&&this.tmp.cite_affixes[this.tmp.area][O].suffix&&(N=this.tmp.cite_affixes[this.tmp.area][O].suffix),c.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(N.slice(0,1))>-1&&(N=N.slice(0,1));var P=this.citation.opt.layout_delimiter;P||(P=""),c.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(P.slice(0,1))>-1&&(P=P.slice(0,1));for(var Q=N,B=0,C=this.output.queue.length;C>B;B+=1)c.Output.Queue.purgeEmptyBlobs(this.output.queue[B]);if(!this.tmp.suppress_decorations&&this.output.queue.length&&(this.opt.development_extensions.apply_citation_wrapper&&this.sys.wrapCitationEntry&&!this.tmp.just_looking&&"citation"===this.tmp.area||(this.output.queue[this.output.queue.length-1].strings.suffix=Q,this.output.queue[0].strings.prefix=this.citation.opt.layout_prefix)),this.opt.development_extensions.clean_up_csl_flaws)for(var I=0,J=this.output.queue.length;J>I;I+=1)this.output.adjust.upward(this.output.queue[I]),this.output.adjust.leftward(this.output.queue[I]),this.output.adjust.downward(this.output.queue[I]),this.tmp.last_chr=this.output.adjust.fix(this.output.queue[I]);for(h=0,g=o.length;g>h;h+=1){if(this.output.queue=[o[h]],this.tmp.suppress_decorations=f[h].suppress_decorations,this.tmp.splice_delimiter=f[h].splice_delimiter,o[h].parallel_delimiter&&(this.tmp.splice_delimiter=o[h].parallel_delimiter),this.tmp.have_collapsed=f[h].have_collapsed,m=this.output.string(this,this.output.queue),this.tmp.suppress_decorations=!1,"string"==typeof m)return this.tmp.suppress_decorations=!1,m;if("object"==typeof m&&0===m.length&&!i["suppress-author"])if(this.tmp.has_purged_parallel)m.push("");else{var R="[CSL STYLE ERROR: reference with no printed form.]",S=0===h?u(this.citation.opt.layout_prefix):"",T=h===o.length-1?u(this.citation.opt.layout_suffix):"";m.push(S+R+T)}if(e.length&&"string"==typeof m[0]){m.reverse();var U=m.pop();U&&","===U.slice(0,1)?e.push(U):"string"==typeof e.slice(-1)[0]&&","===e.slice(-1)[0].slice(-1)?e.push(" "+U):U&&e.push(u(this.tmp.splice_delimiter)+U)}else m.reverse(),n=m.pop(),"undefined"!=typeof n&&(e.length&&"string"==typeof e[e.length-1]&&(e[e.length-1]+=n.successor_prefix),e.push(n));for(q=m.length,r=0;q>r;r+=1)s=m[r],"string"!=typeof s?(n=m.pop(),"undefined"!=typeof n&&e.push(n)):e.push(u(this.tmp.splice_delimiter)+s);0!==e.length||a[h][1]["suppress-author"]||(l+=1)}if(d+=this.output.renderBlobs(e),d&&(this.output.nestedBraces=!1,!this.tmp.suppress_decorations))for(g=this.citation.opt.layout_decorations.length,h=0;g>h;h+=1)k=this.citation.opt.layout_decorations[h],"normal"!==k[1]&&(d=this.fun.decorate[k[0]][k[1]](this,d));return this.tmp.suppress_decorations=!1,d},c.getCite=function(a,b,d){var e,f;for(this.tmp.cite_renders_content=!1,this.parallel.StartCite(a,b,d),c.citeStart.call(this,a,b),e=0,this.nameOutput=new c.NameOutput(this,a,b);e<this[this.tmp.area].tokens.length;)e=c.tokenExec.call(this,this[this.tmp.area].tokens[e],a,b);return c.citeEnd.call(this,a,b),this.parallel.CloseCite(this),this.tmp.cite_renders_content||this.tmp.just_looking||"bibliography"===this.tmp.area&&(f={index:this.tmp.bibliography_pos,itemID:""+a.id,error_code:c.ERROR_NO_RENDERED_FORM},this.tmp.bibliography_errors.push(f)),""+a.id},c.citeStart=function(a,b){if(this.tmp.disambiguate_count=0,this.tmp.disambiguate_maxMax=0,this.tmp.same_author_as_previous_cite=!1,this.tmp.suppress_decorations?this.tmp.subsequent_author_substitute_ok=!1:this.tmp.subsequent_author_substitute_ok=!0,this.tmp.lastchr="","citation"===this.tmp.area&&this.citation.opt.collapse&&this.citation.opt.collapse.length?this.tmp.have_collapsed=!0:this.tmp.have_collapsed=!1,this.tmp.render_seen=!1,this.tmp.disambig_request&&!this.tmp.disambig_override?this.tmp.disambig_settings=this.tmp.disambig_request:this.registry.registry[a.id]&&!this.tmp.disambig_override?(this.tmp.disambig_request=this.registry.registry[a.id].disambig,this.tmp.disambig_settings=this.registry.registry[a.id].disambig):this.tmp.disambig_settings=new c.AmbigConfig,"citation"!==this.tmp.area&&this.registry.registry[a.id]&&(this.tmp.disambig_restore=c.cloneAmbigConfig(this.registry.registry[a.id].disambig),"bibliography"===this.tmp.area&&this.tmp.disambig_settings&&this.tmp.disambig_override&&(this.opt["disambiguate-add-names"]&&(this.tmp.disambig_settings.names=this.registry.registry[a.id].disambig.names.slice(),this.tmp.disambig_request.names=this.registry.registry[a.id].disambig.names.slice()),this.opt["disambiguate-add-givenname"]))){this.tmp.disambig_request=this.tmp.disambig_settings,this.tmp.disambig_settings.givens=this.registry.registry[a.id].disambig.givens.slice(),this.tmp.disambig_request.givens=this.registry.registry[a.id].disambig.givens.slice();for(var d=0,e=this.tmp.disambig_settings.givens.length;e>d;d+=1)this.tmp.disambig_settings.givens[d]=this.registry.registry[a.id].disambig.givens[d].slice();for(var d=0,e=this.tmp.disambig_request.givens.length;e>d;d+=1)this.tmp.disambig_request.givens[d]=this.registry.registry[a.id].disambig.givens[d].slice()}if(this.tmp.names_used=[],this.tmp.nameset_counter=0,this.tmp.years_used=[],this.tmp.names_max.clear(),this.tmp.splice_delimiter=this[this.tmp.area].opt.layout_delimiter,this.bibliography_sort.keys=[],this.citation_sort.keys=[],this.tmp.has_done_year_suffix=!1,this.tmp.last_cite_locale=!1,!this.tmp.just_looking&&b&&!b.position&&this.registry.registry[a.id]&&(this.tmp.disambig_restore=c.cloneAmbigConfig(this.registry.registry[a.id].disambig)),this.tmp.shadow_numbers={},this.setNumberLabels(a),this.tmp.first_name_string=!1,this.opt.development_extensions.flip_parentheses_to_braces&&b&&b.prefix){var f=c.checkNestedBraceOpen.exec(b.prefix),g=c.checkNestedBraceClose.exec(b.prefix);f?g?g[0].length<f[0].length?this.output.nestedBraces=c.NestedBraces:this.output.nestedBraces=!1:this.output.nestedBraces=c.NestedBraces:g&&(this.output.nestedBraces=!1)}},c.citeEnd=function(a,b){if(this.tmp.disambig_restore){this.registry.registry[a.id].disambig.names=this.tmp.disambig_restore.names.slice(),this.registry.registry[a.id].disambig.givens=this.tmp.disambig_restore.givens.slice();for(var d=0,e=this.registry.registry[a.id].disambig.givens.length;e>d;d+=1)this.registry.registry[a.id].disambig.givens[d]=this.tmp.disambig_restore.givens[d].slice()}if(this.tmp.disambig_restore=!1,b&&b.suffix?this.tmp.last_suffix_used=b.suffix:this.tmp.last_suffix_used="",this.tmp.last_years_used=this.tmp.years_used.slice(),this.tmp.last_names_used=this.tmp.names_used.slice(),this.tmp.cut_var=!1,this.tmp.disambig_request=!1,this.tmp.cite_locales.push(this.tmp.last_cite_locale),this.tmp.issued_date&&this.tmp.renders_collection_number){for(var f=[],d=this.tmp.issued_date.list.length-1;d>this.tmp.issued_date.pos;d+=-1)f.push(this.tmp.issued_date.list.pop());for(this.tmp.issued_date.list.pop(),d=f.length-1;d>-1;d+=-1)this.tmp.issued_date.list.push(f.pop());this.parallel.use_parallels&&(this.parallel.cite.issued=!1)}if(this.tmp.issued_date=!1,this.tmp.renders_collection_number=!1,this.opt.development_extensions.flip_parentheses_to_braces&&b&&b.suffix){var g=c.checkNestedBraceOpen.exec(b.suffix),h=c.checkNestedBraceClose.exec(b.suffix);h?g?g[0].length<h[0].length?this.output.nestedBraces=!1:this.output.nestedBraces=c.NestedBraces:this.output.nestedBraces=!1:g&&(this.output.nestedBraces=c.NestedBraces)}},c.Engine.prototype.makeBibliography=function(a){var b,d,e,f,g,h,i,j,k;if(b=!1,!this.bibliography.tokens.length)return!1;"string"==typeof a&&(this.opt.citation_number_slug=a,a=!1),d=c.getBibliographyEntries.call(this,a),j=d[0],k=d[1];var l=d[2];for(e={maxoffset:0,entryspacing:this.bibliography.opt["entry-spacing"],linespacing:this.bibliography.opt["line-spacing"],"second-field-align":!1,entry_ids:j,bibliography_errors:this.tmp.bibliography_errors.slice(),done:l},this.bibliography.opt["second-field-align"]&&(e["second-field-align"]=this.bibliography.opt["second-field-align"]),f=0,h=this.registry.reflist.length,i=0;h>i;i+=1)g=this.registry.reflist[i],g.offset>e.maxoffset&&(e.maxoffset=g.offset);return this.bibliography.opt.hangingindent&&(e.hangingindent=this.bibliography.opt.hangingindent),e.bibstart=this.fun.decorate.bibstart,e.bibend=this.fun.decorate.bibend,this.opt.citation_number_slug=!1,[e,k]},c.getBibliographyEntries=function(a){function b(a,b){return a===b?!0:!1}function d(a,c){for(o=c.length,p=0;o>p;p+=1)if(b(a,c[p]))return!0;return!1}function e(a,c){return"none"!==a&&a||c?"string"==typeof c?b(a,c):c?d(a,c):!1:!0}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;f=[],A=[],this.tmp.area="bibliography",this.tmp.last_rendered_name=!1,this.tmp.bibliography_errors=[],this.tmp.bibliography_pos=0,g=a&&a.page_start&&a.page_length?this.registry.getSortedIds():this.retrieveItems(this.registry.getSortedIds()),this.tmp.disambig_override=!0,w={};var D;if(a&&a.page_start&&a.page_length&&(D=0,a.page_start!==!0))for(t=0,u=g.length;u>t&&(w[g[t]]=!0,a.page_start!=g[t]);t+=1);var E=[];for(t=0,u=g.length;u>t;t+=1){if(a&&a.page_start&&a.page_length){if(w[g[t]])continue;if(m=this.retrieveItem(g[t]),D===a.page_length)break}else if(m=g[t],w[m.id])continue;if(a){if(h=!0,a.include){for(h=!1,B=0,C=a.include.length;C>B;B+=1)if(n=a.include[B],e(n.value,m[n.field])){h=!0;break}}else if(a.exclude){for(i=!1,B=0,C=a.exclude.length;C>B;B+=1)if(n=a.exclude[B],e(n.value,m[n.field])){i=!0;break}i&&(h=!1)}else if(a.select){for(h=!1,j=!0,B=0,C=a.select.length;C>B;B+=1)n=a.select[B],e(n.value,m[n.field])||(j=!1);j&&(h=!0)}if(a.quash){for(j=!0,B=0,C=a.quash.length;C>B;B+=1)n=a.quash[B],e(n.value,m[n.field])||(j=!1);j&&(h=!1)}if(!h)continue}if(k=new c.Token("group",c.START),k.decorations=[["@bibliography","entry"]].concat(this.bibliography.opt.layout_decorations),this.output.startTag("bib_entry",k),m.system_id&&this.sys.embedBibliographyEntry?this.output.current.value().item_id=m.system_id:this.output.current.value().system_id=m.id,x=[[{id:""+m.id},m]],r=[],!this.registry.registry[m.id].master||a&&a.page_start&&a.page_length)this.registry.registry[m.id].siblings||(this.parallel.StartCitation(x),this.tmp.term_predecessor=!1,r.push(""+c.getCite.call(this,m)),a&&a.page_start&&a.page_length&&(D+=1));else{for(s=!0,this.parallel.StartCitation(x),this.output.queue[0].strings.delimiter=", ",this.tmp.term_predecessor=!1,r.push(""+c.getCite.call(this,m)),w[m.id]=!0,v=this.registry.registry[m.id].siblings,B=0,C=v.length;C>B;B+=1){var F=this.registry.registry[m.id].siblings[B];y=this.retrieveItem(F),r.push(""+c.getCite.call(this,y)),w[y.id]=!0}this.parallel.ComposeSet(),this.parallel.PruneOutputQueue()}if(A.push(""),this.tmp.bibliography_pos+=1,E.push(r),this.output.endTag("bib_entry"),this.output.queue[0].blobs.length&&this.output.queue[0].blobs[0].blobs.length){for(s||!this.output.queue[0].blobs[0].blobs[0].strings?(q=this.output.queue[0].blobs,
s=!1):q=this.output.queue[0].blobs[0].blobs,B=q.length-1;B>-1;B+=-1)if(q[B].blobs&&0!==q[B].blobs.length){var G,H=this.tmp.cite_locales[this.tmp.cite_locales.length-1];G=this.tmp.cite_affixes[this.tmp.area][H]?this.tmp.cite_affixes[this.tmp.area][H].suffix:this.bibliography.opt.layout_suffix,z=G.slice(0,1),z&&q[B].strings.suffix.slice(-1)===z&&(q[B].strings.suffix=q[B].strings.suffix.slice(0,-1)),q[B].strings.suffix+=G;break}q[0].strings.prefix=this.bibliography.opt.layout_prefix+q[0].strings.prefix}for(var B=0,C=this.output.queue.length;C>B;B+=1)c.Output.Queue.purgeEmptyBlobs(this.output.queue[B]);for(var B=0,C=this.output.queue.length;C>B;B+=1)this.output.adjust.upward(this.output.queue[B]),this.output.adjust.leftward(this.output.queue[B]),this.output.adjust.downward(this.output.queue[B]),this.output.adjust.fix(this.output.queue[B]);l=this.output.string(this,this.output.queue)[0],l||(l="\n[CSL STYLE ERROR: reference with no printed form.]\n"),f.push(l)}var I=!1;if(a&&a.page_start&&a.page_length){var J=g.slice(-1)[0],K=E.slice(-1)[0];J&&K&&J!=K||(I=!0)}return this.tmp.disambig_override=!1,[E,f,I]},c.Engine.prototype.setCitationId=function(a,b){var c,d,e;if(c=!1,!a.citationID||b){for(d=Math.floor(1e14*Math.random());;){if(e=0,!this.registry.citationreg.citationById[d]){a.citationID=d.toString(32);break}e=!e&&5e13>d?1:-1,d+=1===e?1:-1}c=""+d}return this.registry.citationreg.citationById[a.citationID]=a,c},c.Engine.prototype.rebuildProcessorState=function(a,b,d){a||(a=[]),b||(b="html");for(var e={},f=[],g=0,h=a.length;h>g;g+=1)for(var i=0,j=a[g].citationItems.length;j>i;i+=1){var k=""+a[g].citationItems[i].id;e[k]||f.push(k),e[k]=!0}this.updateItems(f);var l=[],m=[],n=[],o=this.opt.mode;this.setOutputFormat(b);for(var g=0,h=a.length;h>g;g+=1){var p=this.processCitationCluster(a[g],l,m,c.ASSUME_ALL_ITEMS_REGISTERED);l.push([a[g].citationID,a[g].properties.noteIndex]);for(var i=0,j=p[1].length;j>i;i+=1){var q=p[1][i][0];n[q]=[l[q][0],l[q][1],p[1][i][1]]}}return this.updateUncitedItems(d),this.setOutputFormat(o),n},c.Engine.prototype.restoreProcessorState=function(a){var b,d,e,f,g,h,i,j,k,l;j=[],k=[],a||(a=[]);var m=[],n={};for(b=0,d=a.length;d>b;b+=1)n[a[b].citationID]&&this.setCitationId(a[b],!0),n[a[b].citationID]=!0,m.push(a[b].properties.index);var o=a.slice();for(o.sort(function(a,b){return a.properties.index<b.properties.index?-1:a.properties.index>b.properties.index?1:0}),b=0,d=o.length;d>b;b+=1)o[b].properties.index=b;for(b=0,d=o.length;d>b;b+=1){for(l=[],e=0,f=o[b].citationItems.length;f>e;e+=1)g=o[b].citationItems[e],"undefined"==typeof g.sortkeys&&(g.sortkeys=[]),h=this.retrieveItem(""+g.id),i=[h,g],l.push(i),o[b].citationItems[e].item=h,k.push(""+g.id);o[b].properties.unsorted||l.sort(this.citation.srt.compareCompositeKeys),o[b].sortedItems=l,this.registry.citationreg.citationById[o[b].citationID]=o[b]}for(this.updateItems(k),b=0,d=a.length;d>b;b+=1)j.push([""+a[b].citationID,a[b].properties.noteIndex]);var p=[];return a&&a.length?p=this.processCitationCluster(a[0],[],j.slice(1)):(this.registry=new c.Registry(this),this.tmp=new c.Engine.Tmp,this.disambiguate=new c.Disambiguation(this)),p},c.Engine.prototype.updateItems=function(a,b,c){var d=this.tmp.area;if(this.registry.init(a),c)for(var e in this.registry.ambigcites)this.registry.ambigsTouched[e]=!0;return this.registry.dodeletes(this.registry.myhash),this.registry.doinserts(this.registry.mylist),this.registry.dorefreshes(),this.registry.rebuildlist(),this.registry.setsortkeys(),this.registry.setdisambigs(),b||this.registry.sorttokens(),this.registry.renumber(),this.tmp.area=d,this.registry.getSortedIds()},c.Engine.prototype.updateUncitedItems=function(a,b){if(a||(a=[]),"object"==typeof a)if("undefined"==typeof a.length){var c=a;a=[];for(var d in c)a.push(d)}else if("number"==typeof a.length)for(var c={},e=0,f=a.length;f>e;e+=1)c[a[e]]=!0;return this.registry.init(a,!0),this.registry.dopurge(c),this.registry.doinserts(this.registry.mylist),this.registry.dorefreshes(),this.registry.rebuildlist(),this.registry.setsortkeys(),this.registry.setdisambigs(),b||this.registry.sorttokens(),this.registry.renumber(),this.registry.getSortedIds()},c.localeResolve=function(a,b){var d,e;return b||(b="en-US"),a||(a=b),d={},e=a.split(/[\-_]/),d.base=c.LANG_BASES[e[0]],"undefined"==typeof d.base?(c.debug("Warning: unknown locale "+a+", setting fallback to "+b),{base:b,best:a,bare:e[0]}):(1===e.length&&(d.generic=!0),1===e.length||"x"===e[1]?d.best=d.base.replace("_","-"):d.best=e.slice(0,2).join("-"),d.base=d.base.replace("_","-"),d.bare=e[0],d)},c.Engine.prototype.localeConfigure=function(a,b){var c;if(this.opt.development_extensions.normalize_lang_keys_to_lowercase&&(a.best=a.best.toLowerCase(),a.bare=a.bare.toLowerCase(),a.base=a.base.toLowerCase()),(!b||!this.locale[a.best])&&(c=this.sys.xml.makeXml(this.sys.retrieveLocale("en-US")),this.localeSet(c,"en-US",a.best),"en-US"!==a.best&&(a.base!==a.best&&(c=this.sys.xml.makeXml(this.sys.retrieveLocale(a.base)),this.localeSet(c,a.base,a.best)),c=this.sys.xml.makeXml(this.sys.retrieveLocale(a.best)),this.localeSet(c,a.best,a.best)),this.localeSet(this.cslXml,"",a.best),this.localeSet(this.cslXml,a.bare,a.best),a.base!==a.best&&this.localeSet(this.cslXml,a.base,a.best),this.localeSet(this.cslXml,a.best,a.best),"undefined"==typeof this.locale[a.best].terms["page-range-delimiter"]&&(["fr","pt"].indexOf(a.best.slice(0,2).toLowerCase())>-1?this.locale[a.best].terms["page-range-delimiter"]="-":this.locale[a.best].terms["page-range-delimiter"]="–"),"undefined"==typeof this.locale[a.best].terms["year-range-delimiter"]&&(this.locale[a.best].terms["year-range-delimiter"]="–"),"undefined"==typeof this.locale[a.best].terms["citation-range-delimiter"]&&(this.locale[a.best].terms["citation-range-delimiter"]="–"),this.opt.development_extensions.normalize_lang_keys_to_lowercase)){for(var d=["default-locale","locale-sort","locale-translit","locale-translat"],e=0,f=d.length;f>e;e+=1)for(var g=0,h=this.opt[d[e]].length;h>g;g+=1)this.opt[d[e]][g]=this.opt[d[e]][g].toLowerCase();this.opt.lang=this.opt.lang.toLowerCase()}},c.Engine.prototype.localeSet=function(a,b,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(b=b.replace("_","-"),d=d.replace("_","-"),this.opt.development_extensions.normalize_lang_keys_to_lowercase&&(b=b.toLowerCase(),d=d.toLowerCase()),this.locale[d]||(this.locale[d]={},this.locale[d].terms={},this.locale[d].opts={},this.locale[d].opts["skip-words"]=c.SKIP_WORDS,this.locale[d].opts["leading-noise-words"]||(this.locale[d].opts["leading-noise-words"]=[]),this.locale[d].dates={},this.locale[d].ord={"1.0.1":!1,keys:{}},this.locale[d]["noun-genders"]={}),f=this.sys.xml.makeXml(),this.sys.xml.nodeNameIs(a,"locale"))f=a;else for(g=this.sys.xml.getNodesByName(a,"locale"),i=0,p=this.sys.xml.numberofnodes(g);p>i;i+=1)if(e=g[i],this.sys.xml.getAttributeValue(e,"lang","xml")===b){f=e;break}for(g=this.sys.xml.getNodesByName(f,"type"),s=0,t=this.sys.xml.numberofnodes(g);t>s;s+=1){var u=g[s],v=this.sys.xml.getAttributeValue(u,"name"),w=this.sys.xml.getAttributeValue(u,"gender");this.opt.gender[v]=w}var x=this.sys.xml.getNodesByName(f,"term","ordinal").length;if(x){for(var y in this.locale[d].ord.keys)delete this.locale[d].terms[y];this.locale[d].ord={"1.0.1":!1,keys:{}}}g=this.sys.xml.getNodesByName(f,"term");var z={"last-digit":{},"last-two-digits":{},"whole-number":{}},A=!1,B={};for(i=0,p=this.sys.xml.numberofnodes(g);p>i;i+=1){if(j=g[i],l=this.sys.xml.getAttributeValue(j,"name"),"sub verbo"===l&&(l="sub-verbo"),"ordinal"===l.slice(0,7)){this.sys.xml.getNodeValue(j);if("ordinal"===l)A=!0;else{var C=this.sys.xml.getAttributeValue(j,"match"),D=l.slice(8),q=this.sys.xml.getAttributeValue(j,"gender-form");q||(q="neuter"),C||(C="last-two-digits","0"===D.slice(0,1)&&(C="last-digit")),"0"===D.slice(0,1)&&(D=D.slice(1)),z[C][D]||(z[C][D]={}),z[C][D][q]=l}this.locale[d].ord.keys[l]=!0}"undefined"==typeof this.locale[d].terms[l]&&(this.locale[d].terms[l]={}),k="long",q=!1,this.sys.xml.getAttributeValue(j,"form")&&(k=this.sys.xml.getAttributeValue(j,"form")),this.sys.xml.getAttributeValue(j,"gender-form")&&(q=this.sys.xml.getAttributeValue(j,"gender-form")),this.sys.xml.getAttributeValue(j,"gender")&&(this.locale[d]["noun-genders"][l]=this.sys.xml.getAttributeValue(j,"gender")),q?(this.locale[d].terms[l][q]={},this.locale[d].terms[l][q][k]=[],r=this.locale[d].terms[l][q],B[l]=!0):(this.locale[d].terms[l][k]=[],r=this.locale[d].terms[l]),this.sys.xml.numberofnodes(this.sys.xml.getNodesByName(j,"multiple"))?(r[k][0]=this.sys.xml.getNodeValue(j,"single"),r[k][1]=this.sys.xml.getNodeValue(j,"multiple")):r[k]=this.sys.xml.getNodeValue(j)}if(A){for(var E in B){var F={},G=0;for(var H in this.locale[d].terms[E])["masculine","feminine"].indexOf(H)>-1?F[H]=this.locale[d].terms[E][H]:G+=1;if(!G)if(F.feminine)for(var H in F.feminine)this.locale[d].terms[E][H]=F.feminine[H];else if(F.masculine)for(var H in F.masculine)this.locale[d].terms[E][H]=F.masculine[H]}this.locale[d].ord["1.0.1"]=z}for(l in this.locale[d].terms)for(s=0,t=2;t>s;s+=1)if(q=c.GENDERS[s],this.locale[d].terms[l][q])for(k in this.locale[d].terms[l])this.locale[d].terms[l][q][k]||(this.locale[d].terms[l][q][k]=this.locale[d].terms[l][k]);for(g=this.sys.xml.getNodesByName(f,"style-options"),i=0,p=this.sys.xml.numberofnodes(g);p>i;i+=1){m=g[i],h=this.sys.xml.attributes(m);for(o in h)if(h.hasOwnProperty(o))if("@punctuation-in-quote"===o||"@limit-day-ordinals-to-day-1"===o)"true"===h[o]?this.locale[d].opts[o.slice(1)]=!0:this.locale[d].opts[o.slice(1)]=!1;else if("@skip-words"===o){var I=h[o].split(/\s*,\s*/);this.locale[d].opts[o.slice(1)]=I}else if("@leading-noise-words"===o&&b===d){var J=h[o].split(/\s*,\s*/);this.locale[d].opts["leading-noise-words"]=J}else if("@name-as-sort-order"===o){this.locale[d].opts["name-as-sort-order"]={};for(var K=h[o].split(/\s+/),s=0,t=K.length;t>s;s+=1)this.locale[d].opts["name-as-sort-order"][K[s]]=!0}else if("@name-as-reverse-order"===o){this.locale[d].opts["name-as-reverse-order"]={};for(var K=h[o].split(/\s+/),s=0,t=K.length;t>s;s+=1)this.locale[d].opts["name-as-reverse-order"][K[s]]=!0}else if("@name-never-short"===o){this.locale[d].opts["name-never-short"]={};for(var K=h[o].split(/\s+/),s=0,t=K.length;t>s;s+=1)this.locale[d].opts["name-never-short"][K[s]]=!0}}for(g=this.sys.xml.getNodesByName(f,"date"),i=0,p=this.sys.xml.numberofnodes(g);p>i;i+=1)n=g[i],this.locale[d].dates[this.sys.xml.getAttributeValue(n,"form")]=n},c.Node={},c.Node.bibliography={build:function(a,b){this.tokentype===c.START&&(a.build.area="bibliography",a.build.root="bibliography",a.fixOpt(this,"names-delimiter","delimiter"),a.fixOpt(this,"name-delimiter","delimiter"),a.fixOpt(this,"name-form","form"),a.fixOpt(this,"and","and"),a.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),a.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),a.fixOpt(this,"initialize-with","initialize-with"),a.fixOpt(this,"initialize","initialize"),a.fixOpt(this,"name-as-sort-order","name-as-sort-order"),a.fixOpt(this,"sort-separator","sort-separator"),a.fixOpt(this,"and","and"),a.fixOpt(this,"et-al-min","et-al-min"),a.fixOpt(this,"et-al-use-first","et-al-use-first"),a.fixOpt(this,"et-al-use-last","et-al-use-last"),a.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),a.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first")),b.push(this)}},c.Node.choose={build:function(a,b){var d;this.tokentype===c.START&&(d=function(a,b){a.tmp.jump.push(void 0,c.LITERAL)}),this.tokentype===c.END&&(d=function(a,b){a.tmp.jump.pop()}),this.execs.push(d),b.push(this)},configure:function(a,b){this.tokentype===c.END?(a.configure.fail.push(b),a.configure.succeed.push(b)):(a.configure.fail.pop(),a.configure.succeed.pop())}},c.Node.citation={build:function(a,b){if(this.tokentype===c.START&&(a.fixOpt(this,"names-delimiter","delimiter"),a.fixOpt(this,"name-delimiter","delimiter"),a.fixOpt(this,"name-form","form"),a.fixOpt(this,"and","and"),a.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),a.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),a.fixOpt(this,"initialize-with","initialize-with"),a.fixOpt(this,"initialize","initialize"),a.fixOpt(this,"name-as-sort-order","name-as-sort-order"),a.fixOpt(this,"sort-separator","sort-separator"),a.fixOpt(this,"and","and"),a.fixOpt(this,"et-al-min","et-al-min"),a.fixOpt(this,"et-al-use-first","et-al-use-first"),a.fixOpt(this,"et-al-use-last","et-al-use-last"),a.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),a.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first"),a.build.area="citation"),this.tokentype===c.END){if(a.opt.grouped_sort="in-text"===a.opt.xclass&&a.citation.opt.collapse&&a.citation.opt.collapse.length||a.citation.opt.cite_group_delimiter&&a.citation.opt.cite_group_delimiter.length&&a.opt.update_mode!==c.POSITION&&a.opt.update_mode!==c.NUMERIC,a.opt.grouped_sort&&a.citation_sort.opt.sort_directions.length){var d=a.citation_sort.opt.sort_directions[0].slice();a.citation_sort.opt.sort_directions=[d].concat(a.citation_sort.opt.sort_directions)}a.citation.srt=new c.Registry.Comparifier(a,"citation_sort")}}},c.Node["#comment"]={build:function(a,b){}},c.Node.date={build:function(a,b){var d,e,f,g,h,i,j,k,l,m;(this.tokentype===c.START||this.tokentype===c.SINGLETON)&&(a.build.date_parts=[],a.build.date_variables=this.variables,a.build.extension||c.Util.substituteStart.call(this,a,b),d=a.build.extension?c.dateMacroAsSortKey:function(a,b,c){var d;if(a.tmp.element_rendered_ok=!1,a.tmp.donesies=[],a.tmp.dateparts=[],d=[],!this.variables.length||a.tmp.just_looking&&"issued"!==this.variables[0])a.tmp.date_object=!1;else{for(a.parallel.StartVariable(this.variables[0]),e=b[this.variables[0]],"undefined"==typeof e&&(e={"date-parts":[[0]]},a.opt.development_extensions.locator_date_and_revision&&c&&"locator-date"===this.variables[0]&&c["locator-date"]&&(e=c["locator-date"])),a.tmp.date_object=e,f=this.dateparts.length,g=0;f>g;g+=1)h=this.dateparts[g],"undefined"!=typeof a.tmp.date_object[h+"_end"]?d.push(h):"month"===h&&"undefined"!=typeof a.tmp.date_object.season_end&&d.push(h);for(i=[],j=["year","month","day"],f=j.length,g=0;f>g;g+=1)d.indexOf(j[g])>-1&&i.push(j[g]);for(d=i.slice(),k=2,f=d.length,g=0;f>g;g+=1)if(h=d[g],l=a.tmp.date_object[h],m=a.tmp.date_object[h+"_end"],l!==m){k=g;break}a.tmp.date_collapse_at=d.slice(k)}},this.execs.push(d),d=function(a,b){if(a.output.startTag("date",this),"issued"===this.variables[0]&&"legal_case"===b.type&&!a.tmp.extension&&""+b["collection-number"]==""+a.tmp.date_object.year&&1===this.dateparts.length&&"year"===this.dateparts[0])for(var c in a.tmp.date_object)if(a.tmp.date_object.hasOwnProperty(c)&&"year"===c.slice(0,4)){a.tmp.issued_date={};var d=a.output.current.mystack.slice(-2)[0].blobs;a.tmp.issued_date.list=d,a.tmp.issued_date.pos=d.length-1}},this.execs.push(d)),a.build.extension||this.tokentype!==c.END&&this.tokentype!==c.SINGLETON||(d=function(a,b){a.output.endTag(),a.parallel.CloseVariable("date")},this.execs.push(d)),b.push(this),(this.tokentype===c.END||this.tokentype===c.SINGLETON)&&(a.build.extension||c.Util.substituteEnd.call(this,a,b))}},c.Node["date-part"]={build:function(a,b){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;this.strings.form||(this.strings.form="long"),a.build.date_parts.push(this.strings.name);var B=a.build.date_variables[0];d=function(a,b){if(a.tmp.date_object){if(g=!0,h="",i="",a.tmp.donesies.push(this.strings.name),a.tmp.date_object.literal&&"year"===this.strings.name&&(a.parallel.AppendToVariable(a.tmp.date_object.literal),a.output.append(a.tmp.date_object.literal,this)),a.tmp.date_object&&(h=a.tmp.date_object[this.strings.name],i=a.tmp.date_object[this.strings.name+"_end"]),"year"!==this.strings.name||0!==h||a.tmp.suppress_decorations||(h=!1),j=!a.tmp.suppress_decorations,k=a.tmp.have_collapsed,l="year-suffix"===a[a.tmp.area].opt.collapse||"year-suffix-ranged"===a[a.tmp.area].opt.collapse,m=a.opt["disambiguate-add-year-suffix"],j&&m&&l&&(a.tmp.years_used.push(h),n=a.tmp.last_years_used.length>=a.tmp.years_used.length,n&&k&&a.tmp.last_years_used[a.tmp.years_used.length-1]===h&&(h=!1)),"undefined"!=typeof h){o=!1,p=!1,q=!1,r=!1,"year"===this.strings.name&&(parseInt(h,10)<500&&parseInt(h,10)>0&&(p=a.getTerm("ad")),parseInt(h,10)<0&&(o=a.getTerm("bc"),h=-1*parseInt(h,10)),i&&(parseInt(i,10)<500&&parseInt(i,10)>0&&(r=a.getTerm("ad")),parseInt(i,10)<0&&(q=a.getTerm("bc"),i=-1*parseInt(i,10)))),a.parallel.AppendToVariable(h);for(var d=""+a.tmp.date_object.month;d.length<2;)d="0"+d;d="month-"+d;var C=a.locale[a.opt.lang]["noun-genders"][d];if(this.strings.form){var D=this.strings.form;if("day"===this.strings.name&&"ordinal"===D&&a.locale[a.opt.lang].opts["limit-day-ordinals-to-day-1"]&&""+h!="1"&&(D="numeric"),h=c.Util.Dates[this.strings.name][D](a,h,C,"accessed"===B),"month"===this.strings.name)if(a.tmp.strip_periods)h=h.replace(/\./g,"");else for(z=0,A=this.decorations.length;A>z;z+=1)if("@strip-periods"===this.decorations[z][0]&&"true"===this.decorations[z][1]){h=h.replace(/\./g,"");break}if(i)if(i=c.Util.Dates[this.strings.name][D](a,i,C,"accessed"===B,"_end"),a.tmp.strip_periods)i=i.replace(/\./g,"");else for(z=0,A=this.decorations.length;A>z;z+=1)if("@strip-periods"===this.decorations[z][0]&&"true"===this.decorations[z][1]){i=i.replace(/\./g,"");break}}if(a.output.openLevel("empty"),a.tmp.date_collapse_at.length){for(s=!0,f=a.tmp.date_collapse_at.length,e=0;f>e;e+=1)if(y=a.tmp.date_collapse_at[e],-1===a.tmp.donesies.indexOf(y)){s=!1;break}if(s){if(""+i!="0"){if(0===a.dateput.queue.length&&(g=!0),a.opt["year-range-format"]&&"expanded"!==a.opt["year-range-format"]&&!a.tmp.date_object.day&&!a.tmp.date_object.month&&!a.tmp.date_object.season&&"year"===this.strings.name&&h&&i){i=a.fun.year_mangler(h+"-"+i,!0);var E=a.getTerm("year-range-delimiter");i=i.slice(i.indexOf(E)+1)}a.dateput.append(i,this),g&&(a.dateput.current.value()[0].strings.prefix="")}a.output.append(h,this),t=a.output.current.value(),t.blobs[t.blobs.length-1].strings.suffix="",a.output.append(a.getTerm("year-range-delimiter"),"empty"),u=a.dateput.current.value(),t.blobs=t.blobs.concat(u),a.dateput.string(a,a.dateput.queue),a.tmp.date_collapse_at=[]}else a.output.append(h,this),a.tmp.date_collapse_at.indexOf(this.strings.name)>-1&&""+i!="0"&&(0===a.dateput.queue.length&&(g=!0),a.dateput.openLevel("empty"),a.dateput.append(i,this),g&&(a.dateput.current.value().blobs[0].strings.prefix=""),o&&a.dateput.append(o),p&&a.dateput.append(p),a.dateput.closeLevel())}else a.output.append(h,this);o&&a.output.append(o),p&&a.output.append(p),a.output.closeLevel()}else"month"===this.strings.name&&a.tmp.date_object.season&&(h=""+a.tmp.date_object.season,h&&h.match(/^[1-4]$/)?(a.tmp.group_context.replace([!1,!1,!0]),a.output.append(a.getTerm("season-0"+h),this)):h&&a.output.append(h,this));a.tmp.value=[],!h&&!a.tmp.have_collapsed||a.opt.has_year_suffix||"year"!==this.strings.name||a.tmp.just_looking||a.registry.registry[b.id]&&a.registry.registry[b.id].disambig.year_suffix!==!1&&!a.tmp.has_done_year_suffix&&(a.tmp.has_done_year_suffix=!0,w=parseInt(a.registry.registry[b.id].disambig.year_suffix,10),v=new c.NumericBlob(w,this,b.id),this.successor_prefix=a[a.build.area].opt.layout_delimiter,this.splice_prefix=a[a.build.area].opt.layout_delimiter,x=new c.Util.Suffixator(c.SUFFIX_CHARS),v.setFormatter(x),"year-suffix-ranged"===a[a.tmp.area].opt.collapse&&(v.range_prefix=a.getTerm("citation-range-delimiter")),a[a.tmp.area].opt["year-suffix-delimiter"]?v.successor_prefix=a[a.tmp.area].opt["year-suffix-delimiter"]:v.successor_prefix=a[a.tmp.area].opt.layout_delimiter,v.UGLY_DELIMITER_SUPPRESS_HACK=!0,a.output.append(v,"literal"))}},this.execs.push(d),b.push(this)}},c.Node["else-if"]={build:function(a,b){c.Conditions.TopNode.call(this,a,b),b.push(this)},configure:function(a,b){c.Conditions.Configure.call(this,a,b)}},c.Node["else"]={build:function(a,b){b.push(this)},configure:function(a,b){this.tokentype===c.START&&(a.configure.fail[a.configure.fail.length-1]=b)}},c.Node["et-al"]={build:function(a,b){if("citation"===a.build.area||"bibliography"===a.build.area){var c=function(a,b,c){a.tmp.etal_node=this,"string"==typeof this.strings.term&&(a.tmp.etal_term=this.strings.term)};this.execs.push(c)}b.push(this)}},c.Node.group={build:function(a,b){var d,e;this.tokentype===c.START?(c.Util.substituteStart.call(this,a,b),a.build.substitute_level.value()&&a.build.substitute_level.replace(a.build.substitute_level.value()+1),d=function(a,b){a.output.startTag("group",this),a.tmp.group_context.mystack.length&&(a.output.current.value().parent=a.tmp.group_context.value()[4]);var d=a.tmp.group_context.value()[5];!d&&this.strings.label_form_override&&(d=this.strings.label_form_override),a.tmp.group_context.push([!1,!1,!1,!1,a.output.current.value(),d,this.strings.set_parallel_condition],c.LITERAL),this.strings.oops&&(a.tmp.group_context.value()[3]=this.strings.oops)},e=[],e.push(d),this.execs=e.concat(this.execs),this.strings["has-publisher-and-publisher-place"]&&(a.build["publisher-special"]=!0,d=function(a,b){if(this.strings["subgroup-delimiter"]&&b.publisher&&b["publisher-place"]){var d=b.publisher.split(/;\s*/),e=b["publisher-place"].split(/;\s*/);d.length>1&&d.length===e.length&&(a.publisherOutput=new c.PublisherOutput(a,this),a.publisherOutput["publisher-list"]=d,a.publisherOutput["publisher-place-list"]=e)}},this.execs.push(d))):(a.build["publisher-special"]&&(a.build["publisher-special"]=!1,"string"==typeof a[a.build.root].opt["name-delimiter"]&&(d=function(a,b){a.publisherOutput&&(a.publisherOutput.render(),a.publisherOutput=!1)},this.execs.push(d))),d=function(a,b){var c=a.tmp.group_context.pop();a.output.endTag();a.tmp.group_context.value();if(c[1]&&(a.tmp.group_context.value()[1]=!0),c[2]||c[0]&&!c[1]){a.tmp.group_context.value()[2]=!0;var d=a.output.current.value().blobs,e=a.output.current.value().blobs.length-1;if(!a.tmp.just_looking&&"undefined"!=typeof c[6]){var f={blobs:d,conditions:c[6],id:b.id,pos:e};a.parallel.parallel_conditional_blobs_list.push(f)}}else a.output.current.value().blobs&&a.output.current.value().blobs.pop(),a.tmp.group_context.value()[3]&&(a.output.current.mystack[a.output.current.mystack.length-2].strings.delimiter=a.tmp.group_context.value()[3])},this.execs.push(d)),b.push(this),this.tokentype===c.END&&(a.build.substitute_level.value()&&a.build.substitute_level.replace(a.build.substitute_level.value()-1),c.Util.substituteEnd.call(this,a,b))}},c.Node["if"]={build:function(a,b){c.Conditions.TopNode.call(this,a,b),b.push(this)},configure:function(a,b){c.Conditions.Configure.call(this,a,b)}},c.Node.conditions={build:function(a,b){this.tokentype===c.START&&a.tmp.conditions.addMatch(this.match),this.tokentype===c.END&&a.tmp.conditions.matchCombine()}},c.Node.condition={build:function(a,b){if(this.tokentype===c.SINGLETON){var d=a.fun.match[this.match](this,a,this.tests);a.tmp.conditions.addTest(d)}}},c.Conditions={},c.Conditions.TopNode=function(a,b){var d;(this.tokentype===c.START||this.tokentype===c.SINGLETON)&&(this.locale&&(a.opt.lang=this.locale),this.tests&&this.tests.length?this.test=a.fun.match[this.match](this,a,this.tests):a.tmp.conditions=new c.Conditions.Engine(a,this)),(this.tokentype===c.END||this.tokentype===c.SINGLETON)&&(d=function(a,b){this.locale_default&&(a.output.current.value().old_locale=this.locale_default,a.output.closeLevel("empty"),a.opt.lang=this.locale_default);var c=this[a.tmp.jump.value()];return c},this.execs.push(d),this.locale_default&&(a.opt.lang=this.locale_default))},c.Conditions.Configure=function(a,b){this.tokentype===c.START?(this.fail=a.configure.fail.slice(-1)[0],this.succeed=this.next,a.configure.fail[a.configure.fail.length-1]=b):this.tokentype===c.SINGLETON?(this.fail=this.next,this.succeed=a.configure.succeed.slice(-1)[0],a.configure.fail[a.configure.fail.length-1]=b):(this.succeed=a.configure.succeed.slice(-1)[0],this.fail=this.next)},c.Conditions.Engine=function(a,b){this.token=b,this.state=a},c.Conditions.Engine.prototype.addTest=function(a){this.token.tests.push(a)},c.Conditions.Engine.prototype.addMatch=function(a){this.token.match=a},c.Conditions.Engine.prototype.matchCombine=function(){this.token.test=this.state.fun.match[this.token.match](this.token,this.state,this.token.tests)},c.Node.info={build:function(a,b){this.tokentype===c.START?a.build.skip="info":a.build.skip=!1}},c.Node.institution={build:function(a,b){if([c.SINGLETON,c.START].indexOf(this.tokentype)>-1){var d=function(a,b){"string"!=typeof a.build.name_delimiter||this.strings.delimiter||(this.strings.delimiter=a.tmp.name_delimiter);"text"===this.strings.and?this.and_term=a.getTerm("and","long",0):"symbol"===this.strings.and?a.opt.development_extensions.expect_and_symbol_form?this.and_term=a.getTerm("and","symbol",0):this.and_term="&":"none"===this.strings.and&&(this.and_term=this.strings.delimiter),"undefined"==typeof this.and_term&&a.tmp.and_term&&(this.and_term=a.getTerm("and","long",0)),c.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)?(this.and_prefix_single=" ",this.and_prefix_multiple=", ","string"==typeof this.strings.delimiter&&(this.and_prefix_multiple=this.strings.delimiter),this.and_suffix=" "):(this.and_prefix_single="",this.and_prefix_multiple="",this.and_suffix=""),"always"===this.strings["delimiter-precedes-last"]?this.and_prefix_single=this.strings.delimiter:"never"===this.strings["delimiter-precedes-last"]&&this.and_prefix_multiple&&(this.and_prefix_multiple=" "),this.and={},"undefined"!=typeof this.and_term?(a.output.append(this.and_term,"empty",!0),this.and.single=a.output.pop(),this.and.single.strings.prefix=this.and_prefix_single,this.and.single.strings.suffix=this.and_suffix,a.output.append(this.and_term,"empty",!0),this.and.multiple=a.output.pop(),this.and.multiple.strings.prefix=this.and_prefix_multiple,this.and.multiple.strings.suffix=this.and_suffix):"undefined"!==this.strings.delimiter&&(this.and.single=new c.Blob(this.strings.delimiter),this.and.single.strings.prefix="",this.and.single.strings.suffix="",this.and.multiple=new c.Blob(this.strings.delimiter),this.and.multiple.strings.prefix="",this.and.multiple.strings.suffix=""),a.nameOutput.institution=this};this.execs.push(d)}b.push(this)},configure:function(a,b){[c.SINGLETON,c.START].indexOf(this.tokentype)>-1&&(a.build.has_institution=!0)}},c.Node["institution-part"]={build:function(a,b){var c;"long"===this.strings.name?c=this.strings["if-short"]?function(a,b){a.nameOutput.institutionpart["long-with-short"]=this}:function(a,b){a.nameOutput.institutionpart["long"]=this}:"short"===this.strings.name&&(c=function(a,b){a.nameOutput.institutionpart["short"]=this}),this.execs.push(c),b.push(this)}},c.Node.key={build:function(a,b){var d,e=new c.Token("key",c.START);e.strings["et-al-min"]=this.strings["et-al-min"],e.strings["et-al-use-first"]=this.strings["et-al-use-first"],e.strings["et-al-use-last"]=this.strings["et-al-use-last"],d=function(a,b){a.tmp.done_vars=[]},e.execs.push(d),a.opt.citation_number_sort_direction=this.strings.sort_direction,d=function(a,b){a.output.openLevel("empty")},e.execs.push(d);var f=[];if(this.strings.sort_direction===c.DESCENDING?(f.push(1),f.push(-1)):(f.push(-1),f.push(1)),a[a.build.area].opt.sort_directions.push(f),c.DATE_VARIABLES.indexOf(this.variables[0])>-1&&(a.build.date_key=!0),d=function(a,b){a.tmp.sort_key_flag=!0,this.strings["et-al-min"]&&(a.tmp["et-al-min"]=this.strings["et-al-min"]),this.strings["et-al-use-first"]&&(a.tmp["et-al-use-first"]=this.strings["et-al-use-first"]),"boolean"==typeof this.strings["et-al-use-last"]&&(a.tmp["et-al-use-last"]=this.strings["et-al-use-last"])},e.execs.push(d),b.push(e),this.variables.length){var g=this.variables[0];if("citation-number"===g&&("citation_sort"===a.build.area&&(a.opt.citation_number_sort=!0),"bibliography_sort"===a.build.area&&(a.opt.citation_number_sort_used=!0)),c.CREATORS.indexOf(g)>-1){var h=new c.Token("names",c.START);h.tokentype=c.START,h.variables=this.variables,c.Node.names.build.call(h,a,b);var i=new c.Token("name",c.SINGLETON);i.tokentype=c.SINGLETON,i.strings["name-as-sort-order"]="all",i.strings["sort-separator"]=" ",i.strings["et-al-use-last"]=this.strings["et-al-use-last"],i.strings["et-al-min"]=this.strings["et-al-min"],i.strings["et-al-use-first"]=this.strings["et-al-use-first"],c.Node.name.build.call(i,a,b);var j=new c.Token("institution",c.SINGLETON);j.tokentype=c.SINGLETON,c.Node.institution.build.call(j,a,b);var k=new c.Token("names",c.END);k.tokentype=c.END,c.Node.names.build.call(k,a,b)}else{var l=new c.Token("text",c.SINGLETON);if(l.dateparts=this.dateparts,c.NUMERIC_VARIABLES.indexOf(g)>-1)d=function(a,b){var d;d=!1,d="citation-number"===g?a.registry.registry[b.id].seq.toString():b[g],d&&(d=c.Util.padding(d)),a.output.append(d,this)};else if("citation-label"===g)d=function(a,b){var c=a.getCitationLabel(b);a.output.append(c,this)};else if(c.DATE_VARIABLES.indexOf(g)>-1)d=c.dateAsSortKey,l.variables=this.variables;else if("title"===g){var m="title",n=!1,o=!1,p=!0;d=a.transform.getOutputFunction(this.variables,m,n,o,p)}else d=function(a,b){var c=b[g];a.output.append(c,"empty")};l.execs.push(d),b.push(l)}}else{var q=new c.Token("text",c.SINGLETON);q.postponed_macro=this.postponed_macro,c.expandMacro.call(a,q)}var r=new c.Token("key",c.END);d=function(a,b){var c=a.output.string(a,a.output.queue);a.sys.normalizeUnicode&&(c=a.sys.normalizeUnicode(c)),""===c&&(c=void 0),("string"!=typeof c||a.tmp.empty_date)&&(c=void 0,a.tmp.empty_date=!1),a[a.tmp.area].keys.push(c),a.tmp.value=[]},r.execs.push(d),a.build.date_key&&("citation_sort"===a.build.area&&(a[a.build.area].opt.sort_directions.push([-1,1]),d=function(a,b){var d=a.registry.registry[b.id].disambig.year_suffix;d||(d=0);var e=c.Util.padding(""+d);a[a.tmp.area].keys.push(e)},r.execs.push(d)),a.build.date_key=!1),d=function(a,b){a.tmp["et-al-min"]=void 0,a.tmp["et-al-use-first"]=void 0,a.tmp["et-al-use-last"]=void 0,a.tmp.sort_key_flag=!1},r.execs.push(d),b.push(r)}},c.Node.label={build:function(a,b){if(this.strings.term){this.strings.form||(this.strings.form="long");var d=function(a,b,d){var e=c.evaluateLabel(this,a,b,d);d&&"locator"===this.strings.term&&(a.parallel.StartVariable("label"),a.parallel.AppendToVariable(d.label),d.section_form_override=this.strings.form),a.output.append(e,this),d&&"locator"===this.strings.term&&a.parallel.CloseVariable()};this.execs.push(d)}else{var e=a.build.names_variables.slice(-1)[0];a.build.name_label||(a.build.name_label={});for(var f=0,g=e.length;g>f;f+=1)a.build.name_label[e[f]]||(a.build.name_label[e[f]]={});if(a.build.name_flag)for(var f=0,g=e.length;g>f;f+=1)a.build.name_label[e[f]].after=this;else for(var f=0,g=e.length;g>f;f+=1)a.build.name_label[e[f]].before=this}b.push(this)}},c.Node.layout={build:function(a,b){var d,e,f,g;this.tokentype===c.START&&(d=function(a,b,d){a.opt.development_extensions.apply_citation_wrapper&&a.sys.wrapCitationEntry&&!a.tmp.just_looking&&b.system_id&&"citation"===a.tmp.area&&(cite_entry=new c.Token("group",c.START),cite_entry.decorations=[["@cite","entry"]],a.output.startTag("cite_entry",cite_entry),a.output.current.value().item_id=b.system_id,d&&(a.output.current.value().locator_txt=d.locator_txt,a.output.current.value().suffix_txt=d.suffix_txt))},this.execs.push(d)),this.tokentype!==c.START||a.tmp.cite_affixes[a.build.area]||(d=function(a,b){a.tmp.done_vars=[],!a.tmp.just_looking&&a.registry.registry[b.id].parallel&&a.tmp.done_vars.push("first-reference-note-number"),a.tmp.rendered_name=!1,a.tmp.name_node={}},this.execs.push(d),d=function(a,b){a.tmp.sort_key_flag=!1},this.execs.push(d),d=function(a,b){a.tmp.nameset_counter=0},this.execs.push(d),d=function(a,b){var d="empty";a.opt.development_extensions.rtl_support&&["ar","he","fa","ur","yi","ps","syr"].indexOf(b.language)>-1&&(d=new c.Token,d.strings.prefix="‫",d.strings.suffix="‬"),a.output.openLevel(d)},this.execs.push(d),b.push(this),a.opt.development_extensions.rtl_support,1,"citation"===a.build.area&&(e=new c.Token("text",c.SINGLETON),
d=function(a,b,d){var e;if(d&&d.prefix){e="";var f=d.prefix.replace(/<[^>]+>/g,"").replace(/["'\u201d\u2019]/g,"").replace(/\s+$/,"").replace(/^[.\s]+/,"");f.match(c.ENDSWITH_ROMANESQUE_REGEXP)?e=" ":c.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(f.slice(-1))&&(e=" ");var g=!1;c.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(f.slice(-1))>-1&&f.slice(0,1)!=f.slice(0,1).toLowerCase()&&(a.tmp.term_predecessor=!1,g=!0),prefix=(d.prefix+e).replace(/\s+/g," "),a.output.append(prefix,this,!1,g)}},e.execs.push(d),b.push(e)));var h;if(this.locale_raw&&(h=new c.Token("dummy",c.START),h.locale=this.locale_raw,h.strings.delimiter=this.strings.delimiter,h.strings.suffix=this.strings.suffix,a.tmp.cite_affixes[a.build.area]||(a.tmp.cite_affixes[a.build.area]={})),this.tokentype===c.START&&(a.build.layout_flag=!0,this.locale_raw||(a[a.tmp.area].opt.topdecor=[this.decorations],a[a.tmp.area+"_sort"].opt.topdecor=[this.decorations],a[a.build.area].opt.layout_prefix=this.strings.prefix,a[a.build.area].opt.layout_suffix=this.strings.suffix,a[a.build.area].opt.layout_delimiter=this.strings.delimiter,a[a.build.area].opt.layout_decorations=this.decorations,a.tmp.cite_affixes[a.build.area]&&(g=new c.Token("else",c.START),c.Node["else"].build.call(g,a,b))),this.locale_raw)){if(a.build.layout_locale_flag)h.name="else-if",c.Attributes["@locale-internal"].call(h,a,this.locale_raw),c.Node["else-if"].build.call(h,a,b);else{var i=new c.Token("choose",c.START);c.Node.choose.build.call(i,a,b),h.name="if",c.Attributes["@locale-internal"].call(h,a,this.locale_raw),c.Node["if"].build.call(h,a,b)}a.tmp.cite_affixes[a.build.area][h.locale]={},a.tmp.cite_affixes[a.build.area][h.locale].delimiter=this.strings.delimiter,a.tmp.cite_affixes[a.build.area][h.locale].suffix=this.strings.suffix}this.tokentype===c.END&&(this.locale_raw&&(a.build.layout_locale_flag?(h.name="else-if",h.tokentype=c.END,c.Attributes["@locale-internal"].call(h,a,this.locale_raw),c.Node["else-if"].build.call(h,a,b)):(h.name="if",h.tokentype=c.END,c.Attributes["@locale-internal"].call(h,a,this.locale_raw),c.Node["if"].build.call(h,a,b),a.build.layout_locale_flag=!0)),this.locale_raw||(a.tmp.cite_affixes[a.build.area]&&a.build.layout_locale_flag&&(g=new c.Token("else",c.END),c.Node["else"].build.call(g,a,b),g=new c.Token("choose",c.END),c.Node.choose.build.call(g,a,b)),a.build_layout_locale_flag=!0,"citation"===a.build.area&&(f=new c.Token("text",c.SINGLETON),d=function(a,b,d){var e;d&&d.suffix&&(e="",(d.suffix.match(c.STARTSWITH_ROMANESQUE_REGEXP)||["[","("].indexOf(d.suffix.slice(0,1))>-1)&&(e=" "),a.output.append(e+d.suffix,this))},f.execs.push(d),b.push(f)),d=function(a,b){"bibliography"===a.tmp.area&&a.bibliography.opt["second-field-align"]&&a.output.endTag(),a.output.closeLevel()},this.execs.push(d),d=function(a,b){a.opt.development_extensions.apply_citation_wrapper&&a.sys.wrapCitationEntry&&!a.tmp.just_looking&&b.system_id&&"citation"===a.tmp.area&&a.output.endTag()},this.execs.push(d),b.push(this),a.build.layout_flag=!1,a.build.layout_locale_flag=!1))}},c.Node.macro={build:function(a,b){}},c.NameOutput=function(a,b,c,d){this.debug=!1,this.state=a,this.Item=b,this.item=c,this.nameset_base=0,this.etal_spec={},this._first_creator_variable=!1,this._please_chop=!1},c.NameOutput.prototype.init=function(a){this.state.tmp.term_predecessor&&(this.state.tmp.subsequent_author_substitute_ok=!1),this.nameset_offset&&(this.nameset_base=this.nameset_base+this.nameset_offset),this.nameset_offset=0,this.names=a,this.variables=a.variables,this.state.tmp.value=[],this.state.tmp.rendered_name=[],this.state.tmp.label_blob=!1,this.state.tmp.etal_node=!1,this.state.tmp.etal_term=!1;for(var b=0,c=this.variables.length;c>b;b+=1)this.Item[this.variables[b]]&&this.Item[this.variables[b]].length&&(this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[b]]));this["et-al"]=void 0,this["with"]=void 0,this.name=void 0,this.institutionpart={},this.state.tmp.group_context.value()[1]=!0,!this.state.tmp.value.length},c.NameOutput.prototype.reinit=function(a){if(this.state.tmp.can_substitute.value()){this.nameset_offset=0,this.variables=a.variables;var b=this.state.tmp.value.slice();this.state.tmp.value=[];for(var d=0,e=this.variables.length;e>d;d+=1)this.Item[this.variables[d]]&&this.Item[this.variables[d]].length&&(this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[d]]));this.state.tmp.value.length&&this.state.tmp.can_substitute.replace(!1,c.LITERAL),this.state.tmp.value=b}},c.NameOutput.prototype.outputNames=function(){var a,b,d=this.variables;if(this.institution.and&&(this.institution.and.single.blobs&&this.institution.and.single.blobs.length||(this.institution.and.single.blobs=this.name.and.single.blobs),this.institution.and.multiple.blobs&&this.institution.and.multiple.blobs.length||(this.institution.and.multiple.blobs=this.name.and.multiple.blobs)),this.variable_offset={},this.family)for(this.family_decor=c.Util.cloneToken(this.family),this.family_decor.strings.prefix="",this.family_decor.strings.suffix="",a=0,b=this.family.execs.length;b>a;a+=1)this.family.execs[a].call(this.family_decor,this.state,this.Item);else this.family_decor=!1;if(this.given)for(this.given_decor=c.Util.cloneToken(this.given),this.given_decor.strings.prefix="",this.given_decor.strings.suffix="",a=0,b=this.given.execs.length;b>a;a+=1)this.given.execs[a].call(this.given_decor,this.state,this.Item);else this.given_decor=!1;if(this.getEtAlConfig(),this.divideAndTransliterateNames(),this.truncatePersonalNameLists(),this.disambigNames(),this.constrainNames(),"count"===this.name.strings.form)return void((this.state.tmp.extension||0!=this.names_count)&&(this.state.output.append(this.names_count,"empty"),this.state.tmp.group_context.value()[2]=!0));this.setEtAlParameters(),this.setCommonTerm(),this.state.tmp.name_node={},this.state.tmp.name_node.children=[],this.renderAllNames();var e=[];for(a=0,b=d.length;b>a;a+=1){for(var f=d[a],g=[],h=!1,i=0,j=this.institutions[f].length;j>i;i+=1)g.push(this.joinPersonsAndInstitutions([this.persons[f][i],this.institutions[f][i]]));if(this.institutions[f].length){var k=this.nameset_base+this.variable_offset[f];this.freeters[f].length&&(k+=1),h=this.joinInstitutionSets(g,k)}var l=this.joinFreetersAndInstitutionSets([this.freeters[f],h]);if(l&&("_sort"!==this.state.tmp.area.slice(-5)&&(l=this._applyLabels(l,f)),e.push(l)),this.common_term)break}for(this.state.output.openLevel("empty"),this.state.output.current.value().strings.delimiter=this.names.strings.delimiter,a=0,b=e.length;b>a;a+=1)this.state.output.append(e[a],"literal",!0);this.state.output.closeLevel("empty");var m=this.state.output.pop();if(this.state.output.append(m,this.names),this.state.tmp.term_predecessor_name&&(this.state.tmp.term_predecessor=!0),this.state.tmp.name_node.top=this.state.output.current.value(),"authority"!==d[0]){var n=[],o=this.Item[d[0]];if(o)for(var a=0,b=o.length;b>a;a+=1)substring=c.Util.Names.getRawName(o[a]),substring&&n.push(substring);n=n.join(", "),n&&(this.state.tmp.name_node.string=n)}if(this.state.tmp.name_node.string&&!this.state.tmp.first_name_string&&(this.state.tmp.first_name_string=this.state.tmp.name_node.string),"classic"===this.Item.type){var p=[];this.state.tmp.first_name_string&&p.push(this.state.tmp.first_name_string),this.Item.title&&p.push(this.Item.title),p=p.join(", "),p&&this.state.sys.getAbbreviation&&(this.state.transform.loadAbbreviation("default","classic",p),this.state.transform.abbrevs["default"].classic[p]&&(this.state.tmp.done_vars.push("title"),this.state.output.append(this.state.transform.abbrevs["default"].classic[p],"empty",!0),m=this.state.output.pop(),this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.top.blobs.push(m)))}this._collapseAuthor(),this.variables=[]},c.NameOutput.prototype._applyLabels=function(a,b){var c;if(!this.label||!this.label[b])return a;var d=0,e=this.freeters_count[b]+this.institutions_count[b];if(e>1)d=1;else{for(var f=0,g=this.persons[b].length;g>f;f+=1)e+=this.persons_count[b][f];e>1&&(d=1)}return this.label[b].before&&("number"==typeof this.label[b].before.strings.plural&&(d=this.label[b].before.strings.plural),c=this._buildLabel(b,d,"before",b),this.state.output.openLevel("empty"),this.state.output.append(c,this.label[b].before,!0),this.state.output.append(a,"literal",!0),this.state.output.closeLevel("empty"),a=this.state.output.pop()),this.label[b].after&&("number"==typeof this.label[b].after.strings.plural&&(d=this.label[b].after.strings.plural),c=this._buildLabel(b,d,"after",b),this.state.output.openLevel("empty"),this.state.output.append(a,"literal",!0),this.state.output.append(c,this.label[b].after,!0),this.state.tmp.label_blob=this.state.output.pop(),this.state.output.append(this.state.tmp.label_blob,"literal",!0),this.state.output.closeLevel("empty"),a=this.state.output.pop()),a},c.NameOutput.prototype._buildLabel=function(a,b,d,e){this.common_term&&(a=this.common_term);var f=!1,g=this.label[e][d];return g&&(f=c.castLabel(this.state,g,a,b,c.TOLERANT)),f},c.NameOutput.prototype._collapseAuthor=function(){var a,b,c;0===this.nameset_base&&this.Item[this.variables[0]]&&!this._first_creator_variable&&(this._first_creator_variable=this.variables[0]),(this.item&&this.item["suppress-author"]&&this._first_creator_variable==this.variables[0]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length||this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter.length)&&(this.state.tmp.authorstring_request?(b="",a=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs,c=this.state.tmp.offset_characters,a&&(b=this.state.output.string(this.state,a,!1)),this.state.tmp.offset_characters=c,this.state.registry.authorstrings[this.Item.id]=b):this.state.tmp.just_looking||this.state.tmp.suppress_decorations||!(this.item["suppress-author"]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length||this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter)||(b="",a=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs,c=this.state.tmp.offset_characters,a&&(b=this.state.output.string(this.state,a,!1)),b===this.state.tmp.last_primary_names_string?((this.item["suppress-author"]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length)&&(this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.children=[],this.state.tmp.offset_characters=c),this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter&&(this.state.tmp.use_cite_group_delimiter=!0)):(this.state.tmp.last_primary_names_string=b,this.variables.indexOf(this._first_creator_variable)>-1&&this.item&&this.item["suppress-author"]&&"legal_case"!==this.Item.type&&(this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.children=[],this.state.tmp.offset_characters=c,this.state.tmp.term_predecessor=!1),this.state.tmp.have_collapsed=!1,this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter&&(this.state.tmp.use_cite_group_delimiter=!1))))},c.NameOutput.prototype.isPerson=function(a){return a.literal||!a.given&&a.family&&a.isInstitution?!1:!0},c.NameOutput.prototype.truncatePersonalNameLists=function(){var a,b,c,d,e,f,g;this.freeters_count={},this.persons_count={},this.institutions_count={};for(a in this.freeters)this.freeters.hasOwnProperty(a)&&(this.freeters_count[a]=this.freeters[a].length,this.freeters[a]=this._truncateNameList(this.freeters,a));for(a in this.persons)if(this.persons.hasOwnProperty(a))for(this.institutions_count[a]=this.institutions[a].length,this._truncateNameList(this.institutions,a),this.persons[a]=this.persons[a].slice(0,this.institutions[a].length),this.persons_count[a]=[],d=0,e=this.persons[a].length;e>d;d+=1)this.persons_count[a][d]=this.persons[a][d].length,this.persons[a][d]=this._truncateNameList(this.persons,a,d);if(f=1!==this.etal_min||1!==this.etal_use_first||this.state.tmp.extension||this.state.tmp.just_looking?!1:a,f||this._please_chop)for(b=0,c=this.variables.length;c>b;b+=1){for(a=this.variables[b],this.freeters[a].length&&(this._please_chop===a?(this.freeters[a]=this.freeters[a].slice(1),this.freeters_count[a]+=-1,this._please_chop=!1):f&&!this._please_chop&&(this.freeters[a]=this.freeters[a].slice(0,1),this.freeters_count[a]=1,this.institutions[a]=[],this.persons[a]=[],this._please_chop=f)),b=0,c=this.persons[a].length;c>b;b+=1)if(this.persons[a][b].length){if(this._please_chop===a){this.persons[a][b]=this.persons[a][b].slice(1),this.persons_count[a][b]+=-1,this._please_chop=!1;break}if(f&&!this._please_chop){this.freeters[a]=this.persons[a][b].slice(0,1),this.freeters_count[a]=1,this.institutions[a]=[],this.persons[a]=[],g=[],this._please_chop=f;break}}this.institutions[a].length&&(this._please_chop===a?(this.institutions[a]=this.institutions[a].slice(1),this.institutions_count[a]+=-1,this._please_chop=!1):f&&!this._please_chop&&(this.institutions[a]=this.institutions[a].slice(0,1),this.institutions_count[a]=1,g=[],this._please_chop=f))}for(b=0,c=this.variables.length;c>b;b+=1)for(this.institutions[a].length&&(this.nameset_offset+=1),b=0,c=this.persons[a].length;c>b;b+=1)this.persons[a][b].length&&(this.nameset_offset+=1)},c.NameOutput.prototype._truncateNameList=function(a,b,c){var d;return d="undefined"==typeof c?a[b]:a[b][c],this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names&&d.length>50&&d.length>this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names+2&&(d=d.slice(0,this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names+2)),d},c.NameOutput.prototype.divideAndTransliterateNames=function(){var a,b,c,d,e=this.Item,f=this.variables;for(this.varnames=f.slice(),this.freeters={},this.persons={},this.institutions={},a=0,b=f.length;b>a;a+=1){var g=f[a];this.variable_offset[g]=this.nameset_offset;var h=this._normalizeVariableValue(e,g);if(this.name.strings["suppress-min"]&&h.length>=this.name.strings["suppress-min"]&&(h=[]),this.name.strings["suppress-max"]&&h.length<=this.name.strings["suppress-max"]&&(h=[]),this._getFreeters(g,h),this._getPersonsAndInstitutions(g,h),0===this.name.strings["suppress-min"])for(this.freeters[g]=[],c=0,d=this.persons[g].length;d>c;c+=1)this.persons[g][c]=[];else if(0===this.institution.strings["suppress-min"]){for(this.institutions[g]=[],this.freeters[g]=this.freeters[g].concat(this.persons[g]),c=0,d=this.persons[g].length;d>c;c+=1)for(var i=0,j=this.persons[g][c].length;j>i;i+=1)this.freeters[g].push(this.persons[g][c][i]);this.persons[g]=[]}}},c.NameOutput.prototype._normalizeVariableValue=function(a,b){var c;return c="string"==typeof a[b]?[{literal:a[b]}]:a[b]?a[b].slice():[]},c.NameOutput.prototype._getFreeters=function(a,b){this.freeters[a]=[];for(var c=b.length-1;c>-1&&this.isPerson(b[c]);c+=-1){var d=this._checkNickname(b.pop());d&&this.freeters[a].push(d)}this.freeters[a].reverse(),this.freeters[a].length&&(this.nameset_offset+=1)},c.NameOutput.prototype._getPersonsAndInstitutions=function(a,b){this.persons[a]=[],this.institutions[a]=[];for(var c=[],d=!1,e=!0,f=b.length-1;f>-1;f+=-1)if(this.isPerson(b[f])){var g=this._checkNickname(b[f]);g&&c.push(g)}else d=!0,this.institutions[a].push(b[f]),e||(c.reverse(),this.persons[a].push(c),c=[]),e=!1;d&&(c.reverse(),this.persons[a].push(c),this.persons[a].reverse(),this.institutions[a].reverse())},c.NameOutput.prototype._clearValues=function(a){for(var b=a.length-1;b>-1;b+=-1)a.pop()},c.NameOutput.prototype._checkNickname=function(a){if(["interview","personal_communication"].indexOf(this.Item.type)>-1){var b="";if(b=c.Util.Names.getRawName(a),b&&this.state.sys.getAbbreviation&&(!this.item||!this.item["suppress-author"])){this.state.transform.loadAbbreviation("default","nickname",b);var d=this.state.transform.abbrevs["default"].nickname[b];d&&(a="!here>>>"===d?!1:{family:d,given:""})}}return a},c.NameOutput.prototype.joinPersons=function(a,b,c){var d;return d="undefined"==typeof c?1===this.etal_spec[b].freeters?this._joinEtAl(a,"name"):2===this.etal_spec[b].freeters?this._joinEllipsis(a,"name"):this.state.tmp.sort_key_flag?this._join(a," "):this._joinAnd(a,"name"):1===this.etal_spec[b].persons[c]?this._joinEtAl(a,"name"):2===this.etal_spec[b].persons[c]?this._joinEllipsis(a,"name"):this.state.tmp.sort_key_flag?this._join(a," "):this._joinAnd(a,"name")},c.NameOutput.prototype.joinInstitutionSets=function(a,b){var c;return c=1===this.etal_spec[b].institutions?this._joinEtAl(a,"institution"):2===this.etal_spec[b].institutions?this._joinEllipsis(a,"institution"):this._joinAnd(a,"institution")},c.NameOutput.prototype.joinPersonsAndInstitutions=function(a){return this._join(a,this.name.strings.delimiter)},c.NameOutput.prototype.joinFreetersAndInstitutionSets=function(a){var b=this._join(a,"[never here]",this["with"].single,this["with"].multiple);return b},c.NameOutput.prototype._joinEtAl=function(a,b){var c=this._join(a,this.name.strings.delimiter);return this.state.output.openLevel(this._getToken(b)),this.state.output.current.value().strings.delimiter="",this.state.output.append(c,"literal",!0),a.length>1?this.state.output.append(this["et-al"].multiple,"literal",!0):1===a.length&&this.state.output.append(this["et-al"].single,"literal",!0),this.state.output.closeLevel(),this.state.output.pop()},c.NameOutput.prototype._joinEllipsis=function(a,b){return this._join(a,this.name.strings.delimiter,this.name.ellipsis.single,this.name.ellipsis.multiple,b)},c.NameOutput.prototype._joinAnd=function(a,b){return this._join(a,this[b].strings.delimiter,this[b].and.single,this[b].and.multiple,b)},c.NameOutput.prototype._join=function(a,b,d,e,f){var g,h;if(!a)return!1;for(g=a.length-1;g>-1;g+=-1)a[g]&&0!==a[g].length&&a[g].blobs.length||(a=a.slice(0,g).concat(a.slice(g+1)));if(!a.length)return!1;if(d&&2===a.length)d&&(d=new c.Blob(d.blobs,d)),a=[a[0],d,a[1]];else{var i;for(i=e?2:1,g=0,h=a.length-i;h>g;g+=1)a[g].strings.suffix+=b;if(a.length>1){var j=a.pop();e?(e=new c.Blob(e.blobs,e),a.push(e)):(d&&(d=new c.Blob(d.blobs,d)),a.push(d)),a.push(j)}}for(this.state.output.openLevel(this._getToken(f)),d&&e&&(this.state.output.current.value().strings.delimiter=""),g=0,h=a.length;h>g;g+=1)this.state.output.append(a[g],!1,!0);return this.state.output.closeLevel(),this.state.output.pop()},c.NameOutput.prototype._getToken=function(a){var b=this[a];if("institution"===a){var d=new c.Token;return d}return b},c.NameOutput.prototype.setCommonTerm=function(){var a=this.variables,b=a.slice();if(b.sort(),this.common_term=b.join(""),!this.common_term)return!1;var c=!1;if(this.label&&this.label[this.variables[0]]&&(this.label[this.variables[0]].before?c=this.state.getTerm(this.common_term,this.label[this.variables[0]].before.strings.form,0):this.label[this.variables[0]].after&&(c=this.state.getTerm(this.common_term,this.label[this.variables[0]].after.strings.form,0))),!this.state.locale[this.state.opt.lang].terms[this.common_term]||!c||this.variables.length<2)return void(this.common_term=!1);for(var d=0,e=0,f=this.variables.length-1;f>e;e+=1){var g=this.variables[e],h=this.variables[e+1];if(this.freeters[g].length||this.freeters[h].length){if(this.etal_spec[g].freeters!==this.etal_spec[h].freeters||!this._compareNamesets(this.freeters[g],this.freeters[h]))return void(this.common_term=!1);d+=1}for(var i=0,j=this.persons[g].length;j>i;i+=1)if(this.etal_spec[g].persons[i]!==this.etal_spec[h].persons[i]||!this._compareNamesets(this.persons[g][i],this.persons[h][i]))return void(this.common_term=!1)}},c.NameOutput.prototype._compareNamesets=function(a,b){if(a.length!==b.length)return!1;for(var d=0,e=b.length;e>d;d+=1)for(var f=(b[d],0),g=c.NAME_PARTS.length;g>f;f+=1){var h=c.NAME_PARTS[f];if(!a[d]||a[d][h]!=b[d][h])return!1}return!0},c.NameOutput.prototype.constrainNames=function(){this.names_count=0;for(var a,b=0,c=this.variables.length;c>b;b+=1){var d=this.variables[b];a=this.nameset_base+b,this.freeters[d].length&&(this.state.tmp.names_max.push(this.freeters[d].length,"literal"),this._imposeNameConstraints(this.freeters,this.freeters_count,d,a),this.names_count+=this.freeters[d].length),this.institutions[d].length&&(this.state.tmp.names_max.push(this.institutions[d].length,"literal"),this._imposeNameConstraints(this.institutions,this.institutions_count,d,a),this.persons[d]=this.persons[d].slice(0,this.institutions[d].length),this.names_count+=this.institutions[d].length);for(var e=0,f=this.persons[d].length;f>e;e+=1)this.persons[d][e].length&&(this.state.tmp.names_max.push(this.persons[d][e].length,"literal"),this._imposeNameConstraints(this.persons[d],this.persons_count[d],e,a),this.names_count+=this.persons[d][e].length)}},c.NameOutput.prototype._imposeNameConstraints=function(a,b,c,d){var e=a[c],f=this.state.tmp["et-al-min"];this.state.tmp.suppress_decorations?this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[d]?f=this.state.tmp.disambig_request.names[d]:b[c]>=this.etal_min&&(f=this.etal_use_first):(this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[d]>this.etal_use_first?f=b[c]<this.etal_min?b[c]:this.state.tmp.disambig_request.names[d]:b[c]>=this.etal_min&&(f=this.etal_use_first),this.etal_use_last&&f>this.etal_min-2&&(f=this.etal_min-2));var g=this.etal_min>=this.etal_use_first,h=b[c]>f;f>b[c]&&(f=e.length),g&&h&&(this.etal_use_last?a[c]=e.slice(0,f).concat(e.slice(-1)):a[c]=e.slice(0,f)),this.state.tmp.disambig_settings.names[d]=a[c].length,this.state.disambiguate.padBase(this.state.tmp.disambig_settings)},c.NameOutput.prototype.disambigNames=function(){for(var a,b=0,c=this.variables.length;c>b;b+=1){var d=this.variables[b];if(a=this.nameset_base+b,this.freeters[d].length&&this._runDisambigNames(this.freeters[d],a),this.institutions[d].length){"undefined"==typeof this.state.tmp.disambig_settings.givens[a]&&(this.state.tmp.disambig_settings.givens[a]=[]);for(var e=0,f=this.institutions[d].length;f>e;e+=1)"undefined"==typeof this.state.tmp.disambig_settings.givens[a][e]&&this.state.tmp.disambig_settings.givens[a].push(2)}for(var e=0,f=this.persons[d].length;f>e;e+=1)this.persons[d][e].length&&this._runDisambigNames(this.persons[d][e],a)}},c.NameOutput.prototype._runDisambigNames=function(a,b){var d,e,f,g,h,i,j;for(h=0,i=a.length;i>h;h+=1)if(a[h].given||a[h].family){if(f=this.name.strings["initialize-with"],this.state.registry.namereg.addname(""+this.Item.id,a[h],h),d=this.state.tmp.disambig_settings.givens[b],"undefined"==typeof d)for(var k=0,l=b+1;l>k;k+=1)this.state.tmp.disambig_settings.givens[k]||(this.state.tmp.disambig_settings.givens[k]=[]);if(d=this.state.tmp.disambig_settings.givens[b][h],"undefined"==typeof d&&(e=this.name.strings.form,g=this.state.registry.namereg.evalname(""+this.Item.id,a[h],h,0,e,f),this.state.tmp.disambig_settings.givens[b].push(g)),e=this.name.strings.form,j=this.state.registry.namereg.evalname(""+this.Item.id,a[h],h,0,e,f),this.state.tmp.disambig_request){var m=this.state.tmp.disambig_settings.givens[b][h];1!==m||"by-cite"!==this.state.citation.opt["givenname-disambiguation-rule"]||"undefined"!=typeof this.name.strings["initialize-with"]&&"undefined"!=typeof a[h].given||(m=2),g=m,this.state.opt["disambiguate-add-givenname"]&&a[h].given&&(g=this.state.registry.namereg.evalname(""+this.Item.id,a[h],h,g,this.name.strings.form,this.name.strings["initialize-with"]))}else g=j;!this.state.tmp.just_looking&&this.item&&this.item.position===c.POSITION_FIRST&&j>g&&(g=j),this.state.tmp.sort_key_flag||(this.state.tmp.disambig_settings.givens[b][h]=g,"string"!=typeof f||"undefined"!=typeof this.name.strings.initialize&&!0!==this.name.strings.initialize||(this.state.tmp.disambig_settings.use_initials=!0))}},c.NameOutput.prototype.getEtAlConfig=function(){var a=this.item;this["et-al"]={},this.state.output.append(this.etal_term,this.etal_style,!0),this["et-al"].single=this.state.output.pop(),this["et-al"].single.strings.suffix=this.etal_suffix,this["et-al"].single.strings.prefix=this.etal_prefix_single,this.state.output.append(this.etal_term,this.etal_style,!0),this["et-al"].multiple=this.state.output.pop(),this["et-al"].multiple.strings.suffix=this.etal_suffix,this["et-al"].multiple.strings.prefix=this.etal_prefix_multiple,"undefined"==typeof a&&(a={}),a.position?(this.name.strings["et-al-subsequent-min"]?this.etal_min=this.name.strings["et-al-subsequent-min"]:this.etal_min=this.name.strings["et-al-min"],this.name.strings["et-al-subsequent-use-first"]?this.etal_use_first=this.name.strings["et-al-subsequent-use-first"]:this.etal_use_first=this.name.strings["et-al-use-first"]):(this.state.tmp["et-al-min"]?this.etal_min=this.state.tmp["et-al-min"]:this.etal_min=this.name.strings["et-al-min"],this.state.tmp["et-al-use-first"]?this.etal_use_first=this.state.tmp["et-al-use-first"]:this.etal_use_first=this.name.strings["et-al-use-first"],"boolean"==typeof this.state.tmp["et-al-use-last"]?this.etal_use_last=this.state.tmp["et-al-use-last"]:this.etal_use_last=this.name.strings["et-al-use-last"]),this.state.tmp["et-al-min"]||(this.state.tmp["et-al-min"]=this.etal_min)},c.NameOutput.prototype.setEtAlParameters=function(){var a,b,c,d;for(a=0,b=this.variables.length;b>a;a+=1){var e=this.variables[a];for("undefined"==typeof this.etal_spec[e]&&(this.etal_spec[e]={freeters:0,institutions:0,persons:[]}),this.etal_spec[this.nameset_base+a]=this.etal_spec[e],this.freeters[e].length&&this._setEtAlParameter("freeters",e),c=0,d=this.persons[e].length;d>c;c+=1)"undefined"==typeof this.etal_spec[e][c]&&(this.etal_spec[e].persons[c]=0),this._setEtAlParameter("persons",e,c);this.institutions[e].length&&this._setEtAlParameter("institutions",e)}},c.NameOutput.prototype._setEtAlParameter=function(a,b,c){var d,e;"persons"===a?(d=this.persons[b][c],e=this.persons_count[b][c]):(d=this[a][b],e=this[a+"_count"][b]),d.length<e&&!this.state.tmp.sort_key_flag?this.etal_use_last?"persons"===a?this.etal_spec[b].persons[c]=2:this.etal_spec[b][a]=2:"persons"===a?this.etal_spec[b].persons[c]=1:this.etal_spec[b][a]=1:"persons"===a?this.etal_spec[b].persons[c]=0:this.etal_spec[b][a]=0},c.NameOutput.prototype.renderAllNames=function(){for(var a,b=0,c=this.variables.length;c>b;b+=1){var d=this.variables[b];a=this.nameset_base+b,this.freeters[d].length&&(this.freeters[d]=this._renderPersonalNames(this.freeters[d],a));for(var e=0,f=this.institutions[d].length;f>e;e+=1)this.persons[d][e]=this._renderPersonalNames(this.persons[d][e],a,e)}this.renderInstitutionNames()},c.NameOutput.prototype.renderInstitutionNames=function(){for(var a=0,b=this.variables.length;b>a;a+=1)for(var c=this.variables[a],d=0,e=this.institutions[c].length;e>d;d+=1){var f,g,h,i,j,d,e,k,l=this.institutions[c][d];if(k=this.state.tmp.extension?["sort"]:l.isInstitution?this.state.opt["cite-lang-prefs"].institutions:this.state.opt["cite-lang-prefs"].persons,slot={primary:"locale-orig",secondary:!1,tertiary:!1},k)for(var m=["primary","secondary","tertiary"],n=0,o=m.length;o>n&&!(k.length-1<n);n+=1)k[n]&&(slot[m[n]]="locale-"+k[n]);else slot.primary="locale-translat";"bibliography"===this.state.tmp.area||"citation"===this.state.tmp.area&&"note"===this.state.opt.xclass&&this.item&&!this.item.position||(slot.secondary=!1,slot.tertiary=!1);var p;this.setRenderedName(l),p=this.getName(l,slot.primary,!0);var q=p.name,r=p.usedOrig;switch(q&&(q=this.fixupInstitution(q,c,d)),secondary=!1,slot.secondary&&(p=this.getName(l,slot.secondary,!1,r),secondary=p.name,r=p.usedOrig,secondary&&(secondary=this.fixupInstitution(secondary,c,d))),tertiary=!1,slot.tertiary&&(p=this.getName(l,slot.tertiary,!1,r),tertiary=p.name,tertiary&&(tertiary=this.fixupInstitution(tertiary,c,d))),this.institution.strings["institution-parts"]){case"short":q["short"].length?(i=this._getShortStyle(),f=[this._renderOneInstitutionPart(q["short"],i)]):(j=this._getLongStyle(q,c,d),f=[this._renderOneInstitutionPart(q["long"],j)]);break;case"short-long":j=this._getLongStyle(q,c,d),i=this._getShortStyle(),g=this._renderOneInstitutionPart(q["short"],i),h=this._composeOneInstitutionPart([q,secondary,tertiary],slot,j),f=[g,h];break;case"long-short":j=this._getLongStyle(q,c,d),i=this._getShortStyle(),g=this._renderOneInstitutionPart(q["short"],i),h=this._composeOneInstitutionPart([q,secondary,tertiary],slot,j,!0),f=[h,g];break;default:j=this._getLongStyle(q,c,d),f=[this._composeOneInstitutionPart([q,secondary,tertiary],slot,j)]}this.institutions[c][d]=this._join(f,"")}},c.NameOutput.prototype._composeOneInstitutionPart=function(a,b,d){var e=!1,f=!1,g=!1;a[0]&&(e=this._renderOneInstitutionPart(a[0]["long"],d)),a[1]&&(f=this._renderOneInstitutionPart(a[1]["long"],d)),a[2]&&(g=this._renderOneInstitutionPart(a[2]["long"],d));var h;return f||g?(this.state.output.openLevel("empty"),this.state.output.append(e),secondary_tok=c.Util.cloneToken(d),b.secondary&&(secondary_tok.strings.prefix=this.state.opt.citeAffixes.institutions[b.secondary].prefix,secondary_tok.strings.suffix=this.state.opt.citeAffixes.institutions[b.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ")),this.state.output.append(f,secondary_tok),tertiary_tok=c.Util.cloneToken(d),b.tertiary&&(tertiary_tok.strings.prefix=this.state.opt.citeAffixes.institutions[b.tertiary].prefix,tertiary_tok.strings.suffix=this.state.opt.citeAffixes.institutions[b.tertiary].suffix,tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ")),this.state.output.append(g,tertiary_tok),this.state.output.closeLevel(),h=this.state.output.pop()):h=e,h},c.NameOutput.prototype._renderOneInstitutionPart=function(a,b){for(var d=0,e=a.length;e>d;d+=1)if(a[d]){var f=a[d];if(this.state.tmp.strip_periods)f=f.replace(/\./g,"");else for(var g=0,h=b.decorations.length;h>g;g+=1)if("@strip-periods"===b.decorations[g][0]&&"true"===b.decorations[g][1]){f=f.replace(/\./g,"");break}this.state.tmp.group_context.value()[2]=!0,this.state.tmp.can_substitute.replace(!1,c.LITERAL),"!here>>>"===f?a[d]=!1:(this.state.output.append(f,b,!0),a[d]=this.state.output.pop())}return"undefined"==typeof this.institution.strings["part-separator"]&&(this.institution.strings["part-separator"]=this.name.strings.delimiter),this._join(a,this.institution.strings["part-separator"])},c.NameOutput.prototype._renderPersonalNames=function(a,b,d){var e=!1;if(a.length){for(var f=[],g=0,h=a.length;h>g;g+=1){var e,i,j=a[g];if(i=this.state.tmp.extension?["sort"]:j.isInstitution?this.state.opt["cite-lang-prefs"].institutions:this.state.opt["cite-lang-prefs"].persons,slot={primary:"locale-orig",secondary:!1,tertiary:!1},i)for(var k=["primary","secondary","tertiary"],l=0,m=k.length;m>l&&!(i.length-1<l);l+=1)slot[k[l]]="locale-"+i[l];else slot.primary="locale-translat";(this.state.tmp.sort_key_flag||"bibliography"!==this.state.tmp.area&&("citation"!==this.state.tmp.area||"note"!==this.state.opt.xclass||!this.item||this.item.position))&&(slot.secondary=!1,slot.tertiary=!1),this.setRenderedName(j);var n=this.getName(j,slot.primary,!0),o=this._renderOnePersonalName(n.name,b,g,d);secondary=!1,slot.secondary&&(n=this.getName(j,slot.secondary,!1,n.usedOrig),n.name&&(secondary=this._renderOnePersonalName(n.name,b,g,d))),tertiary=!1,slot.tertiary&&(n=this.getName(j,slot.tertiary,!1,n.usedOrig),n.name&&(tertiary=this._renderOnePersonalName(n.name,b,g,d)));var p;secondary||tertiary?(this.state.output.openLevel("empty"),this.state.output.append(o),secondary_tok=new c.Token,slot.secondary&&(secondary_tok.strings.prefix=this.state.opt.citeAffixes.persons[slot.secondary].prefix,secondary_tok.strings.suffix=this.state.opt.citeAffixes.persons[slot.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ")),this.state.output.append(secondary,secondary_tok),tertiary_tok=new c.Token,slot.tertiary&&(tertiary_tok.strings.prefix=this.state.opt.citeAffixes.persons[slot.tertiary].prefix,tertiary_tok.strings.suffix=this.state.opt.citeAffixes.persons[slot.tertiary].suffix,
tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ")),this.state.output.append(tertiary,tertiary_tok),this.state.output.closeLevel(),p=this.state.output.pop()):p=o,f.push(p)}e=this.joinPersons(f,b,d)}return e},c.NameOutput.prototype._isRomanesque=function(a){var b=2;if(a.family.replace('"',"","g").match(c.ROMANESQUE_REGEXP)||(b=0),!b&&a.given&&a.given.match(c.STARTSWITH_ROMANESQUE_REGEXP)&&(b=1),2==b){if(a.multi&&a.multi.main)var d=a.multi.main.slice(0,2);else this.Item.language&&(d=this.Item.language.slice(0,2));["ja","zh"].indexOf(d)>-1&&(b=1)}return b},c.NameOutput.prototype._renderOnePersonalName=function(a,b,d,e){var f=a,g=this._droppingParticle(f,b,e),h=this._familyName(f),i=this._nonDroppingParticle(f),j=this._givenName(f,b,d),k=this._nameSuffix(f);this._isShort(b,d)&&!f["full-form-always"]&&(g=!1,j=!1,k=!1);var l=this.name.strings["sort-separator"];l||(l="");var m;m=f["comma-suffix"]?", ":" ";var n,o,p,q,r=this._isRomanesque(f),s=i&&"-"===i.blobs.slice(-1);return 0===r?n=this._join([i,h,j],""):1===r||f["static-ordering"]?n=this._join([i,h,j]," "):f["reverse-ordering"]?n=this._join([j,i,h]," "):this.state.tmp.sort_key_flag?"never"===this.state.opt["demote-non-dropping-particle"]?(p=this._join([i,h,g]," "),o=this._join([p,j]," "),n=this._join([o,k]," ")):(q=this._join([j,g,i]," "),o=this._join([h,q]," "),n=this._join([o,k]," ")):"all"===this.name.strings["name-as-sort-order"]||"first"===this.name.strings["name-as-sort-order"]&&0===d&&(0===e||"undefined"==typeof e)?(["Lord","Lady"].indexOf(f.given)>-1&&(l=", "),["always","display-and-sort"].indexOf(this.state.opt["demote-non-dropping-particle"])>-1&&!s?(q=this._join([j,g],f["comma-dropping-particle"]+" "),q=this._join([q,i]," "),q&&this.given&&(q.strings.prefix=this.given.strings.prefix,q.strings.suffix=this.given.strings.suffix),h&&this.family&&(h.strings.prefix=this.family.strings.prefix,h.strings.suffix=this.family.strings.suffix),o=this._join([h,q],l),n=this._join([o,k],l)):("bibliography"===this.state.tmp.area&&!this.state.tmp.term_predecessor&&i&&(s||(i.blobs=c.Output.Formatters["capitalize-first"](this.state,i.blobs))),p=s?this._join([i,h],""):this._join([i,h]," "),p&&this.family&&(p.strings.prefix=this.family.strings.prefix,p.strings.suffix=this.family.strings.suffix),q=this._join([j,g],f["comma-dropping-particle"]+" "),q&&this.given&&(q.strings.prefix=this.given.strings.prefix,q.strings.suffix=this.given.strings.suffix),o=this._join([p,q],l),n=this._join([o,k],l))):(f["dropping-particle"]&&f.family&&!f["non-dropping-particle"]&&["'","ʼ","’"].indexOf(f["dropping-particle"].slice(-1))>-1&&(h=this._join([g,h],""),g=!1),this.state.tmp.term_predecessor||j||"bibliography"!==this.state.tmp.area||(!g&&i?s||(i.blobs=c.Output.Formatters["capitalize-first"](this.state,i.blobs)):g&&(g.blobs=c.Output.Formatters["capitalize-first"](this.state,g.blobs))),s?(q=this._join([i,h],""),q=this._join([g,q]," ")):q=this._join([g,i,h]," "),q=this._join([q,k],m),q&&this.family&&(q.strings.prefix=this.family.strings.prefix,q.strings.suffix=this.family.strings.suffix),j&&this.given&&(j.strings.prefix=this.given.strings.prefix,j.strings.suffix=this.given.strings.suffix),q.strings.prefix&&(f["comma-dropping-particle"]=""),n=this._join([j,q],f["comma-dropping-particle"]+" ")),this.state.tmp.group_context.value()[2]=!0,this.state.tmp.can_substitute.replace(!1,c.LITERAL),this.state.tmp.term_predecessor=!0,this.state.tmp.name_node.children.push(n),n},c.NameOutput.prototype._isShort=function(a,b){return 0===this.state.tmp.disambig_settings.givens[a][b]?!0:!1},c.NameOutput.prototype._normalizeNameInput=function(a){var b={literal:a.literal,family:a.family,isInstitution:a.isInstitution,given:a.given,suffix:a.suffix,"comma-suffix":a["comma-suffix"],"non-dropping-particle":a["non-dropping-particle"],"dropping-particle":a["dropping-particle"],"static-ordering":a["static-ordering"],"reverse-ordering":a["reverse-ordering"],"full-form-always":a["full-form-always"],"parse-names":a["parse-names"],"comma-dropping-particle":"",block_initialize:a.block_initialize,multi:a.multi};return this._parseName(b),b},c.NameOutput.prototype._stripPeriods=function(a,b){var c=this[a+"_decor"];if(b)if(this.state.tmp.strip_periods)b=b.replace(/\./g,"");else if(c)for(var d=0,e=c.decorations.length;e>d;d+=1)if("@strip-periods"===c.decorations[d][0]&&"true"===c.decorations[d][1]){b=b.replace(/\./g,"");break}return b},c.NameOutput.prototype._nonDroppingParticle=function(a){var b=a["non-dropping-particle"];b&&this.state.tmp.sort_key_flag&&(b=b.replace(/[\'\u2019]/,""));var c=this._stripPeriods("family",b);return this.state.output.append(c,this.family_decor,!0)?this.state.output.pop():!1},c.NameOutput.prototype._droppingParticle=function(a,b,c){var d=a["dropping-particle"];d&&this.state.tmp.sort_key_flag&&(d=d.replace(/[\'\u2019]/,""));var e=this._stripPeriods("given",d);if(a["dropping-particle"]&&a["dropping-particle"].match(/^et.?al[^a-z]$/))this.name.strings["et-al-use-last"]?"undefined"==typeof c?this.etal_spec[b].freeters=2:this.etal_spec[b].persons=2:"undefined"==typeof c?this.etal_spec[b].freeters=1:this.etal_spec[b].persons=1,a["comma-dropping-particle"]="";else if(this.state.output.append(e,this.given_decor,!0))return this.state.output.pop();return!1},c.NameOutput.prototype._familyName=function(a){var b=this._stripPeriods("family",a.family);return this.state.output.append(b,this.family_decor,!0)?this.state.output.pop():!1},c.NameOutput.prototype._givenName=function(a,b,d){if(this.name.strings.initialize===!1)a.family&&a.given&&this.name.strings.initialize===!1&&(a.given=c.Util.Names.initializeWith(this.state,a.given,this.name.strings["initialize-with"],!0)),a.given=c.Util.Names.unInitialize(this.state,a.given);else if(a.family&&1===this.state.tmp.disambig_settings.givens[b][d]&&!a.block_initialize){var e=this.name.strings["initialize-with"];a.given=c.Util.Names.initializeWith(this.state,a.given,e)}else a.given=c.Util.Names.unInitialize(this.state,a.given);var f=this._stripPeriods("given",a.given);return this.state.output.append(f,this.given_decor,!0)?this.state.output.pop():!1},c.NameOutput.prototype._nameSuffix=function(a){var b=a.suffix;return"string"==typeof this.name.strings["initialize-with"]&&(b=c.Util.Names.initializeWith(this.state,a.suffix,this.name.strings["initialize-with"],!0)),b=this._stripPeriods("family",b),this.state.output.append(b,"empty",!0)?this.state.output.pop():!1},c.NameOutput.prototype._getLongStyle=function(a,b,d){var e;return e=a["short"].length&&this.institutionpart["long-with-short"]?this.institutionpart["long-with-short"]:this.institutionpart["long"],e||(e=new c.Token),e},c.NameOutput.prototype._getShortStyle=function(){var a;return a=this.institutionpart["short"]?this.institutionpart["short"]:new c.Token},c.NameOutput.prototype._parseName=function(a){var b,c;if(!a["parse-names"]&&"undefined"!=typeof a["parse-names"])return a;a.family&&!a.given&&a.isInstitution&&(a.literal=a.family,a.family=void 0,a.isInstitution=void 0);var d;if(a.family&&'"'===a.family.slice(0,1)&&'"'===a.family.slice(-1)||!a["parse-names"]&&"undefined"!=typeof a["parse-names"]?(a.family=a.family.slice(1,-1),d=!0,a["parse-names"]=0):d=!1,!a["non-dropping-particle"]&&a.family&&!d&&a.given&&(b=a.family.match(/^((?:[\'\u2019a-z][ \'\u2019a-z]*[-\s\'\u2019]+|[ABDVL][^ ][-\s]+[a-z]*\s*|[ABDVL][^ ][^ ][-\s]+[a-z]*\s*))/),b&&(a.family=a.family.slice(b[1].length),a["non-dropping-particle"]=b[1].replace(/\s+$/,"").replace("'","’"))),!a.suffix&&a.given&&(b=a.given.match(/(\s*,!*\s*)/))){c=a.given.indexOf(b[1]);var e=a.given.slice(c+b[1].length),f=a.given.slice(c,c+b[1].length).replace(/\s*/g,"");e.length<=3?(2===f.length&&(a["comma-suffix"]=!0),a.suffix=e):!a["dropping-particle"]&&a.given&&(a["dropping-particle"]=e,a["comma-dropping-particle"]=","),a.given=a.given.slice(0,c)}!a["dropping-particle"]&&a.given&&(b=a.given.match(/(\s+)([a-z][ \'\u2019a-z]*)$/),b&&(a.given=a.given.slice(0,-1*(b[1].length+b[2].length)),a["dropping-particle"]=b[2]))},c.NameOutput.prototype.getName=function(a,b,c,d){if(d&&"locale-orig"===b)return{name:!1,usedOrig:d};a.family||(a.family=""),a.given||(a.given="");var e={};e["static-ordering"]=this.getStaticOrder(a);var f=!0;if("locale-orig"!==b&&(f=!1,a.multi)){var g=this.state.opt[b];for(i=0,ilen=g.length;i<ilen;i+=1)if(h=g[i],a.multi._key[h]){f=!0,a=a.multi._key[h],e=this.getNameParams(h),e.transliterated=!0;break}}if(!f){var h=!1;a.multi&&a.multi.main?h=a.multi.main:this.Item.language&&(h=this.Item.language),h&&(e=this.getNameParams(h))}if(!c&&!f)return{name:!1,usedOrig:d};a.family||(a.family=""),a.given||(a.given=""),a={family:a.family,given:a.given,"non-dropping-particle":a["non-dropping-particle"],"dropping-particle":a["dropping-particle"],suffix:a.suffix,"static-ordering":e["static-ordering"],"reverse-ordering":e["reverse-ordering"],"full-form-always":e["full-form-always"],"parse-names":a["parse-names"],"comma-suffix":a["comma-suffix"],"comma-dropping-particle":a["comma-dropping-particle"],transliterated:e.transliterated,block_initialize:e["block-initialize"],literal:a.literal,isInstitution:a.isInstitution,multi:a.multi},!a.literal&&!a.given&&a.family&&a.isInstitution&&(a.literal=a.family),a.literal&&(delete a.family,delete a.given),a=this._normalizeNameInput(a);var j;return j=d?d:!f,{name:a,usedOrig:j}},c.NameOutput.prototype.getNameParams=function(a){var b={},d=c.localeResolve(this.Item.language,this.state.opt["default-locale"][0]),e=this.state.locale[d.best]?d.best:this.state.opt["default-locale"][0],f=this.state.locale[e].opts["name-as-sort-order"],g=this.state.locale[e].opts["name-as-reverse-order"],h=this.state.locale[e].opts["name-never-short"],i=a.split("-")[0];return f&&f[i]&&(b["static-ordering"]=!0,b["reverse-ordering"]=!1),g&&g[i]&&(b["reverse-ordering"]=!0,b["static-ordering"]=!1),h&&h[i]&&(b["full-form-always"]=!0),b["static-ordering"]&&(b["block-initialize"]=!0),b},c.NameOutput.prototype.setRenderedName=function(a){if("bibliography"===this.state.tmp.area){for(var b="",d=0,e=c.NAME_PARTS.length;e>d;d+=1)a[c.NAME_PARTS[d]]&&(b+=a[c.NAME_PARTS[d]]);this.state.tmp.rendered_name.push(b)}},c.NameOutput.prototype.fixupInstitution=function(a,b,c){a=this._splitInstitution(a,b,c),this.institution.strings["reverse-order"]&&a["long"].reverse();var d=a["long"],e=d.slice();if(this.state.sys.getAbbreviation)for(var f=this.Item.jurisdiction,g=0,h=d.length;h>g;g+=1)f=this.state.transform.loadAbbreviation(f,"institution-part",d[g]),this.state.transform.abbrevs[f]["institution-part"][d[g]]&&(e[g]=this.state.transform.abbrevs[f]["institution-part"][d[g]]);return a["short"]=e,a},c.NameOutput.prototype.getStaticOrder=function(a,b){var d=!1;return!b&&a["static-ordering"]?d=!0:0===this._isRomanesque(a)?d=!0:(!a.multi||!a.multi.main)&&this.Item.language&&["vi","hu"].indexOf(this.Item.language)>-1?d=!0:a.multi&&a.multi.main&&["vi","hu"].indexOf(a.multi.main.slice(0,2))>-1?d=!0:this.state.opt["auto-vietnamese-names"]&&c.VIETNAMESE_NAMES.exec(a.family+" "+a.given)&&c.VIETNAMESE_SPECIALS.exec(a.family+a.given)&&(d=!0),d},c.NameOutput.prototype._splitInstitution=function(a,b,c){var d={},e=a.literal.replace(/\s*\|\s*/g,"|");if(e=e.split("|"),"short"===this.institution.strings.form&&this.state.sys.getAbbreviation)for(var f=this.Item.jurisdiction,g=e.length;g>0;g+=-1){var h=e.slice(0,g).join("|");if(f=this.state.transform.loadAbbreviation(f,"institution-entire",h),this.state.transform.abbrevs[f]["institution-entire"][h]){var i=this.state.transform.abbrevs[f]["institution-entire"][h];i=this.state.transform.quashCheck(i);var j=i.split(/>>[0-9]{4}>>/),k=i.match(/>>([0-9]{4})>>/);if(i=j.pop(),j.length>0&&this.Item["original-date"]&&this.Item["original-date"].year)for(var l=k.length-1;l>0&&!(parseInt(this.Item["original-date"].year,10)>=parseInt(k[l],10));l+=-1)i=j.pop();i=i.replace(/\s*\|\s*/g,"|"),e=[i]}}return e.reverse(),d["long"]=this._trimInstitution(e,b,c),d},c.NameOutput.prototype._trimInstitution=function(a,b,c){var d=!1,e=!1,f=!1,g=a.slice();return this.institution&&("undefined"!=typeof this.institution.strings["use-first"]&&(d=this.institution.strings["use-first"]),"undefined"!=typeof this.institution.strings["stop-last"]&&(g=g.slice(0,this.institution.strings["stop-last"]),a=a.slice(0,this.institution.strings["stop-last"])),"undefined"!=typeof this.institution.strings["use-last"]&&(e=this.institution.strings["use-last"])),!1===d&&(0===this.persons[b].length&&(d=this.institution.strings["substitute-use-first"]),d||(d=0)),!1===e&&(e=d?0:a.length),d>a.length-e&&(d=a.length-e),f&&(e=0),a=a.slice(0,d),g=g.slice(d),e&&(e>g.length&&(e=g.length),e&&(a=a.concat(g.slice(g.length-e)))),a},c.PublisherOutput=function(a,b){this.state=a,this.group_tok=b,this.varlist=[]},c.PublisherOutput.prototype.render=function(){this.clearVars(),this.composeAndBlob(),this.composeElements(),this.composePublishers(),this.joinPublishers()},c.PublisherOutput.prototype.composeAndBlob=function(){this.and_blob={};var a=!1;"text"===this.group_tok.strings.and?a=this.state.getTerm("and"):"symbol"===this.group_tok.strings.and&&(a="&");var b=new c.Token;b.strings.suffix=" ",b.strings.prefix=" ",this.state.output.append(a,b,!0);var d=this.state.output.pop();b.strings.prefix=this.group_tok.strings["subgroup-delimiter"],this.state.output.append(a,b,!0);var e=this.state.output.pop();this.and_blob.single=!1,this.and_blob.multiple=!1,a&&("always"===this.group_tok.strings["subgroup-delimiter-precedes-last"]?this.and_blob.single=e:"never"===this.group_tok.strings["subgroup-delimiter-precedes-last"]?(this.and_blob.single=d,this.and_blob.multiple=d):(this.and_blob.single=d,this.and_blob.multiple=e))},c.PublisherOutput.prototype.composeElements=function(){for(var a=0,b=2;b>a;a+=1)for(var c=["publisher","publisher-place"][a],d=0,e=this["publisher-list"].length;e>d;d+=1){var f=this[c+"-list"][d],g=this[c+"-token"];this.state.output.append(f,g,!0),this[c+"-list"][d]=this.state.output.pop()}},c.PublisherOutput.prototype.composePublishers=function(){for(var a,b=0,c=this["publisher-list"].length;c>b;b+=1){a=[this[this.varlist[0]+"-list"][b],this[this.varlist[1]+"-list"][b]],this["publisher-list"][b]=this._join(a,this.group_tok.strings.delimiter)}},c.PublisherOutput.prototype.joinPublishers=function(){var a=this["publisher-list"],b=(this.name_delimiter,this._join(a,this.group_tok.strings["subgroup-delimiter"],this.and_blob.single,this.and_blob.multiple,this.group_tok));this.state.output.append(b,"literal")},c.PublisherOutput.prototype._join=c.NameOutput.prototype._join,c.PublisherOutput.prototype._getToken=c.NameOutput.prototype._getToken,c.PublisherOutput.prototype.clearVars=function(){this.state.tmp["publisher-list"]=!1,this.state.tmp["publisher-place-list"]=!1,this.state.tmp["publisher-group-token"]=!1,this.state.tmp["publisher-token"]=!1,this.state.tmp["publisher-place-token"]=!1},c.evaluateLabel=function(a,b,d,e){var f;"locator"===a.strings.term?(e&&e.label&&(f="sub verbo"===e.label?"sub-verbo":e.label),f||(f="page")):f=a.strings.term;var g=a.strings.plural;return e&&"number"==typeof e.force_pluralism?g=e.force_pluralism:"number"!=typeof g&&("locator"===a.strings.term?e&&e.locator&&(b.opt.development_extensions.locator_parsing_for_plurals?(b.tmp.shadow_numbers.locator||b.processNumber(!1,e,"locator",d.type),g=b.tmp.shadow_numbers.locator.plural):g=c.evaluateStringPluralism(e.locator)):["page","page-first"].indexOf(a.variables[0])>-1?(b.processNumber(!1,d,f,d.type),g=b.tmp.shadow_numbers[f].plural,f=b.tmp.shadow_numbers[f].label):(b.tmp.shadow_numbers[f]||b.processNumber(!1,d,f,d.type),g=b.tmp.shadow_numbers[f].plural),a.decorations&&(b.opt.development_extensions.csl_reverse_lookup_support||b.sys.csl_reverse_lookup_support)&&(a.decorations.reverse(),a.decorations.push(["@showid","true",a.cslid]),a.decorations.reverse())),c.castLabel(b,a,f,g,c.TOLERANT)},c.evaluateStringPluralism=function(a){if(a){var b=a.match(/(?:[0-9],\s*[0-9]|\s+and\s+|&|([0-9]+)\s*[\-\u2013]\s*([0-9]+))/);if(b&&(!b[1]||parseInt(b[1],10)<parseInt(b[2],10)))return 1}return 0},c.castLabel=function(a,b,c,d,e){var f=b.strings.form;a.tmp.group_context.value()[5]&&(f=a.tmp.group_context.value()[5]);var g=a.getTerm(c,f,d,!1,e);if(a.tmp.strip_periods)g=g.replace(/\./g,"");else for(var h=0,i=b.decorations.length;i>h;h+=1)if("@strip-periods"===b.decorations[h][0]&&"true"===b.decorations[h][1]){g=g.replace(/\./g,"");break}return g},c.Node.name={build:function(a,b){var d;[c.SINGLETON,c.START].indexOf(this.tokentype)>-1&&(a.fixOpt(this,"name-delimiter","name_delimiter"),a.fixOpt(this,"name-form","form"),a.fixOpt(this,"and","and"),a.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),a.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),a.fixOpt(this,"initialize-with","initialize-with"),a.fixOpt(this,"initialize","initialize"),a.fixOpt(this,"name-as-sort-order","name-as-sort-order"),a.fixOpt(this,"sort-separator","sort-separator"),a.fixOpt(this,"and","and"),a.fixOpt(this,"et-al-min","et-al-min"),a.fixOpt(this,"et-al-use-first","et-al-use-first"),a.fixOpt(this,"et-al-use-last","et-al-use-last"),a.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),a.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first"),this.strings["et-al-subsequent-min"]&&this.strings["et-al-subsequent-min"]!==this.strings["et-al-min"]&&(a.opt.update_mode=c.POSITION),this.strings["et-al-subsequent-use-first"]&&this.strings["et-al-subsequent-use-first"]!==this.strings["et-al-use-first"]&&(a.opt.update_mode=c.POSITION),"undefined"==typeof this.strings.name_delimiter?this.strings.delimiter=", ":this.strings.delimiter=this.strings.name_delimiter,this.strings["et-al-use-last"]&&(this.ellipsis_term="…",this.ellipsis_prefix_single=" ",this.ellipsis_prefix_multiple=this.strings.delimiter,this.ellipsis_suffix=" "),d=function(a,b){a.tmp.etal_term="et-al",a.tmp.name_delimiter=this.strings.delimiter,a.tmp["delimiter-precedes-et-al"]=this.strings["delimiter-precedes-et-al"],"text"===this.strings.and?this.and_term=a.getTerm("and","long",0):"symbol"===this.strings.and&&(a.opt.development_extensions.expect_and_symbol_form?this.and_term=a.getTerm("and","symbol",0):this.and_term="&"),a.tmp.and_term=this.and_term,c.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)?(this.and_prefix_single=" ",this.and_prefix_multiple=", ","string"==typeof this.strings.delimiter&&(this.and_prefix_multiple=this.strings.delimiter),this.and_suffix=" ",a.build.name_delimiter=this.strings.delimiter):(this.and_prefix_single="",this.and_prefix_multiple="",this.and_suffix=""),"always"===this.strings["delimiter-precedes-last"]?this.and_prefix_single=this.strings.delimiter:"never"===this.strings["delimiter-precedes-last"]?this.and_prefix_multiple&&(this.and_prefix_multiple=" "):"after-inverted-name"===this.strings["delimiter-precedes-last"]&&(this.and_prefix_single&&(this.and_prefix_single=this.strings.delimiter),this.and_prefix_multiple&&(this.and_prefix_multiple=" ")),this.and={},this.strings.and?(a.output.append(this.and_term,"empty",!0),this.and.single=a.output.pop(),this.and.single.strings.prefix=this.and_prefix_single,this.and.single.strings.suffix=this.and_suffix,a.output.append(this.and_term,"empty",!0),this.and.multiple=a.output.pop(),this.and.multiple.strings.prefix=this.and_prefix_multiple,this.and.multiple.strings.suffix=this.and_suffix):this.strings.delimiter&&(this.and.single=new c.Blob(this.strings.delimiter),this.and.single.strings.prefix="",this.and.single.strings.suffix="",this.and.multiple=new c.Blob(this.strings.delimiter),this.and.multiple.strings.prefix="",this.and.multiple.strings.suffix=""),this.ellipsis={},this.strings["et-al-use-last"]&&(this.ellipsis.single=new c.Blob(this.ellipsis_term),this.ellipsis.single.strings.prefix=this.ellipsis_prefix_single,this.ellipsis.single.strings.suffix=this.ellipsis_suffix,this.ellipsis.multiple=new c.Blob(this.ellipsis_term),this.ellipsis.multiple.strings.prefix=this.ellipsis_prefix_multiple,this.ellipsis.multiple.strings.suffix=this.ellipsis_suffix),"undefined"==typeof a.tmp["et-al-min"]&&(a.tmp["et-al-min"]=this.strings["et-al-min"]),"undefined"==typeof a.tmp["et-al-use-first"]&&(a.tmp["et-al-use-first"]=this.strings["et-al-use-first"]),"undefined"==typeof a.tmp["et-al-use-last"]&&(a.tmp["et-al-use-last"]=this.strings["et-al-use-last"]),a.nameOutput.name=this},a.build.name_flag=!0,this.execs.push(d)),b.push(this)}},c.Node["name-part"]={build:function(a,b){a.build[this.strings.name]=this}},c.Node.names={build:function(a,b){var d;if((this.tokentype===c.START||this.tokentype===c.SINGLETON)&&(c.Util.substituteStart.call(this,a,b),a.build.substitute_level.push(1),a.fixOpt(this,"names-delimiter","delimiter")),this.tokentype===c.SINGLETON){a.build.names_variables.push(this.variables);for(var e=0,f=this.variables.length;f>e;e+=1)a.build.name_label[this.variables[e]]=a.build.name_label[a.build.names_variables.slice(0)[0]];d=function(a,b,c){a.nameOutput.reinit(this)},this.execs.push(d)}if(this.tokentype===c.START&&(a.build.names_flag=!0,a.build.names_level+=1,1===a.build.names_level&&(a.build.names_variables=[],a.build.name_label={}),a.build.names_variables.push(this.variables),d=function(a,b,c){a.tmp.can_substitute.push(!0),a.parallel.StartVariable("names",this.variables[0]),a.nameOutput.init(this)},this.execs.push(d)),this.tokentype===c.END){for(var e=0,f=3;f>e;e+=1){var g=["family","given","et-al"][e];this[g]=a.build[g],1===a.build.names_level&&(a.build[g]=void 0)}this.label=a.build.name_label,1===a.build.names_level&&(a.build.name_label={}),a.build.names_level+=-1,a.build.names_variables.pop();var h="with",i="",j="";c.STARTSWITH_ROMANESQUE_REGEXP.test(h)&&(i=" ",j=" "),this["with"]={},this["with"].single=new c.Blob(h),this["with"].single.strings.suffix=j,this["with"].multiple=new c.Blob(h),this["with"].multiple.strings.suffix=j,"always"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=this.strings.delimiter,this["with"].multiple.strings.prefix=this.strings.delimiter):"contextual"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=i,this["with"].multiple.strings.prefix=this.strings.delimiter):"after-inverted-name"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=this.strings.delimiter,this["with"].multiple.strings.prefix=i):(this["with"].single.strings.prefix=i,this["with"].multiple.strings.prefix=i),d=function(a,b,d){a.tmp.etal_node?this.etal_style=a.tmp.etal_node:this.etal_style="empty",this.etal_term=a.getTerm(a.tmp.etal_term,"long",0),c.STARTSWITH_ROMANESQUE_REGEXP.test(this.etal_term)?(this.etal_prefix_single=" ",this.etal_prefix_multiple=a.tmp.name_delimiter,"always"===a.tmp["delimiter-precedes-et-al"]?this.etal_prefix_single=a.tmp.name_delimiter:"never"===a.tmp["delimiter-precedes-et-al"]?this.etal_prefix_multiple=" ":"after-inverted-name"===a.tmp["delimiter-precedes-et-al"]&&(this.etal_prefix_single=a.tmp.name_delimiter,this.etal_prefix_multiple=" "),this.etal_suffix=""):(this.etal_prefix_single="",this.etal_prefix_multiple="",this.etal_suffix="");for(var e=0,f=3;f>e;e+=1){var g=["family","given"][e];a.nameOutput[g]=this[g]}a.nameOutput["with"]=this["with"],a.nameOutput.label=this.label,a.nameOutput.etal_style=this.etal_style,a.nameOutput.etal_term=this.etal_term,a.nameOutput.etal_prefix_single=this.etal_prefix_single,a.nameOutput.etal_prefix_multiple=this.etal_prefix_multiple,a.nameOutput.etal_suffix=this.etal_suffix,a.nameOutput.outputNames(),a.tmp["et-al-use-first"]=void 0,a.tmp["et-al-min"]=void 0,a.tmp["et-al-use-last"]=void 0},this.execs.push(d),d=function(a,b){a.tmp.can_substitute.pop()||a.tmp.can_substitute.replace(!1,c.LITERAL),a.parallel.CloseVariable("names"),1===a.tmp.can_substitute.mystack.length&&(a.tmp.can_block_substitute=!1)},this.execs.push(d),a.build.name_flag=!1}b.push(this),(this.tokentype===c.END||this.tokentype===c.SINGLETON)&&(a.build.substitute_level.pop(),c.Util.substituteEnd.call(this,a,b))}},c.Node.number={build:function(a,b){var d;c.Util.substituteStart.call(this,a,b),"roman"===this.strings.form?this.formatter=a.fun.romanizer:"ordinal"===this.strings.form?this.formatter=a.fun.ordinalizer:"long-ordinal"===this.strings.form&&(this.formatter=a.fun.long_ordinalizer),"undefined"==typeof this.successor_prefix&&(this.successor_prefix=a[a.build.area].opt.layout_delimiter),"undefined"==typeof this.splice_prefix&&(this.splice_prefix=a[a.build.area].opt.layout_delimiter),d=function(a,b,d){var e,f,g,h;if(0!==this.variables.length){if("undefined"==typeof d)var d={};var i,j;if(i=this.variables[0],"locator"!==i||!a.tmp.just_looking){a.parallel.StartVariable(this.variables[0]),"locator"===this.variables[0]?a.parallel.AppendToVariable(b.section):a.parallel.AppendToVariable(b[this.variables[0]]);var k=new RegExp("(?:&|, | and |"+a.getTerm("page-range-delimiter")+")");"collection-number"===i&&"legal_case"===b.type&&(a.tmp.renders_collection_number=!0);var l=b[this.variables[0]],m="long";if(this.strings.label_form_override&&(m=this.strings.label_form_override),"locator"===i&&d.locator)if(d.locator=d.locator.replace(/([^\\])\s*-\s*/,"$1"+a.getTerm("page-range-delimiter")),j=d.locator.match(c.STATUTE_SUBDIV_GROUPED_REGEX)){for(h=d.locator.split(c.STATUTE_SUBDIV_PLAIN_REGEX),e=0,f=h.length;f>e;e+=1)h[e]=a.fun.page_mangler(h[e]);for(g=[h[0]],!this.strings.label_form_override&&a.tmp.group_context.value()[5]&&(m=a.tmp.group_context.value()[5]),e=1,f=h.length;f>e;e+=1){var n=0;h[e].match(k)&&(n=1);var o=c.STATUTE_SUBDIV_STRINGS[j[e-1].replace(/^\s*/,"")],p=m;d.section_label_count>e&&d.section_form_override&&(p=d.section_form_override),g.push(a.getTerm(o,p,n)),g.push(h[e].replace(/^\s*/,""))}l=g.join(" "),l=l.replace(/\\/,"","g"),a.output.append(l,this)}else l=a.fun.page_mangler(d.locator),l=l.replace(/\\/,"","g"),a.output.append(l,this);else{var q=this;(!a.tmp.shadow_numbers[i]||a.tmp.shadow_numbers[i].values.length&&a.tmp.shadow_numbers[i].values[0][2]===!1)&&("locator"===i?a.processNumber(q,d,i,b.type):a.processNumber(q,b,i,b.type));var r,s=a.tmp.shadow_numbers[i].values,t="",u="page";if(["bill","gazette","legislation","legal_case","treaty"].indexOf(b.type)>-1&&"collection-number"===i&&(u="year"),("number"===i&&["bill","gazette","legislation","treaty"].indexOf(b.type)>-1||a.opt[u+"-range-format"])&&!this.strings.prefix&&!this.strings.suffix&&!this.strings.form)for(e=0,f=s.length;f>e;e+=1)t+=s[e][1];if(t&&!t.match(/^[\-.\u20130-9]+$/)){if("number"===i&&["bill","gazette","legislation","treaty"].indexOf(b.type)>-1){var v=t.split(/\s/)[0];if(v&&(g=[],j=t.match(c.STATUTE_SUBDIV_GROUPED_REGEX))){for(h=t.split(c.STATUTE_SUBDIV_PLAIN_REGEX),e=1,f=h.length;f>e;e+=1)g.push(a.getTerm(c.STATUTE_SUBDIV_STRINGS[j[e-1].replace(/^\s+/,"")],this.strings.label_form_override)),g.push(h[e].replace(/^\s+/,""));t=g.join(" ")}}a.output.append(t,this)}else if(s.length){for(a.output.openLevel("empty"),e=0,f=s.length;f>e;e+=1)r=new c[s[e][0]](s[e][1],s[e][2],b.id),e>0&&(r.strings.prefix=r.strings.prefix.replace(/^\s*/,"")),e<s.length-1&&(r.strings.suffix=r.strings.suffix.replace(/\s*$/,"")),"undefined"==typeof r.gender&&(r.gender=a.locale[a.opt.lang]["noun-genders"][i]),a.output.append(r,"literal",!1,!1,!0);a.output.closeLevel("empty")}}"locator"===i&&a.tmp.done_vars.push("locator"),a.parallel.CloseVariable("number")}}},this.execs.push(d),b.push(this),c.Util.substituteEnd.call(this,a,b)}},c.Node.sort={build:function(a,b){if(b=a[a.build.root+"_sort"].tokens,this.tokentype===c.START){"citation"===a.build.area&&(a.parallel.use_parallels=!1,a.opt.sort_citations=!0),a.build.area=a.build.root+"_sort",a.build.extension="_sort";var d=function(a,b){if(a.opt.has_layout_locale){for(var d,e=c.localeResolve(b.language,a.opt["default-locale"][0]),f=a[a.tmp.area.slice(0,-5)].opt.sort_locales,g=0,h=f.length;h>g&&(d=f[g][e.bare],d||(d=f[g][e.best]),!d);g+=1);d||(d=a.opt["default-locale"][0]),a.tmp.lang_sort_hold=a.opt.lang,a.opt.lang=d}};this.execs.push(d)}if(this.tokentype===c.END){a.build.area=a.build.root,a.build.extension="";var d=function(a,b){a.opt.has_layout_locale&&(a.opt.lang=a.tmp.lang_sort_hold,delete a.tmp.lang_sort_hold)};this.execs.push(d)}b.push(this)}},c.Node.substitute={build:function(a,b){var d;this.tokentype===c.START&&(d=function(a,b){a.tmp.can_block_substitute=!0,a.tmp.value.length&&a.tmp.can_substitute.replace(!1,c.LITERAL)},this.execs.push(d)),b.push(this)}},c.Node.text={build:function(a,b){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(this.postponed_macro)return c.expandMacro.call(a,this);if(c.Util.substituteStart.call(this,a,b),this.variables_real||(this.variables_real=[]),this.variables||(this.variables=[]),e="long",f=0,this.strings.form&&(e=this.strings.form),this.strings.plural&&(f=this.strings.plural),"citation-number"===this.variables_real[0]||"year-suffix"===this.variables_real[0]||"citation-label"===this.variables_real[0])"citation-number"===this.variables_real[0]?("citation"===a.build.root&&(a.opt.update_mode=c.NUMERIC),"bibliography"===a.build.root&&(a.opt.bib_mode=c.NUMERIC),"bibliography_sort"===a.build.area&&(a.opt.citation_number_sort_used=!0),"citation-number"===a[a.tmp.area].opt.collapse&&(this.range_prefix=a.getTerm("citation-range-delimiter")),this.successor_prefix=a[a.build.area].opt.layout_delimiter,this.splice_prefix=a[a.build.area].opt.layout_delimiter,d=function(a,b,d){if(g=""+b.id,!a.tmp.just_looking){if(d&&d["author-only"]){a.tmp.element_trace.replace("do-not-suppress-me");var e=a.getTerm("reference","long","singular");"undefined"==typeof e&&(e="reference"),o=c.Output.Formatters["capitalize-first"](a,e),a.output.append(o+" "),a.tmp.last_element_trace=!0}d&&d["suppress-author"]&&(a.tmp.last_element_trace&&a.tmp.element_trace.replace("suppress-me"),a.tmp.last_element_trace=!1),h=a.registry.registry[g].seq,a.opt.citation_number_slug?a.output.append(a.opt.citation_number_slug,this):(i=new c.NumericBlob(h,this,b.id),a.output.append(i,"literal"))}},this.execs.push(d)):"year-suffix"===this.variables_real[0]?(a.opt.has_year_suffix=!0,"year-suffix-ranged"===a[a.tmp.area].opt.collapse&&(this.range_prefix=a.getTerm("citation-range-delimiter")),this.successor_prefix=a[a.build.area].opt.layout_delimiter,a[a.tmp.area].opt["year-suffix-delimiter"]&&(this.successor_prefix=a[a.build.area].opt["year-suffix-delimiter"]),d=function(a,b){if(a.registry.registry[b.id]&&a.registry.registry[b.id].disambig.year_suffix!==!1&&!a.tmp.just_looking){for(h=parseInt(a.registry.registry[b.id].disambig.year_suffix,10),i=new c.NumericBlob(h,this,b.id),j=new c.Util.Suffixator(c.SUFFIX_CHARS),i.setFormatter(j),a.output.append(i,"literal"),k=!1,p=a.tmp.group_context.mystack.length,q=0;p>q;q+=1)if(r=a.tmp.group_context.mystack[q],!r[2]&&(r[1]||!r[1]&&!r[0])){k=!0;break}l=a[a.tmp.area].opt["year-suffix-delimiter"],k&&l&&!a.tmp.sort_key_flag&&(a.tmp.splice_delimiter=a[a.tmp.area].opt["year-suffix-delimiter"])}},this.execs.push(d)):"citation-label"===this.variables_real[0]&&(a.opt.has_year_suffix=!0,d=function(a,b){m=b["citation-label"],m||(m=a.getCitationLabel(b)),a.tmp.just_looking||(n="",a.registry.registry[b.id]&&a.registry.registry[b.id].disambig.year_suffix!==!1&&(h=parseInt(a.registry.registry[b.id].disambig.year_suffix,10),n=a.fun.suffixator.format(h)),m+=n),a.output.append(m,this)},this.execs.push(d));else if(this.strings.term)d=function(a,b,d){var g=a.opt.gender[b.type],h=this.strings.term;h=a.getTerm(h,e,f,g,!1,"accessed"===h);var i;if(""!==h&&(r=a.tmp.group_context.value(),r[0]=!0,a.tmp.group_context.replace(r)),i=a.tmp.term_predecessor||"in-text"===a.opt["class"]&&"citation"===a.tmp.area?h:c.Output.Formatters["capitalize-first"](a,h),a.tmp.strip_periods)i=i.replace(/\./g,"");else for(var j=0,k=this.decorations.length;k>j;j+=1)if("@strip-periods"===this.decorations[j][0]&&"true"===this.decorations[j][1]){i=i.replace(/\./g,"");break}a.output.append(i,this)},this.execs.push(d),a.build.term=!1,a.build.form=!1,a.build.plural=!1;else if(this.variables_real.length){if(d=function(a,b,c){var d=this.variables[0];"title"!==d||"short"!==e&&!b["title-short"]||(d="title-short"),a.parallel.StartVariable(d),
a.parallel.AppendToVariable(b[d],d)},this.execs.push(d),c.MULTI_FIELDS.indexOf(this.variables_real[0])>-1){var s=this.variables[0],t=!1,u=!1,v=!1;"short"===e?"container-title"===this.variables_real[0]?u="journalAbbreviation":"title"===this.variables_real[0]&&(u="title-short"):s=!1,a.build.extension?v=!0:(v=!0,t=!0),d=a.transform.getOutputFunction(this.variables,s,t,u,v)}else d=c.CITE_FIELDS.indexOf(this.variables_real[0])>-1?function(a,b,c){if(c&&c[this.variables[0]]){var d=""+c[this.variables[0]];d=d.replace(/([^\\])--*/g,"$1"+a.getTerm("page-range-delimiter")),d=d.replace(/\\-/g,"-"),a.output.append(d,this,!1,!1,!0),"locator-revision"===this.variables[0]&&a.tmp.done_vars.push("locator-revision")}}:"page-first"===this.variables_real[0]?function(a,b){var c;c=a.getVariable(b,"page-first",e),c&&(c=c.replace("\\",""),a.output.append(c,this,!1,!1,!0))}:"page"===this.variables_real[0]?function(a,b){var c=a.getVariable(b,"page",e);c&&(c=""+c,c=c.replace(/([^\\])--*/g,"$1"+a.getTerm("page-range-delimiter")),c=c.replace(/\\-/g,"-"),c=a.fun.page_mangler(c),a.output.append(c,this,!1,!1,!0))}:"volume"===this.variables_real[0]?function(a,b){if(this.variables[0]){var c=a.getVariable(b,this.variables[0],e);c&&a.output.append(c,this)}}:["URL","DOI"].indexOf(this.variables_real[0])>-1?function(a,b){var c;this.variables[0]&&(c=a.getVariable(b,this.variables[0],e),c&&(a.opt.development_extensions.wrap_url_and_doi?this.decorations.length&&this.decorations[0][0]==="@"+this.variables[0]||(this.decorations=[["@"+this.variables[0],"true"]].concat(this.decorations)):this.decorations.length&&this.decorations[0][0]==="@"+this.variables[0]&&(this.decorations=this.decorations.slice(1)),a.output.append(c,this,!1,!1,!0)))}:"section"===this.variables_real[0]?function(a,b){var c;c=a.getVariable(b,this.variables[0],e),c&&a.output.append(c,this)}:"hereinafter"===this.variables_real[0]?function(a,b){var c=a.transform.abbrevs["default"].hereinafter[b.id];c&&(a.output.append(c,this),a.tmp.group_context.value()[2]=!0)}:function(a,b){var c;this.variables[0]&&(c=a.getVariable(b,this.variables[0],e),c&&(c=""+c,c=c.replace("\\","","g"),a.output.append(c,this)))};this.execs.push(d),d=function(a,b){a.parallel.CloseVariable("text")},this.execs.push(d)}else this.strings.value&&(d=function(a,b){var c;c=a.tmp.group_context.value(),c[0]=!0,a.tmp.group_context.replace(c),a.output.append(this.strings.value,this)},this.execs.push(d));b.push(this),c.Util.substituteEnd.call(this,a,b)}},c.Attributes={},c.Attributes["@genre"]=function(a,b){b=b.replace("-"," ");var c=function(a,c){return b===a.genre?!0:!1};this.tests.push(c)},c.Attributes["@disambiguate"]=function(a,b){if("true"===b){a.opt.has_disambiguate=!0;var c=function(b,c){return a.tmp.disambiguate_maxMax+=1,a.tmp.disambig_settings.disambiguate&&a.tmp.disambiguate_count<a.tmp.disambig_settings.disambiguate?(a.tmp.disambiguate_count+=1,!0):!1};this.tests.push(c)}else if("check-ambiguity-and-backreference"===b){var c=function(b,c){return a.registry.registry[b.id].disambig.disambiguate&&a.registry.registry[b.id]["citation-count"]>1?!0:!1};this.tests.push(c)}},c.Attributes["@is-numeric"]=function(a,b,d){for(var e=b.split(/\s+/),f=function(b){return function(d,e){var f=d;if(["locator","locator-revision"].indexOf(b)>-1&&(f=e),"undefined"==typeof f)return!1;if(c.NUMERIC_VARIABLES.indexOf(b)>-1){if(a.tmp.shadow_numbers[b]||a.processNumber(!1,f,b,d.type),f[b]&&a.tmp.shadow_numbers[b].numeric)return!0}else if(["title","locator-revision","version"].indexOf(b)>-1&&f[b]&&f[b].slice(-1)===""+parseInt(f[b].slice(-1),10))return!0;return!1}},g=0;g<e.length;g+=1)this.tests.push(f(e[g]))},c.Attributes["@is-uncertain-date"]=function(a,b){for(var c=b.split(/\s+/),d=function(a){return function(b,c){return b[a]&&b[a].circa?!0:!1}},e=0,f=c.length;f>e;e+=1)this.tests.push(d(c[e]))},c.Attributes["@locator"]=function(a,b){var c=b.replace("sub verbo","sub-verbo");c=c.split(/\s+/);for(var d=function(a){return function(b,c){var d;return d="undefined"!=typeof c&&c.label?"sub verbo"===c.label?"sub-verbo":c.label:"page",a===d?!0:!1}},e=0,f=c.length;f>e;e+=1)this.tests.push(d(c[e]))},c.Attributes["@position"]=function(a,b){var d;a.opt.update_mode=c.POSITION,a.parallel.use_parallels=!0;for(var e=b.split(/\s+/),f=function(b){return function(c,d){if("bibliography"===a.tmp.area)return!1;if(d&&"undefined"==typeof d.position&&(d.position=0),d&&"number"==typeof d.position){if(0===d.position&&0===b)return!0;if(b>0&&d.position>=b)return!0}else if(0===b)return!0;return!1}},g=0,h=e.length;h>g;g+=1){var d=e[g];"first"===d?d=c.POSITION_FIRST:"subsequent"===d?d=c.POSITION_SUBSEQUENT:"ibid"===d?d=c.POSITION_IBID:"ibid-with-locator"===d&&(d=c.POSITION_IBID_WITH_LOCATOR),"near-note"===d?this.tests.push(function(a,b){return b&&b.position>=c.POSITION_SUBSEQUENT&&b["near-note"]?!0:!1}):this.tests.push(f(d))}},c.Attributes["@type"]=function(a,b){for(var c=b.split(/\s+/),d=function(a){return function(b,c){var d=b.type===a;return d?!0:!1}},e=[],f=0,g=c.length;g>f;f+=1)e.push(d(c[f]));this.tests.push(a.fun.match.any(this,a,e))},c.Attributes["@variable"]=function(a,b){var d;if(this.variables=b.split(/\s+/),this.variables_real=this.variables.slice(),"label"===this.name&&this.variables[0])this.strings.term=this.variables[0];else if(["names","date","text","number"].indexOf(this.name)>-1)d=function(a,b,c){variables=this.variables_real.slice();for(var d=this.variables.length-1;d>-1;d+=-1)this.variables.pop();for(len=variables.length,pos=0;pos<len;pos+=1)-1!==a.tmp.done_vars.indexOf(variables[pos])||c&&"legal_case"===b.type&&c["suppress-author"]&&"title"===variables[pos]||this.variables.push(variables[pos]),a.tmp.can_block_substitute&&a.tmp.done_vars.push(variables[pos])},this.execs.push(d),d=function(a,b,d){for(output=!1,len=this.variables.length,pos=0;pos<len;pos+=1){if(variable=this.variables[pos],"authority"===variable&&"string"==typeof b[variable]&&"names"===this.name){var e={family:b[variable],isInstitution:!0,multi:{_key:{}}};if(b.multi&&b.multi._keys&&b.multi._keys[variable])for(var f in b.multi._keys[variable])creatorChild={family:b.multi._keys[variable][f],isInstitution:!0},e.multi._key[f]=creatorChild;b[variable]=[e]}if("short"!==this.strings.form||b[variable]||("title"===variable?variable="title-short":"container-title"===variable&&(variable="journalAbbreviation")),"year-suffix"===variable){output=!0;break}if(c.DATE_VARIABLES.indexOf(variable)>-1){if(a.opt.development_extensions.locator_date_and_revision&&"locator-date"===variable){output=!0;break}if(b[variable]){for(var g in b[variable])if((-1!==this.dateparts.indexOf(g)||"literal"===g)&&b[variable][g]){output=!0;break}if(output)break}}else{if("locator"===variable){d&&d.locator&&(output=!0);break}if("locator-revision"===variable){d&&d["locator-revision"]&&(output=!0);break}if(["citation-number","citation-label"].indexOf(variable)>-1){output=!0;break}if("first-reference-note-number"===variable){d&&d["first-reference-note-number"]&&(output=!0);break}if("hereinafter"===variable){a.transform.abbrevs["default"].hereinafter[b.id]&&a.sys.getAbbreviation&&b.id&&(output=!0);break}if("object"==typeof b[variable]){b[variable].length;break}if("string"==typeof b[variable]&&b[variable]){output=!0;break}if("number"==typeof b[variable]){output=!0;break}}if(output)break}flag=a.tmp.group_context.value(),output?(("citation-number"!==variable||"bibliography"!==a.tmp.area)&&(a.tmp.cite_renders_content=!0),flag[2]=!0,a.tmp.group_context.replace(flag),a.tmp.can_substitute.value()&&"bibliography"===a.tmp.area&&"string"==typeof b[variable]&&a.tmp.rendered_name.push(b[variable]),a.tmp.can_substitute.replace(!1,c.LITERAL)):flag[1]=!0},this.execs.push(d);else if(["if","else-if","condition"].indexOf(this.name)>-1)for(var e=function(b){return function(c,d){var e=c;if(d&&["locator","locator-revision","first-reference-note-number","locator-date"].indexOf(b)>-1&&(e=d),"hereinafter"===b&&a.sys.getAbbreviation&&e.id){if(a.transform.abbrevs["default"].hereinafter[e.id])return!0}else if(e[b]){if("number"==typeof e[b]||"string"==typeof e[b])return!0;if("object"==typeof e[b])for(key in e[b])if(e[b][key])return!0}return!1}},f=0,g=this.variables.length;g>f;f+=1)this.tests.push(e(this.variables[f]))},c.Attributes["@page"]=function(a,b){var c=b.replace("sub verbo","sub-verbo");c=c.split(/\s+/);for(var d=function(b){return function(c,d){var e;return a.processNumber(!1,c,"page",c.type),e=a.tmp.shadow_numbers.page.label?"sub verbo"===a.tmp.shadow_numbers.page.label?"sub-verbo":a.tmp.shadow_numbers.page.label:"page",b===e?!0:!1}},e=0,f=c.length;f>e;e+=1)this.tests.push(d(c[e]))},c.Attributes["@jurisdiction"]=function(a,b){for(var c=b.split(/\s+/),d=0,e=c.length;e>d;d+=1)c[d]=c[d].split(";");for(var f=function(a){return function(b,c){if(!b.jurisdiction)return!1;for(var d=b.jurisdiction.split(";"),e=0,f=d.length;f>e;e+=1)d[e]=d[e].split(";");for(e=a.length;e>0;e+=-1){var g=a.slice(0,e).join(";"),h=d.slice(0,e).join(";");if(g!==h)return!1}return!0}},d=0,e=c.length;e>d;d+=1){var g=c[d].slice();this.tests.push(f(g))}},c.Attributes["@context"]=function(a,b){var c=function(c,d){var e=a.tmp.area.slice(0,b.length);return e===b?!0:!1};this.tests.push(c)},c.Attributes["@has-year-only"]=function(a,b){for(var c=b.split(/\s+/),d=function(a){return function(b,c){var d=b[a];return!d||d.month||d.season?!1:!0}},e=0,f=c.length;f>e;e+=1)this.tests.push(d(c[e]))},c.Attributes["@has-to-month-or-season"]=function(a,b){for(var c=b.split(/\s+/),d=function(a){return function(b,c){var d=b[a];return!d||!d.month&&!d.season||d.day?!1:!0}},e=0,f=c.length;f>e;e+=1)this.tests.push(d(c[e]))},c.Attributes["@has-day"]=function(a,b){for(var c=b.split(/\s+/),d=function(a){return function(b,c){var d=b[a];return d&&d.day?!0:!1}},e=0,f=c.length;f>e;e+=1)this.tests.push(d(c[e]))},c.Attributes["@subjurisdictions"]=function(a,b){var c=parseInt(b,10),d=function(a,b){var d=0;return a.jurisdiction&&(d=a.jurisdiction.split(";").length),d&&(d+=-1),d>=c?!0:!1};this.tests.push(d)},c.Attributes["@is-plural"]=function(a,b){var c=function(a,c){var d=a[b];if(d&&d.length){for(var e=0,f=0,g=!1,h=0,i=d.length;i>h;h+=1)d[h].isInstitution&&(d[h].literal||d[h].family&&!d[h].given)?(f+=1,g=!1):(e+=1,g=!0);if(e>1)return!0;if(f>1)return!0;if(f&&g)return!0}return!1};this.tests.push(c)},c.Attributes["@locale"]=function(a,b){var d,e,f,g,h,i,j=a.opt["default-locale"][0];if("layout"===this.name){if(this.locale_raw=b,this.tokentype===c.START){var k=b.split(/\s+/),l={},m=c.localeResolve(k[0],j);m.generic?l[m.generic]=m.best:l[m.best]=m.best;for(var h=1,i=k.length;i>h;h+=1){var n=c.localeResolve(k[h],j);n.generic?l[n.generic]=m.best:l[n.best]=m.best}a[a.build.area].opt.sort_locales.push(l)}a.opt.has_layout_locale=!0}else{g=b.split(/\s+/);var o=[];for(h=0,i=g.length;i>h;h+=1)f=g[h],e=c.localeResolve(f,j),2===g[h].length&&o.push(e.bare),a.localeConfigure(e,!0),g[h]=e;var p=g.slice(),q=function(a,b,e){return function(f,g){var j;d=[],j=!1;var k,l=!1;for(k=f.language?f.language:b,l=c.localeResolve(k,b),h=0,i=a.length;i>h;h+=1)if(l.best===a[h].best){j=!0;break}return!j&&e.indexOf(l.bare)>-1&&(j=!0),j}};this.tests.push(q(p,j,o))}},c.Attributes["@locale-internal"]=function(a,b){var d,e,f,g,h,i;for(g=b.split(/\s+/),this.locale_bares=[],h=0,i=g.length;i>h;h+=1)f=g[h],e=c.localeResolve(f,a.opt["default-locale"][0]),2===g[h].length&&this.locale_bares.push(e.bare),a.localeConfigure(e),g[h]=e;this.locale_default=a.opt["default-locale"][0],this.locale=g[0].best,this.locale_list=g.slice();var j=function(b){return function(e,g){var j;d=[],j=!1;var k=!1;if(e.language&&(f=e.language,k=c.localeResolve(f,a.opt["default-locale"][0]),k.best===a.opt["default-locale"][0]&&(k=!1)),k){for(h=0,i=b.locale_list.length;i>h;h+=1)if(k.best===b.locale_list[h].best){a.opt.lang=b.locale,a.tmp.last_cite_locale=b.locale,a.output.openLevel("empty"),a.output.current.value().new_locale=b.locale,j=!0;break}!j&&b.locale_bares.indexOf(k.bare)>-1&&(a.opt.lang=b.locale,a.tmp.last_cite_locale=b.locale,a.output.openLevel("empty"),a.output.current.value().new_locale=b.locale,j=!0)}return j}},k=this;this.tests.push(j(k))},c.Attributes["@is-parallel"]=function(a,b){for(var c=b.split(" "),d=0,e=c.length;e>d;d+=1)"true"===c[d]?c[d]=!0:"false"===c[d]&&(c[d]=!1);this.strings.set_parallel_condition=c},c.Attributes["@gender"]=function(a,b){this.gender=b},c.Attributes["@cslid"]=function(a,b){this.cslid=parseInt(b,10)},c.Attributes["@label-form"]=function(a,b){this.strings.label_form_override=b},c.Attributes["@part-separator"]=function(a,b){this.strings["part-separator"]=b},c.Attributes["@leading-noise-words"]=function(a,b){this["leading-noise-words"]=b},c.Attributes["@name-never-short"]=function(a,b){this["name-never-short"]=b},c.Attributes["@class"]=function(a,b){a.opt["class"]=b},c.Attributes["@version"]=function(a,b){a.opt.version=b},c.Attributes["@value"]=function(a,b){this.strings.value=b},c.Attributes["@name"]=function(a,b){this.strings.name=b},c.Attributes["@form"]=function(a,b){this.strings.form=b},c.Attributes["@date-parts"]=function(a,b){this.strings["date-parts"]=b},c.Attributes["@range-delimiter"]=function(a,b){this.strings["range-delimiter"]=b},c.Attributes["@macro"]=function(a,b){this.postponed_macro=b},c.Attributes["@term"]=function(a,b){"sub verbo"===b?this.strings.term="sub-verbo":this.strings.term=b},c.Attributes["@xmlns"]=function(a,b){},c.Attributes["@lang"]=function(a,b){b&&(a.build.lang=b)},c.Attributes["@lingo"]=function(a,b){},c.Attributes["@macro-has-date"]=function(a,b){this["macro-has-date"]=!0},c.Attributes["@suffix"]=function(a,b){this.strings.suffix=b},c.Attributes["@prefix"]=function(a,b){this.strings.prefix=b},c.Attributes["@delimiter"]=function(a,b){"name"==this.name?this.strings.name_delimiter=b:this.strings.delimiter=b},c.Attributes["@match"]=function(a,b){this.match=b},c.Attributes["@names-min"]=function(a,b){var c=parseInt(b,10);a[a.tmp.area].opt.max_number_of_names<c&&(a[a.tmp.area].opt.max_number_of_names=c),this.strings["et-al-min"]=c},c.Attributes["@names-use-first"]=function(a,b){this.strings["et-al-use-first"]=parseInt(b,10)},c.Attributes["@names-use-last"]=function(a,b){"true"===b?this.strings["et-al-use-last"]=!0:this.strings["et-al-use-last"]=!1},c.Attributes["@sort"]=function(a,b){"descending"===b&&(this.strings.sort_direction=c.DESCENDING)},c.Attributes["@plural"]=function(a,b){"always"===b||"true"===b?this.strings.plural=1:"never"===b||"false"===b?this.strings.plural=0:"contextual"===b&&(this.strings.plural=!1)},c.Attributes["@number"]=function(a,b){var c,d=b.replace("sub verbo","sub-verbo");d=d.split(/\s+/),["if","else-if"].indexOf(this.name)>-1&&(c=function(a,b,c){var e,f=[];a.processNumber(!1,b,"number",b.type),e=a.tmp.shadow_numbers.number.label?"sub verbo"===a.tmp.shadow_numbers.number.label?"sub-verbo":a.tmp.shadow_numbers.number.label:"number";for(var g=0,h=d.length;h>g;g+=1)d[g]===e?f.push(!0):f.push(!1);return f},this.tests.push(c))},c.Attributes["@has-publisher-and-publisher-place"]=function(a,b){this.strings["has-publisher-and-publisher-place"]=!0},c.Attributes["@publisher-delimiter-precedes-last"]=function(a,b){this.strings["publisher-delimiter-precedes-last"]=b},c.Attributes["@publisher-delimiter"]=function(a,b){this.strings["publisher-delimiter"]=b},c.Attributes["@publisher-and"]=function(a,b){this.strings["publisher-and"]=b},c.Attributes["@newdate"]=function(a,b){},c.Attributes["@givenname-disambiguation-rule"]=function(a,b){c.GIVENNAME_DISAMBIGUATION_RULES.indexOf(b)>-1&&(a.citation.opt["givenname-disambiguation-rule"]=b)},c.Attributes["@collapse"]=function(a,b){b&&(a[this.name].opt.collapse=b)},c.Attributes["@cite-group-delimiter"]=function(a,b){b&&(a[a.tmp.area].opt.cite_group_delimiter=b)},c.Attributes["@names-delimiter"]=function(a,b){a.setOpt(this,"names-delimiter",b)},c.Attributes["@name-form"]=function(a,b){a.setOpt(this,"name-form",b)},c.Attributes["@subgroup-delimiter"]=function(a,b){this.strings["subgroup-delimiter"]=b},c.Attributes["@subgroup-delimiter-precedes-last"]=function(a,b){this.strings["subgroup-delimiter-precedes-last"]=b},c.Attributes["@name-delimiter"]=function(a,b){a.setOpt(this,"name-delimiter",b)},c.Attributes["@et-al-min"]=function(a,b){var c=parseInt(b,10);a[a.tmp.area].opt.max_number_of_names<c&&(a[a.tmp.area].opt.max_number_of_names=c),a.setOpt(this,"et-al-min",c)},c.Attributes["@et-al-use-first"]=function(a,b){a.setOpt(this,"et-al-use-first",parseInt(b,10))},c.Attributes["@et-al-use-last"]=function(a,b){"true"===b?a.setOpt(this,"et-al-use-last",!0):a.setOpt(this,"et-al-use-last",!1)},c.Attributes["@et-al-subsequent-min"]=function(a,b){var c=parseInt(b,10);a[a.tmp.area].opt.max_number_of_names<c&&(a[a.tmp.area].opt.max_number_of_names=c),a.setOpt(this,"et-al-subsequent-min",c)},c.Attributes["@et-al-subsequent-use-first"]=function(a,b){a.setOpt(this,"et-al-subsequent-use-first",parseInt(b,10))},c.Attributes["@suppress-min"]=function(a,b){this.strings["suppress-min"]=parseInt(b,10)},c.Attributes["@suppress-max"]=function(a,b){this.strings["suppress-max"]=parseInt(b,10)},c.Attributes["@and"]=function(a,b){a.setOpt(this,"and",b)},c.Attributes["@delimiter-precedes-last"]=function(a,b){a.setOpt(this,"delimiter-precedes-last",b)},c.Attributes["@delimiter-precedes-et-al"]=function(a,b){a.setOpt(this,"delimiter-precedes-et-al",b)},c.Attributes["@initialize-with"]=function(a,b){a.setOpt(this,"initialize-with",b)},c.Attributes["@initialize"]=function(a,b){"false"===b&&a.setOpt(this,"initialize",!1)},c.Attributes["@name-as-reverse-order"]=function(a,b){this["name-as-reverse-order"]=b},c.Attributes["@name-as-sort-order"]=function(a,b){"style-options"===this.name?this["name-as-sort-order"]=b:a.setOpt(this,"name-as-sort-order",b)},c.Attributes["@sort-separator"]=function(a,b){a.setOpt(this,"sort-separator",b)},c.Attributes["@year-suffix-delimiter"]=function(a,b){a[this.name].opt["year-suffix-delimiter"]=b},c.Attributes["@after-collapse-delimiter"]=function(a,b){a[this.name].opt["after-collapse-delimiter"]=b},c.Attributes["@subsequent-author-substitute"]=function(a,b){a[this.name].opt["subsequent-author-substitute"]=b},c.Attributes["@subsequent-author-substitute-rule"]=function(a,b){a[this.name].opt["subsequent-author-substitute-rule"]=b},c.Attributes["@disambiguate-add-names"]=function(a,b){"true"===b&&(a.opt["disambiguate-add-names"]=!0)},c.Attributes["@disambiguate-add-givenname"]=function(a,b){"true"===b&&(a.opt["disambiguate-add-givenname"]=!0)},c.Attributes["@disambiguate-add-year-suffix"]=function(a,b){"true"===b&&"numeric"!==a.opt.xclass&&(a.opt["disambiguate-add-year-suffix"]=!0)},c.Attributes["@second-field-align"]=function(a,b){("flush"===b||"margin"===b)&&(a[this.name].opt["second-field-align"]=b)},c.Attributes["@hanging-indent"]=function(a,b){"true"===b&&(a[this.name].opt.hangingindent=2)},c.Attributes["@line-spacing"]=function(a,b){b&&b.match(/^[.0-9]+$/)&&(a[this.name].opt["line-spacing"]=parseFloat(b,10))},c.Attributes["@entry-spacing"]=function(a,b){b&&b.match(/^[.0-9]+$/)&&(a[this.name].opt["entry-spacing"]=parseFloat(b,10))},c.Attributes["@near-note-distance"]=function(a,b){a[this.name].opt["near-note-distance"]=parseInt(b,10)},c.Attributes["@text-case"]=function(a,b){var c=function(a,c){if("normal"===b)this.text_case_normal=!0;else if(this.strings["text-case"]=b,"title"===b){a.opt["default-locale"][0].slice(0,2);c.jurisdiction&&(this.strings["text-case"]="passthrough")}};this.execs.push(c)},c.Attributes["@page-range-format"]=function(a,b){a.opt["page-range-format"]=b},c.Attributes["@year-range-format"]=function(a,b){a.opt["year-range-format"]=b},c.Attributes["@default-locale"]=function(a,b){var c,d,e,f,g;if(f=b.match(/-x-(sort|translit|translat)-/g))for(e=0,d=f.length;d>e;e+=1)f[e]=f[e].replace(/^-x-/,"").replace(/-$/,"");for(c=b.split(/-x-(?:sort|translit|translat)-/),g=[c[0]],e=1,d=c.length;d>e;e+=1)g.push(f[e-1]),g.push(c[e]);for(c=g.slice(),d=c.length,e=1;d>e;e+=2)a.opt["locale-"+c[e]].push(c[e+1].replace(/^\s*/g,"").replace(/\s*$/g,""));c.length?a.opt["default-locale"]=c.slice(0,1):a.opt["default-locale"]=["en"]},c.Attributes["@default-locale-sort"]=function(a,b){a.opt["default-locale-sort"]=b},c.Attributes["@demote-non-dropping-particle"]=function(a,b){a.opt["demote-non-dropping-particle"]=b},c.Attributes["@initialize-with-hyphen"]=function(a,b){"false"===b&&(a.opt["initialize-with-hyphen"]=!1)},c.Attributes["@institution-parts"]=function(a,b){this.strings["institution-parts"]=b},c.Attributes["@if-short"]=function(a,b){"true"===b&&(this.strings["if-short"]=!0)},c.Attributes["@substitute-use-first"]=function(a,b){this.strings["substitute-use-first"]=parseInt(b,10)},c.Attributes["@use-first"]=function(a,b){this.strings["use-first"]=parseInt(b,10)},c.Attributes["@stop-last"]=function(a,b){this.strings["stop-last"]=-1*parseInt(b,10)},c.Attributes["@oops"]=function(a,b){this.strings.oops=b},c.Attributes["@use-last"]=function(a,b){this.strings["use-last"]=parseInt(b,10)},c.Attributes["@reverse-order"]=function(a,b){"true"===b&&(this.strings["reverse-order"]=!0)},c.Attributes["@display"]=function(a,b){this.strings.cls=b},c.Stack=function(a,b){this.mystack=[],(b||a)&&this.mystack.push(a)},c.Stack.prototype.push=function(a,b){b||a?this.mystack.push(a):this.mystack.push("")},c.Stack.prototype.clear=function(){this.mystack=[]},c.Stack.prototype.replace=function(a,b){if(0===this.mystack.length)throw"Internal CSL processor error: attempt to replace nonexistent stack item with "+a;b||a?this.mystack[this.mystack.length-1]=a:this.mystack[this.mystack.length-1]=""},c.Stack.prototype.pop=function(){return this.mystack.pop()},c.Stack.prototype.value=function(){return this.mystack.slice(-1)[0]},c.Stack.prototype.length=function(){return this.mystack.length},c.Parallel=function(a){this.state=a,this.sets=new c.Stack([]),this.try_cite=!0,this.use_parallels=!1,this.midVars=["section","volume","container-title","collection-number","issue","page-first","page","number"],this.ignoreVarsLawGeneral=["first-reference-note-number","locator","label","page-first","page","genre"],this.ignoreVarsLawProceduralHistory=["issued","first-reference-note-number","locator","label","page-first","page","genre","jurisdiction"],this.ignoreVarsOrders=["first-reference-note-number"],this.ignoreVarsOther=["first-reference-note-number","locator","label","section","page-first","page"]},c.Parallel.prototype.isMid=function(a){return this.midVars.indexOf(a)>-1},c.Parallel.prototype.StartCitation=function(a,b){this.parallel_conditional_blobs_list=[],this.use_parallels&&(this.sortedItems=a,this.sortedItemsPos=-1,this.sets.clear(),this.sets.push([]),this.in_series=!0,this.delim_counter=0,this.delim_pointers=[],b?this.out=b:this.out=this.state.output.queue,this.master_was_neutral_cite=!0)},c.Parallel.prototype.StartCite=function(a,b,d){var e,f,g,h,i,j,k,l;if(this.use_parallels){this.sets.value().length&&this.sets.value()[0].itemId==a.id&&this.ComposeSet(),this.sortedItemsPos+=1,b&&(e=b.position),this.try_cite=!0;for(var m=!1,n=0,o=c.PARALLEL_MATCH_VARS.length;o>n;n+=1)if(a[c.PARALLEL_MATCH_VARS[n]]){m=!0;break}var p=!0,q=this.sets.value().slice(-1)[0];if(q&&q.Item&&(q.Item.title!==a.title?p=!1:q.Item.type!==a.type?p=!1:["article-journal","article-magazine"].indexOf(a.type)>-1&&(this.state.opt.development_extensions.handle_parallel_articles&&q.Item["container-title"]===a["container-title"]||(p=!1))),p&&m&&-1!==c.PARALLEL_TYPES.indexOf(a.type)||(this.try_cite=!0,this.in_series&&(this.in_series=!1)),this.cite={},this.cite.front=[],this.cite.mid=[],this.cite.back=[],this.cite.front_collapse={},this.cite.back_forceme=[],this.cite.position=e,this.cite.Item=a,this.cite.itemId=""+a.id,this.cite.prevItemID=""+d,this.target="front",["treaty"].indexOf(a.type)>-1)this.ignoreVars=this.ignoreVarsOrders;else if(["article-journal","article-magazine"].indexOf(a.type)>-1)this.ignoreVars=this.ignoreVarsOther;else if(b&&b.prefix){this.ignoreVars=this.ignoreVarsLawProceduralHistory,this.cite.useProceduralHistory=!0;var r=this.sets.value()[this.sets.value().length-1];if(r&&r.back)for(var n=r.back.length-1;n>-1;n+=-1)r.back[n]&&r[r.back[n]]&&delete r[r.back[n]]}else this.ignoreVars=this.ignoreVarsLawGeneral;if(this.sortedItems&&this.sortedItemsPos>0&&this.sortedItemsPos<this.sortedItems.length){if(h=this.sortedItems[this.sortedItemsPos][1],j=""+this.sortedItems[this.sortedItemsPos-1][1].id,i=this.state.registry.registry[j].parallel,k=!1,i==h.id){for(f=this.sortedItemsPos-1,g=f;g>-1;g+=-1)if(this.sortedItems[g][1].id==a.id){k=this.sortedItems[g][1].locator;break}l=this.sortedItems[this.sortedItemsPos][1].locator,!k&&l?h.position=c.POSITION_IBID_WITH_LOCATOR:l===k?h.position=c.POSITION_IBID:h.position=c.POSITION_IBID_WITH_LOCATOR}}else{if(!this.state.registry.registry[a.id])return this.try_cite=!1,void(this.force_collapse=!1);this.state.registry.registry[a.id].parallel=!1}this.force_collapse=!1,this.state.registry.registry[a.id].parallel&&(this.force_collapse=!0)}},c.Parallel.prototype.StartVariable=function(a,b){if(this.use_parallels&&(this.try_cite||this.force_collapse)){if("names"===a?this.variable=a+":"+this.target:this.variable=a,this.ignoreVars.indexOf(a)>-1)return;"container-title"===a&&0===this.sets.value().length&&(this.master_was_neutral_cite=!1),this.data={},this.data.value="",this.data.blobs=[];var d=this.isMid(a);"authority"===b&&"names:front"===this.variable?(this.try_cite=!0,this.in_series=!1):"front"===this.target&&d?this.target="mid":"mid"===this.target&&!d&&this.cite.Item.title&&"names"!==a?this.target="back":"back"===this.target&&d&&(this.try_cite=!0,this.in_series=!1),"number"===a?this.cite.front.push(this.variable):c.PARALLEL_COLLAPSING_MID_VARSET.indexOf(a)>-1?["article-journal","article-magazine"].indexOf(this.cite.Item.type)>-1?this.cite.mid.push(this.variable):this.cite.front.push(this.variable):this.cite[this.target].push(this.variable)}},c.Parallel.prototype.AppendBlobPointer=function(a){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if(this.use_parallels&&(this.force_collapse||this.try_cite)){if(["article-journal","article-magazine"].indexOf(this.cite.Item.type)>-1){if(["volume","page","page-first","issue"].indexOf(this.variable)>-1)return;if("container-title"===this.variable&&this.cite.mid.length>1)return}this.variable&&(this.try_cite||this.force_collapse)&&a&&a.blobs&&(this.cite.useProceduralHistory&&"back"===this.target||this.data.blobs.push([a,a.blobs.length]))}}},c.Parallel.prototype.AppendToVariable=function(a,b){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if(this.try_cite||this.force_collapse)if("back"!==this.target,0){var c=this.sets.value()[this.sets.value().length-1];c&&c[this.variable]&&c[this.variable].value&&(this.data.value+="::"+a)}else this.data.value+="::"+a}},c.Parallel.prototype.CloseVariable=function(){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if((this.try_cite||this.force_collapse)&&(this.cite[this.variable]=this.data,this.sets.value().length>0)){var a=this.sets.value()[this.sets.value().length-1];"front"===this.target&&"issued"===this.variable&&this.data.value&&this.master_was_neutral_cite&&(this.target="mid"),"front"===this.target?!a[this.variable]&&!this.data.value||a[this.variable]&&this.data.value===a[this.variable].value||"issued"!==this.variable&&(this.in_series=!1):"mid"===this.target?c.PARALLEL_COLLAPSING_MID_VARSET.indexOf(this.variable)>-1&&(a[this.variable]&&a[this.variable].value===this.data.value?this.cite.front_collapse[this.variable]=!0:this.cite.front_collapse[this.variable]=!1):"back"===this.target&&a[this.variable]&&this.data.value!==a[this.variable].value&&-1===this.sets.value().slice(-1)[0].back_forceme.indexOf(this.variable)&&(this.in_series=!1)}this.variable=!1}},c.Parallel.prototype.CloseCite=function(){var a,b,c,d,e,f,g;if(this.use_parallels&&(this.force_collapse||this.try_cite)){if(d=!1,this.cite.front_collapse["container-title"]||(d=!0),this.cite.front_collapse.volume===!1&&(d=!0),this.cite.front_collapse["collection-number"]===!1&&(d=!0),this.cite.front_collapse.section===!1&&(d=!0),d&&(this.cite.use_journal_info=!0,g=this.cite.front.indexOf("section"),g>-1&&(this.cite.front=this.cite.front.slice(0,g).concat(this.cite.front.slice(g+1))),e=this.cite.front.indexOf("volume"),e>-1&&(this.cite.front=this.cite.front.slice(0,e).concat(this.cite.front.slice(e+1))),f=this.cite.front.indexOf("container-title"),f>-1&&(this.cite.front=this.cite.front.slice(0,f).concat(this.cite.front.slice(f+1))),collection_number_pos=this.cite.front.indexOf("collection-number"),collection_number_pos>-1&&(this.cite.front=this.cite.front.slice(0,collection_number_pos).concat(this.cite.front.slice(collection_number_pos+1)))),this.in_series||this.force_collapse||this.ComposeSet(!0),0===this.sets.value().length){for(has_date=!1,b=0,c=this.cite.back.length;c>b;b+=1)if(a=this.cite.back[b],"issued"===a&&this.cite.issued&&this.cite.issued.value){has_date=!0;break}has_date||this.cite.back_forceme.push("issued")}else{var h=this.cite.front.indexOf("issued");if((-1===h||this.master_was_neutral_cite)&&(this.cite.back_forceme=this.sets.value().slice(-1)[0].back_forceme),h>-1){var i=this.sets.value()[this.sets.value().length-1];i.issued||(this.cite.front=this.cite.front.slice(0,h).concat(this.cite.front.slice(h+1)))}this.master_was_neutral_cite&&this.cite.mid.indexOf("names:mid")>-1&&this.cite.front.push("names:mid")}this.sets.value().push(this.cite)}},c.Parallel.prototype.ComposeSet=function(a){var b,d,e;if(this.use_parallels&&(this.force_collapse||this.try_cite)){var f=this.sets.value().length;if(1===this.sets.value().length)this.in_series||(this.sets.value().pop(),this.delim_counter+=1);else{for(e=this.sets.value().length,d=0;e>d;d+=1)b=this.sets.value()[d],0===d?this.delim_counter+=1:(!b.Item.title&&b.use_journal_info?this.delim_pointers.push(!1):this.delim_pointers.push(this.delim_counter),this.delim_counter+=1),c.POSITION_FIRST===b.position&&(0===d?(this.state.registry.registry[b.itemId].master=!0,this.state.registry.registry[b.itemId].siblings=[],this.state.registry.registry[b.itemId].parallel=!1):b.prevItemID&&(this.state.registry.registry[b.prevItemID].parallel?this.state.registry.registry[b.itemId].parallel=this.state.registry.registry[b.prevItemID].parallel:this.state.registry.registry[b.itemId].parallel=b.prevItemID,this.state.registry.registry[b.itemId].siblings=this.state.registry.registry[b.prevItemID].siblings,this.state.registry.registry[b.itemId].siblings||(this.state.registry.registry[b.itemId].siblings=[],c.debug("WARNING: adding missing siblings array to registry object")),this.state.registry.registry[b.itemId].siblings.push(b.itemId)));this.sets.push([])}2>f?this.purgeGroupsIfParallel(!1):this.purgeGroupsIfParallel(!0),this.in_series=!0}},c.Parallel.prototype.PruneOutputQueue=function(){var a,b,c,d,e,f;if(this.use_parallels)for(a=this.sets.mystack.length,b=0;a>b;b+=1)if(c=this.sets.mystack[b],c.length>1)for(e=c.length,d=0;e>d;d+=1)f=c[d],0===d?this.purgeVariableBlobs(f,f.back):d===c.length-1?this.purgeVariableBlobs(f,f.front.concat(f.back_forceme)):this.purgeVariableBlobs(f,f.front.concat(f.back))},c.Parallel.prototype.purgeVariableBlobs=function(a,b){var c,d,e,f,g,h,i;if(this.use_parallels){for(i=this.state.output.current.value(),"undefined"==typeof i.length&&(i=i.blobs),d=0,c=this.delim_pointers.length;c>d;d+=1)h=this.delim_pointers[d],h!==!1&&(i[h].parallel_delimiter=", ");for(c=b.length-1,d=c;d>-1;d+=-1)if(e=b[d],a[e])for(g=a[e].blobs.length-1,h=g;h>-1;h+=-1)f=a[e].blobs[h],f[0].blobs=f[0].blobs.slice(0,f[1]).concat(f[0].blobs.slice(f[1]+1)),this.state.tmp.has_purged_parallel=!0,f[0]&&f[0].strings&&"string"==typeof f[0].strings.oops&&f[0].parent&&f[0].parent&&(f[0].parent.parent.strings.delimiter=f[0].strings.oops)}},c.Parallel.prototype.purgeGroupsIfParallel=function(a){for(var b=this.parallel_conditional_blobs_list.length-1;b>-1;b+=-1){for(var c=this.parallel_conditional_blobs_list[b],d=!0,e=0,f=c.conditions.length;f>e;e+=1)if(!c.conditions[e]!=!!a&&("master"!==c.conditions[e]||this.state.registry.registry[c.id].master)&&("servant"!==c.conditions[e]||this.state.registry.registry[c.id].parallel)){
var d=!1;break}if(d){for(var g=[];c.blobs.length>c.pos;)g.push(c.blobs.pop());for(g.length&&g.pop();g.length;)c.blobs.push(g.pop())}this.parallel_conditional_blobs_list.pop()}},c.Util={},c.Util.Match=function(){this.any=function(a,b,c){return function(a,b){for(var d=0,e=c.length;e>d;d+=1)if(result=c[d](a,b),result)return!0;return!1}},this.none=function(a,b,c){return function(a,b){for(var d=0,e=c.length;e>d;d+=1)if(result=c[d](a,b),result)return!1;return!0}},this.all=function(a,b,c){return function(a,b){for(var d=0,e=c.length;e>d;d+=1)if(result=c[d](a,b),!result)return!1;return!0}},this[void 0]=this.all,this.nand=function(a,b,c){return function(a,b){for(var d=0,e=c.length;e>d;d+=1)if(result=c[d](a,b),!result)return!0;return!1}}},c.Transform=function(a){function b(a,b,d,e,f,g){var h;if(!f)return e;var i=f,j=!1;if(["title","title-short"].indexOf(i)>-1&&!b.jurisdiction&&(j=!0),c.NUMERIC_VARIABLES.indexOf(f)>-1&&(f="number"),["publisher-place","event-place","jurisdiction","archive-place"].indexOf(f)>-1&&(f="place"),["publisher","authority"].indexOf(f)>-1&&(f="institution-part"),["genre","event","medium","title-short"].indexOf(f)>-1&&(f="title"),["archive"].indexOf(f)>-1&&(f="collection-title"),h="",a.sys.getAbbreviation){var k=a.transform.loadAbbreviation(b.jurisdiction,f,e,b.type,j);a.transform.abbrevs[k][f]&&e&&a.sys.getAbbreviation&&a.transform.abbrevs[k][f][e]&&(h=a.transform.abbrevs[k][f][e].replace("{stet}",e))}return h||a.opt.development_extensions.require_explicit_legal_case_title_short&&"legal_case"===b.type||!d||!b[d]||!g||(h=b[d]),h||(h=e),h&&"!here>>>"===h.slice(0,10)&&(h="jurisdiction"===i&&["treaty","patent"].indexOf(i)>-1?h.slice(10):!1),h}function d(b,c){var d,e=a.opt["default-locale"][0].slice(0,2);return d=a.opt.development_extensions.strict_text_case_locales?new RegExp("^([a-zA-Z]{2})(?:$|-.*| .*)"):new RegExp("^([a-zA-Z]{2})(?:$|-.*|.*)"),b.language&&(m=(""+b.language).match(d),e=m?m[1]:"tlh"),b.multi&&b.multi&&b.multi.main&&b.multi.main[c]&&(e=b.multi.main[c]),(!a.opt.development_extensions.strict_text_case_locales||a.opt.development_extensions.normalize_lang_keys_to_lowercase)&&(e=e.toLowerCase()),e}function e(b,c,e,f,g){var h,i,j,k;if(!b[c])return{name:"",usedOrig:g};if(j={name:"",usedOrig:g,locale:d(b,c)},k=a.opt[e],"locale-orig"===e)return j=g?{name:"",usedOrig:g}:{name:b[c],usedOrig:!1,locale:d(b,c)};if(f&&("undefined"==typeof k||0===k.length))return{name:b[c],usedOrig:!0,locale:d(b,c)};for(var l=0,m=k.length;m>l;l+=1){if(h=k[l],i=h.split(/[\-_]/)[0],h&&b.multi&&b.multi._keys[c]&&b.multi._keys[c][h]){j.name=b.multi._keys[c][h],j.locale=i;break}if(i&&b.multi&&b.multi._keys[c]&&b.multi._keys[c][i]){j.name=b.multi._keys[c][i],j.locale=i;break}}return!j.name&&f&&(j={name:b[c],usedOrig:!0,locale:d(b,c)}),j}function f(b,c,d,e,f){if(b||(b="default"),!d)return a.transform.abbrevs[b]||(a.transform.abbrevs[b]=new a.sys.AbbreviationSegments),b;if(a.sys.getAbbreviation){var g=["default"];if("default"!==b)for(var h=b.split(/\s*;\s*/),i=0,j=h.length;j>i;i+=1)g.push(h.slice(0,i+1).join(";"));for(var i=g.length-1;i>-1;i+=-1)if(a.transform.abbrevs[g[i]]||(a.transform.abbrevs[g[i]]=new a.sys.AbbreviationSegments),a.transform.abbrevs[g[i]][c][d]||a.sys.getAbbreviation(a.opt.styleID,a.transform.abbrevs,g[i],c,d,e,f),a.transform.abbrevs[g[i]][c][d]){i<g.length&&(a.transform.abbrevs[b][c][d]=a.transform.abbrevs[g[i]][c][d]);break}}return b}function g(c,d,e,f){var g=c.variables[0];if(a.publisherOutput&&e){if(-1===["publisher","publisher-place"].indexOf(g))return!1;a.publisherOutput[g+"-token"]=c,a.publisherOutput.varlist.push(g);var h=e.split(/;\s*/);h.length===a.publisherOutput[g+"-list"].length&&(a.publisherOutput[g+"-list"]=h);for(var i=0,j=h.length;j>i;i+=1)h[i]=b(a,d,!1,h[i],f,!0);return a.tmp[g+"-token"]=c,!0}return!1}function h(d,f,h,j,k){var l,m=c.LangPrefsMap[d[0]];return l=m?a.opt["cite-lang-prefs"][m]:!1,function(a,h,k,n){var o,p,q,r,s,t,u;if(!d[0]||!h[d[0]]&&!h[j])return null;if(a.opt.suppressJurisdictions&&"jurisdiction"===d[0]&&a.opt.suppressJurisdictions[h.jurisdiction]&&["legal_case","gazette","regulation","legislation"].indexOf(h.type)>-1)return null;var v={primary:!1,secondary:!1,tertiary:!1};if("_sort"===a.tmp.area.slice(-5))v.primary="locale-sort";else if(l)for(var w=["primary","secondary","tertiary"],x=0,y=w.length;y>x&&!(l.length-1<x);x+=1)l[x]&&(v[w[x]]="locale-"+l[x]);else v.primary="locale-orig";if("bibliography"===a.tmp.area||"citation"===a.tmp.area&&"note"===a.opt.xclass&&k&&!k.position||(v.secondary=!1,v.tertiary=!1),a.tmp["publisher-list"])return"publisher"===d[0]?a.tmp["publisher-token"]=this:"publisher-place"===d[0]&&(a.tmp["publisher-place-token"]=this),null;var z=e(h,d[0],v.primary,!0);o=z.name,p=z.locale;var A=z.usedOrig;if(g(this,h,o,f))return null;q=!1,s=!1,v.secondary&&(z=e(h,d[0],v.secondary,!1,z.usedOrig),q=z.name,r=z.locale),v.tertiary&&(z=e(h,d[0],v.tertiary,!1,z.usedOrig),s=z.name,t=z.locale),f&&(o=b(a,h,j,o,f,!0),o&&(o=i(o)),q=b(a,h,!1,q,f,!0),s=b(a,h,!1,s,f,!0));var B,C=c.Util.cloneToken(this),u=c.Util.cloneToken(this);if("locale-translit"===v.primary&&(B=a.opt.citeAffixes[m][v.primary].prefix),"<i>"===B&&"title"===d[0]&&!A){for(var D=!1,x=0,y=u.decorations.length;y>x;x+=1)"@font-style"===u.decorations[x][0]&&"italic"===u.decorations[x][1]&&(D=!0);D||u.decorations.push(["@font-style","italic"])}if("en"!==p&&"title"===u.strings["text-case"]&&(u.strings["text-case"]="passthrough"),"title"===d[0]&&(o=c.demoteNoiseWords(a,o,this["leading-noise-words"])),q||s){if(a.output.openLevel("empty"),u.strings.suffix=u.strings.suffix.replace(/[ .,]+$/,""),a.output.append(o,u),q){secondary_tok=c.Util.cloneToken(C),secondary_tok.strings.prefix=a.opt.citeAffixes[m][v.secondary].prefix,secondary_tok.strings.suffix=a.opt.citeAffixes[m][v.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ");for(var x=secondary_tok.decorations.length-1;x>-1;x+=-1)["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(secondary_tok.decorations[x].join("/"))>-1&&(secondary_tok.decorations=secondary_tok.decorations.slice(0,x).concat(secondary_tok.decorations.slice(x+1)));"en"!==r&&"title"===secondary_tok.strings["text-case"]&&(secondary_tok.strings["text-case"]="passthrough"),a.output.append(q,secondary_tok);var E=a.output.current.value(),F=a.output.current.value().blobs.length-1;a.parallel.use_parallels&&(a.parallel.cite.front.push(d[0]+":secondary"),a.parallel.cite[d[0]+":secondary"]={blobs:[[E,F]]})}if(s){tertiary_tok=c.Util.cloneToken(C),tertiary_tok.strings.prefix=a.opt.citeAffixes[m][v.tertiary].prefix,tertiary_tok.strings.suffix=a.opt.citeAffixes[m][v.tertiary].suffix,tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ");for(var x=tertiary_tok.decorations.length-1;x>-1;x+=-1)["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(tertiary_tok.decorations[x].join("/"))>-1&&(tertiary_tok.decorations=tertiary_tok.decorations.slice(0,x).concat(tertiary_tok.decorations.slice(x+1)));"en"!==t&&"title"===tertiary_tok.strings["text-case"]&&(tertiary_tok.strings["text-case"]="passthrough"),a.output.append(s,tertiary_tok);var E=a.output.current.value(),F=a.output.current.value().blobs.length-1;a.parallel.use_parallels&&(a.parallel.cite.front.push(d[0]+":tertiary"),a.parallel.cite[d[0]+":tertiary"]={blobs:[[E,F]]})}a.output.closeLevel()}else a.output.append(o,u);return null}}function i(b){var c=b.match(/^!([-,_a-z]+)>>>/);if(c){var d=c[1].split(",");b=b.slice(c[0].length);for(var e=0,f=d.length;f>e;e+=1)-1===a.tmp.done_vars.indexOf(d[e])&&a.tmp.done_vars.push(d[e])}return b}this.abbrevs={},this.abbrevs["default"]=new a.sys.AbbreviationSegments,this.getTextSubField=e,this.loadAbbreviation=f,this.getOutputFunction=h,this.quashCheck=i},c.Token=function(a,b){this.name=a,this.strings={},this.strings.delimiter=void 0,this.strings.prefix="",this.strings.suffix="",this.decorations=[],this.variables=[],this.execs=[],this.tokentype=b,this.evaluator=!1,this.tests=[],this.rawtests=[],this.succeed=!1,this.fail=!1,this.next=!1},c.Util.cloneToken=function(a){var b,d,e,f;if("string"==typeof a)return a;b=new c.Token(a.name,a.tokentype);for(d in a.strings)a.strings.hasOwnProperty(d)&&(b.strings[d]=a.strings[d]);if(a.decorations)for(b.decorations=[],e=0,f=a.decorations.length;f>e;e+=1)b.decorations.push(a.decorations[e].slice());return a.variables&&(b.variables=a.variables.slice()),a.execs&&(b.execs=a.execs.slice(),b.tests=a.tests.slice(),b.rawtests=a.tests.slice()),b},c.AmbigConfig=function(){this.maxvals=[],this.minval=1,this.names=[],this.givens=[],this.year_suffix=!1,this.disambiguate=0},c.Blob=function(a,b,c){var d,e,f;if(this.levelname=c,b){this.strings={prefix:"",suffix:""};for(f in b.strings)b.strings.hasOwnProperty(f)&&(this.strings[f]=b.strings[f]);for(this.decorations=[],d=void 0===b.decorations?0:b.decorations.length,e=0;d>e;e+=1)this.decorations.push(b.decorations[e].slice())}else this.strings={},this.strings.prefix="",this.strings.suffix="",this.strings.delimiter="",this.decorations=[];"string"==typeof a?this.blobs=a:a?this.blobs=[a]:this.blobs=[],this.alldecor=[this.decorations]},c.Blob.prototype.push=function(a){if("string"==typeof this.blobs)throw"Attempt to push blob onto string object";!1!==a&&(a.alldecor=a.alldecor.concat(this.alldecor),this.blobs.push(a))},c.NumericBlob=function(a,b,d){this.id=d,this.alldecor=[],this.num=a,this.blobs=a.toString(),this.status=c.START,this.strings={},b?(this.gender=b.gender,this.decorations=b.decorations,this.strings.prefix=b.strings.prefix,this.strings.suffix=b.strings.suffix,this.strings["text-case"]=b.strings["text-case"],this.successor_prefix=b.successor_prefix,this.range_prefix=b.range_prefix,this.splice_prefix=b.splice_prefix,this.formatter=b.formatter,this.formatter||(this.formatter=new c.Output.DefaultFormatter),this.formatter&&(this.type=this.formatter.format(1))):(this.decorations=[],this.strings.prefix="",this.strings.suffix="",this.successor_prefix="",this.range_prefix="",this.splice_prefix="",this.formatter=new c.Output.DefaultFormatter)},c.NumericBlob.prototype.setFormatter=function(a){this.formatter=a,this.type=this.formatter.format(1)},c.Output.DefaultFormatter=function(){},c.Output.DefaultFormatter.prototype.format=function(a){return a.toString()},c.NumericBlob.prototype.checkNext=function(a,b){b?(this.status=c.START,"object"==typeof a&&(a.num===this.num+1?a.status=c.SUCCESSOR:a.status=c.SEEN)):a&&a.num&&this.type===a.type&&a.num===this.num+1?this.status===c.START||this.status===c.SEEN?a.status=c.SUCCESSOR:(this.status===c.SUCCESSOR||this.status===c.SUCCESSOR_OF_SUCCESSOR)&&(this.range_prefix?(a.status=c.SUCCESSOR_OF_SUCCESSOR,this.status=c.SUPPRESS):a.status=c.SUCCESSOR):(this.status===c.SUCCESSOR_OF_SUCCESSOR&&(this.status=c.END),"object"==typeof a&&(a.status=c.SEEN))},c.NumericBlob.prototype.checkLast=function(a){return this.status===c.SEEN||a.num!==this.num-1&&this.status===c.SUCCESSOR?(this.status=c.SUCCESSOR,!0):!1},c.Util.fixDateNode=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;this.build.date_key=!0,d=this.sys.xml.getAttributeValue(c,"form");var r;if(r="accessed"===this.sys.xml.getAttributeValue(c,"variable")?this.opt["default-locale"][0]:this.sys.xml.getAttributeValue(c,"lingo"),!this.getDate(d))return a;var s=this.sys.xml.getAttributeValue(c,"date-parts");e=this.sys.xml.getAttributeValue(c,"variable"),k=this.sys.xml.getAttributeValue(c,"prefix"),l=this.sys.xml.getAttributeValue(c,"suffix"),p=this.sys.xml.getAttributeValue(c,"display"),q=this.sys.xml.getAttributeValue(c,"cslid"),f=this.sys.xml.nodeCopy(this.getDate(d,"accessed"===e)),this.sys.xml.setAttribute(f,"lingo",this.opt.lang),this.sys.xml.setAttribute(f,"form",d),this.sys.xml.setAttribute(f,"date-parts",s),this.sys.xml.setAttribute(f,"cslid",q),this.sys.xml.setAttribute(f,"variable",e),k&&this.sys.xml.setAttribute(f,"prefix",k),l&&this.sys.xml.setAttribute(f,"suffix",l),p&&this.sys.xml.setAttribute(f,"display",p),m=this.sys.xml.children(c);for(n in m)if(g=m[n],"date-part"===this.sys.xml.nodename(g)){h=this.sys.xml.getAttributeValue(g,"name"),o=this.sys.xml.attributes(g);for(i in o)if(o.hasOwnProperty(i)){if("@name"===i)continue;if(r&&r!==this.opt.lang&&["@suffix","@prefix","@form"].indexOf(i)>-1)continue;j=o[i],this.sys.xml.setAttributeOnNodeIdentifiedByNameAttribute(f,"date-part",h,i,j)}}return"year"===this.sys.xml.getAttributeValue(c,"date-parts")?(this.sys.xml.deleteNodeByNameAttribute(f,"month"),this.sys.xml.deleteNodeByNameAttribute(f,"day")):"year-month"===this.sys.xml.getAttributeValue(c,"date-parts")&&this.sys.xml.deleteNodeByNameAttribute(f,"day"),this.sys.xml.insertChildNodeAfter(a,c,b,f)},c.dateMacroAsSortKey=function(a,b){c.dateAsSortKey.call(this,a,b,!0)},c.dateAsSortKey=function(a,b,d){var e,f,g,h,i,j,k,l,m=this.variables[0],n="empty";for(d&&(n="macro-with-date"),e=b[m],"undefined"==typeof e&&(e={"date-parts":[[0]]},e.year||(a.tmp.empty_date=!0)),"undefined"==typeof this.dateparts&&(this.dateparts=["year","month","day"]),e.raw?e=a.fun.dateparser.parse(e.raw):e["date-parts"]&&(e=a.dateParseArray(e)),"undefined"==typeof e&&(e={}),k=0,l=c.DATE_PARTS_INTERNAL.length;l>k;k+=1)f=c.DATE_PARTS_INTERNAL[k],g=0,h=f,"_end"===h.slice(-4)&&(h=h.slice(0,-4)),e[f]&&this.dateparts.indexOf(h)>-1&&(g=e[f]),"year"===f.slice(0,4)?(i=c.Util.Dates[h].numeric(a,g),j="Y","-"===i[0]&&(j="X",i=i.slice(1),i=9999-parseInt(i,10)),a.output.append(c.Util.Dates[f.slice(0,4)].numeric(a,j+i),n)):(g=c.Util.Dates[h]["numeric-leading-zeros"](a,g),g||(g="00"),a.output.append(g,n))},c.Engine.prototype.dateParseArray=function(a){var b,d,e,f;b={};for(d in a)if("date-parts"===d){e=a["date-parts"],e.length>1&&e[0].length!==e[1].length&&c.error("CSL data error: element mismatch in date range input."),f=["","_end"];for(var g=0,h=e.length;h>g;g+=1)for(var i=0,j=c.DATE_PARTS.length;j>i;i+=1)"undefined"==typeof e[g][i]?b[c.DATE_PARTS[i]+f[g]]=e[g][i]:b[c.DATE_PARTS[i]+f[g]]=parseInt(e[g][i],10)}else a.hasOwnProperty(d)&&("literal"===d&&"object"==typeof a.literal&&"string"==typeof a.literal.part?(c.debug("Warning: fixing up weird literal date value"),b.literal=a.literal.part):b[d]=a[d]);return b},c.Util.Names={},c.Util.Names.compareNamesets=c.NameOutput.prototype._compareNamesets,c.Util.Names.unInitialize=function(a,b){var d,e,f,g,h;if(!b)return"";for(f=b.split(/(?:\-|\s+)/),g=b.match(/(\-|\s+)/g),h="",d=0,e=f.length;e>d;d+=1)c.ALL_ROMANESQUE_REGEXP.exec(f[d].slice(0,-1))&&f[d]&&f[d]!==f[d].toUpperCase()&&(f[d]=f[d].slice(0,1)+f[d].slice(1,2).toLowerCase()+f[d].slice(2)),h+=f[d],e-1>d&&(h+=g[d]);return h},c.Util.Names.initializeWith=function(a,b,d,e){var f,g,h,i,j,k,l;if(!b)return"";if(["Lord","Lady"].indexOf(b)>-1||!b.match(c.STARTSWITH_ROMANESQUE_REGEXP)&&!d.match("%s"))return b;d||(d="");var m=b;if(a.opt["initialize-with-hyphen"]===!1&&(m=m.replace(/\-/g," ")),m=m.replace(/\s*\-\s*/g,"-").replace(/\s+/g," "),m=m.replace(/-([a-z])/g,"–$1"),j=m.match(/[\-\s]+/g),k=m.split(/[\-\s]+/),0===k.length)m=j;else for(m=[k[0]],f=1,g=k.length;g>f;f+=1)m.push(j[f-1]),m.push(k[f]);for(k=m,f=k.length-1;f>-1;f+=-1)if(k[f]&&k[f].slice(0,-1).indexOf(".")>-1){var n=k.slice(f+1),o=k[f].slice(0,-1).split(".");for(k=k.slice(0,f),h=0,i=o.length;i>h;h+=1)k.push(o[h]+"."),h<o.length-1&&k.push(" ");k=k.concat(n)}return l=e?c.Util.Names.doNormalize(a,k,d):c.Util.Names.doInitialize(a,k,d),l=l.replace(/\u2013([a-z])/g,"-$1")},c.Util.Names.doNormalize=function(a,b,d,e){var f,g,h=[];for(f=0,g=b.length;g>f;f+=1)b[f].length>1&&"."===b[f].slice(-1)?(b[f]=b[f].slice(0,-1),h.push(!0)):1===b[f].length&&b[f].toUpperCase()===b[f]?h.push(!0):h.push(!1);for(f=0,g=b.length;g>f;f+=2)h[f]&&(f<b.length-2&&(b[f+1]="",(!d||d.slice(-1)&&" "!==d.slice(-1))&&b[f].length&&b[f].match(c.ALL_ROMANESQUE_REGEXP)&&(b[f].length>1||b[f+2].length>1)&&(b[f+1]=" "),b[f]=b[f]+d),f===b.length-1&&(b[f]=b[f]+d));return b.join("").replace(/\s+$/,"")},c.Util.Names.doInitialize=function(a,b,d,e){var f,g,h,i,j,k,l;for(f=0,g=b.length;g>f;f+=2)if(l=b[f])if(h=l.match(c.NAME_INITIAL_REGEXP),!h&&!l.match(c.STARTSWITH_ROMANESQUE_REGEXP)&&l.length>1&&d.match("%s")&&(h=l.match(/(.)(.*)/)),h&&h[1]===h[1].toUpperCase()){var m="";if(h[2]){var n="";for(k=h[2].split(""),i=0,j=k.length;j>i;i+=1){var o=k[i];if(o!==o.toUpperCase())break;n+=o}n.length<h[2].length&&(m=n.toLocaleLowerCase())}b[f]=h[1].toLocaleUpperCase()+m,g-1>f?d.match("%s")?b[f]=d.replace("%s",b[f]):b[f+1].indexOf("-")>-1?b[f+1]=d+b[f+1]:b[f+1]=d:d.match("%s")?b[f]=d.replace("%s",b[f]):b.push(d)}else l.match(c.ROMANESQUE_REGEXP)&&(b[f]=" "+l);var p=b.join("");return p=p.replace(/\s+$/,"").replace(/\s*\-\s*/g,"-").replace(/\s+/g," ")},c.Util.Names.getRawName=function(a){var b=[];return a.given&&b.push(a.given),a.family&&b.push(a.family),b.join(" ")},c.Util.Dates={},c.Util.Dates.year={},c.Util.Dates.year["long"]=function(a,b){return b||(b="boolean"==typeof b?"":0),b.toString()},c.Util.Dates.year.imperial=function(a,b,c,d){b||(b="boolean"==typeof b?"":0),c=c?"_end":"";var e=a.tmp.date_object["month"+c];for(e=e?""+e:"1";e.length<2;)e="0"+e;var f=a.tmp.date_object["day"+c];for(f=f?""+f:"1";f.length<2;)f="0"+f;var g,h,i=parseInt(b+e+f,10);return i>=18680908&&19120730>i?(g="明治",h=1867):i>=19120730&&19261225>i?(g="大正",h=1911):i>=19261225&&19890108>i?(g="昭和",h=1925):i>=19890108&&(g="平成",h=1988),g&&h&&(a.transform.abbrevs["default"].number[g]||a.transform.loadAbbreviation("default","number",g),a.transform.abbrevs["default"].number[g]&&(g=a.transform.abbrevs["default"].number[g]),year=g+(b-h)),year},c.Util.Dates.year["short"]=function(a,b){return b=b.toString(),b&&4===b.length?b.substr(2):void 0},c.Util.Dates.year.numeric=function(a,b){var c,d;for(b=""+b,c=b.match(/([0-9]*)$/),c?(d=b.slice(0,-1*c[1].length),b=c[1]):(d=b,b="");b.length<4;)b="0"+b;return d+b},c.Util.Dates.normalizeMonth=function(a,b){var c;if(a||(a=0),a=""+a,a.match(/^[0-9]+$/)||(a=0),a=parseInt(a,10),b){var d={stub:"month-",num:a};d.num<1||d.num>20?d.num=0:d.num>16?(d.stub="season-",d.num=d.num-16):d.num>12&&(d.stub="season-",d.num=d.num-12),c=d}else(1>a||a>12)&&(a=0),c=a;return c},c.Util.Dates.month={},c.Util.Dates.month.numeric=function(a,b){var b=c.Util.Dates.normalizeMonth(b);return b||(b=""),b},c.Util.Dates.month["numeric-leading-zeros"]=function(a,b){var b=c.Util.Dates.normalizeMonth(b);if(b)for(b=""+b;b.length<2;)b="0"+b;else b="";return b},c.Util.Dates.month["long"]=function(a,b,d,e){var f=c.Util.Dates.normalizeMonth(b,!0),b=f.num;if(b){for(b=""+b;b.length<2;)b="0"+b;b=a.getTerm(f.stub+b,"long",0,0,!1,e)}else b="";return b},c.Util.Dates.month["short"]=function(a,b,d,e){var f=c.Util.Dates.normalizeMonth(b,!0),b=f.num;if(b){for(b=""+b;b.length<2;)b="0"+b;b=a.getTerm(f.stub+b,"short",0,0,!1,e)}else b="";return b},c.Util.Dates.day={},c.Util.Dates.day.numeric=function(a,b){return b.toString()},c.Util.Dates.day["long"]=c.Util.Dates.day.numeric,c.Util.Dates.day["numeric-leading-zeros"]=function(a,b){for(b||(b=0),b=b.toString();b.length<2;)b="0"+b;return b.toString()},c.Util.Dates.day.ordinal=function(a,b,c){return a.fun.ordinalizer.format(b,c)},c.Util.Sort={},c.Util.Sort.strip_prepositions=function(a){var b;return"string"==typeof a&&(b=a.toLocaleLowerCase(),b=a.match(/^((a|an|the)\s+)/)),b&&(a=a.substr(b[1].length)),a},c.Util.substituteStart=function(a,b){var d,e,f,g,h,i,j;g=function(a,b){for(var c=0,d=this.decorations.length;d>c;c+=1)if("@strip-periods"===this.decorations[c][0]&&"true"===this.decorations[c][1]){a.tmp.strip_periods+=1;break}},this.execs.push(g),this.decorations&&(a.opt.development_extensions.csl_reverse_lookup_support||a.sys.csl_reverse_lookup_support)&&(this.decorations.reverse(),this.decorations.push(["@showid","true",this.cslid]),this.decorations.reverse()),j=["number","date","names"],("text"===this.name&&!this.postponed_macro||j.indexOf(this.name)>-1)&&(d=function(a,b,c){"author"===a.tmp.element_trace.value()||"names"===this.name?c&&c["author-only"]?a.tmp.element_trace.push("do-not-suppress-me"):c&&c["suppress-author"]:c&&c["author-only"]?a.tmp.element_trace.push("suppress-me"):c&&c["suppress-author"]&&a.tmp.element_trace.push("do-not-suppress-me")},this.execs.push(d)),e=this.strings.cls,this.strings.cls=!1,0===a.build.render_nesting_level&&("bibliography"===a.build.area&&a.bibliography.opt["second-field-align"]?(f=new c.Token("group",c.START),f.decorations=[["@display","left-margin"]],g=function(a,b){a.tmp.render_seen||(f.strings.first_blob=b.id,a.output.startTag("bib_first",f))},f.execs.push(g),b.push(f)):c.DISPLAY_CLASSES.indexOf(e)>-1&&(f=new c.Token("group",c.START),f.decorations=[["@display",e]],g=function(a,b){f.strings.first_blob=b.id,a.output.startTag("bib_first",f)},f.execs.push(g),b.push(f)),a.build.cls=e),a.build.render_nesting_level+=1,1===a.build.substitute_level.value()&&(h=new c.Token("choose",c.START),c.Node.choose.build.call(h,a,b),i=new c.Token("if",c.START),g=function(b,c){return a.tmp.can_substitute.value()?!0:!1},i.tests.push(g),i.test=a.fun.match.any(this,a,i.tests),b.push(i)),a.sys.variableWrapper&&this.variables_real&&this.variables_real.length&&(g=function(a,b,d){if(!a.tmp.just_looking&&!a.tmp.suppress_decorations){variable_entry=new c.Token("text",c.START),variable_entry.decorations=[["@showid","true"]],a.output.startTag("variable_entry",variable_entry);var e=null;d&&(e=d.position),e||(e=0);var f=["first","subsequent","ibid","ibid-with-locator"],g=0;d&&d.noteIndex&&(g=d.noteIndex);var h=0;d&&d["first-reference-note-number"]&&(h=d["first-reference-note-number"]);var i=0;d&&d["citation-number"]&&(i=d["citation-number"]);var j=0;d&&d.index&&(j=d.index);var k={itemData:b,variableNames:this.variables,context:a.tmp.area,xclass:a.opt.xclass,position:f[e],"note-number":g,"first-reference-note-number":h,"citation-number":i,index:j,mode:a.opt.mode};a.output.current.value().params=k}},this.execs.push(g))},c.Util.substituteEnd=function(a,b){var d,e,f,g,h,i,j,k,l;a.sys.variableWrapper&&(this.hasVariable||this.variables_real&&this.variables_real.length)&&(d=function(a,b){a.tmp.just_looking||a.tmp.suppress_decorations||a.output.endTag("variable_entry")},this.execs.push(d)),d=function(a,b){for(var c=0,d=this.decorations.length;d>c;c+=1)if("@strip-periods"===this.decorations[c][0]&&"true"===this.decorations[c][1]){a.tmp.strip_periods+=-1;break}},this.execs.push(d),a.build.render_nesting_level+=-1,0===a.build.render_nesting_level&&(a.build.cls?(d=function(a,b){a.output.endTag("bib_first")},this.execs.push(d),a.build.cls=!1):"bibliography"===a.build.area&&a.bibliography.opt["second-field-align"]&&(e=new c.Token("group",c.END),d=function(a,b){a.tmp.render_seen||a.output.endTag()},e.execs.push(d),b.push(e),f=new c.Token("group",c.START),f.decorations=[["@display","right-inline"]],d=function(a,b){a.tmp.render_seen||(a.tmp.render_seen=!0,a.output.startTag("bib_other",f))},f.execs.push(d),b.push(f))),1===a.build.substitute_level.value()&&(g=new c.Token("if",c.END),b.push(g),h=new c.Token("choose",c.END),c.Node.choose.build.call(h,a,b)),i="names"===this.name&&0===a.build.substitute_level.value(),j="string"==typeof a[a.build.area].opt["subsequent-author-substitute"];var m=a[a.build.area].opt["subsequent-author-substitute-rule"];i&&j&&(k=new c.Token("text",c.SINGLETON),d=function(a,b){var d,e,f=!a.tmp.suppress_decorations;if(f&&"bibliography"===a.tmp.area&&a.tmp.subsequent_author_substitute_ok&&a.tmp.rendered_name)if("partial-each"===m||"partial-first"===m){var g=!0,h=[];for(d=0,e=a.tmp.name_node.children.length;e>d;d+=1){var i=a.tmp.rendered_name[d];g&&a.tmp.last_rendered_name&&a.tmp.last_rendered_name.length>d-1&&i&&!i.localeCompare(a.tmp.last_rendered_name[d])?(l=new c.Blob(a[a.tmp.area].opt["subsequent-author-substitute"]),a.tmp.name_node.children[d].blobs=[l],"partial-first"===m&&(g=!1)):g=!1,h.push(i)}a.tmp.last_rendered_name=h}else if("complete-each"===m){var h=a.tmp.rendered_name.join(",");if(h){if(!h.localeCompare(a.tmp.last_rendered_name))for(d=0,e=a.tmp.name_node.children.length;e>d;d+=1)l=new c.Blob(a[a.tmp.area].opt["subsequent-author-substitute"]),a.tmp.name_node.children[d].blobs=[l];a.tmp.last_rendered_name=h}}else{var h=a.tmp.rendered_name.join(",");h&&(h.localeCompare(a.tmp.last_rendered_name)||(l=new c.Blob(a[a.tmp.area].opt["subsequent-author-substitute"]),a.tmp.label_blob?a.tmp.name_node.top.blobs=[l,a.tmp.label_blob]:a.tmp.name_node.top.blobs=[l]),a.tmp.last_rendered_name=h)}},k.execs.push(d),b.push(k)),("text"===this.name&&!this.postponed_macro||["number","date","names"].indexOf(this.name)>-1)&&(d=function(a,b){a.tmp.element_trace.pop()},this.execs.push(d))},c.Util.padding=function(a){var b=a.match(/\s*(-{0,1}[0-9]+)/);if(b)for(a=parseInt(b[1],10),0>a&&(a=1e20+a),a=""+a;a.length<20;)a="0"+a;return a},c.Util.LongOrdinalizer=function(){},c.Util.LongOrdinalizer.prototype.init=function(a){this.state=a},c.Util.LongOrdinalizer.prototype.format=function(a,b){10>a&&(a="0"+a);var d=c.Engine.getField(c.LOOSE,this.state.locale[this.state.opt.lang].terms,"long-ordinal-"+a,"long",0,b);return d||(d=this.state.fun.ordinalizer.format(a,b)),this.state.tmp.cite_renders_content=!0,d},c.Util.Ordinalizer=function(a){this.state=a,this.suffixes={}},c.Util.Ordinalizer.prototype.init=function(){if(!this.suffixes[this.state.opt.lang]){this.suffixes[this.state.opt.lang]={};for(var a=0,b=3;b>a;a+=1){var c=[void 0,"masculine","feminine"][a];this.suffixes[this.state.opt.lang][c]=[];for(var d=1;5>d;d+=1){var e=this.state.getTerm("ordinal-0"+d,"long",!1,c);if("undefined"==typeof e){delete this.suffixes[this.state.opt.lang][c];break}this.suffixes[this.state.opt.lang][c].push(e)}}}},c.Util.Ordinalizer.prototype.format=function(a,b){var c;a=parseInt(a,10),c=""+a;var d="",e=[];if(b&&e.push(b),e.push("neuter"),this.state.locale[this.state.opt.lang].ord["1.0.1"]){d=this.state.getTerm("ordinal",!1,0,b);for(var f,g=0,h=e.length;h>g;g+=1){f=e[g];var i=this.state.locale[this.state.opt.lang].ord["1.0.1"];if(i["whole-number"][c]&&i["whole-number"][c][f]?d=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["whole-number"][c][f],!1,0,b):i["last-two-digits"][c.slice(c.length-2)]&&i["last-two-digits"][c.slice(c.length-2)][f]?d=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-two-digits"][c.slice(c.length-2)][f],!1,0,b):i["last-digit"][c.slice(c.length-1)]&&i["last-digit"][c.slice(c.length-1)][f]&&(d=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-digit"][c.slice(c.length-1)][f],!1,0,b)),d)break}}else b||(b=void 0),this.state.fun.ordinalizer.init(),d=a/10%10===1||a>10&&20>a?this.suffixes[this.state.opt.lang][b][3]:a%10===1&&a%100!==11?this.suffixes[this.state.opt.lang][b][0]:a%10===2&&a%100!==12?this.suffixes[this.state.opt.lang][b][1]:a%10===3&&a%100!==13?this.suffixes[this.state.opt.lang][b][2]:this.suffixes[this.state.opt.lang][b][3];return c=c+=d},c.Util.Romanizer=function(){},c.Util.Romanizer.prototype.format=function(a){var b,d,e,f,g;if(b="",6e3>a)for(f=a.toString().split(""),f.reverse(),d=0,e=0,g=f.length,d=0;g>d;d+=1)e=parseInt(f[d],10),b=c.ROMAN_NUMERALS[d][e]+b;return b},c.Util.Suffixator=function(a){a||(a=c.SUFFIX_CHARS),this.slist=a.split(",")},c.Util.Suffixator.prototype.format=function(a){var b;a+=1;var c="";do b=a%26===0?26:a%26,c=this.slist[b-1]+c,a=(a-b)/26;while(0!==a);return c},c.Engine.prototype.processNumber=function(a,b,d,e){var f,g,h,i,j,k;if(this.tmp.shadow_numbers[d]){if(this.tmp.shadow_numbers[d].numeric)for(var h=0,i=this.tmp.shadow_numbers[d].values.length;i>h;h+=2)this.tmp.shadow_numbers[d].values[h][2]=a}else if(this.tmp.shadow_numbers[d]={},this.tmp.shadow_numbers[d].values=[],this.tmp.shadow_numbers[d].plural=0,this.tmp.shadow_numbers[d].numeric=!1,this.tmp.shadow_numbers[d].label=!1,b){var l=c.LangPrefsMap[d];if(l){var m=this.opt["cite-lang-prefs"][l][0];f=this.transform.getTextSubField(b,d,"locale-"+m,!0),f=f.name}else f=b[d];if(f&&this.sys.getAbbreviation){f=(""+f).replace(/^\"/,"").replace(/\"$/,"");var n=this.transform.loadAbbreviation(b.jurisdiction,"number",f);this.transform.abbrevs[n].number[f]?f=this.transform.abbrevs[n].number[f]:"undefined"!=typeof this.transform.abbrevs[n].number[f]&&delete this.transform.abbrevs[n].number[f]}if("undefined"!=typeof f){if("number"==typeof f&&(f=""+f),this.tmp.shadow_numbers[d].label=d,'"'===f.slice(0,1)&&'"'===f.slice(-1)&&(f=f.slice(1,-1)),f&&["number-of-volumes","number-of-pages"].indexOf(d)>-1){var g=f.match(/[^0-9]*([0-9]+).*/);g&&(this.tmp.shadow_numbers[d].numeric=!0,"1"!==g[1]&&(this.tmp.shadow_numbers[d].plural=1))}"locator"===d&&["bill","gazette","legislation","treaty"].indexOf(e)>-1&&(f=f.split(c.STATUTE_SUBDIV_PLAIN_REGEX)[0]);var o="page";if(["bill","gazette","legislation","legal_case","treaty"].indexOf(e)>-1&&"collection-number"===d&&(o="year"),["page","page-first"].indexOf(d)>-1){var g=f.split(" ")[0].match(c.STATUTE_SUBDIV_GROUPED_REGEX);if(g){this.opt.development_extensions.static_statute_locator&&(this.tmp.shadow_numbers[d].label=c.STATUTE_SUBDIV_STRINGS[g[0]]);var p=f.match(/[^ ]+\s+(.*)/);p&&(f=p[1])}}for(var q=f.split(/(?:,\s+|\s*\\*[\-\u2013]+\s*|\s*&\s*)/),g=f.match(/(,\s+|\s*\\*[\-\u2013]+\s*|\s*&\s*)/g),r=[],h=0,i=q.length-1;i>h;h+=1)r.push(q[h]),r.push(g[h]);r.push(q[q.length-1]);for(var s=0,t=!0,h=0,i=r.length;i>h;h+=1){var u=h%2===0;if(u){if(r[h]){if(r[h].match(/(?:[0-9]|[xivcmlXIVCML])/))if(r[h-1]&&r[h-1].match(/^\s*\\*[\-\u2013]+\s*$/)){var v=this.tmp.shadow_numbers[d].values.slice(-1);if(-1==v[0][1].indexOf("\\")){if(r[h-2]&&(""+r[h-2]).match(/(:?[a-zA-Z]*[0-9]+$|^[ivxlcmIVXLCM]+$)/)&&r[h].match(/(?:^[a-zA-Z]*[0-9]+|^[ivxlcmIVXLCM]+$)/)){var w=this.tmp.shadow_numbers[d].values.slice(-2);if(v[0][1]=this.getTerm(o+"-range-delimiter"),this.opt[o+"-range-format"]){var x=this.fun[o+"_mangler"](w[0][1]+"-"+r[h]);x=x.split(this.getTerm(o+"-range-delimiter")),r[h]=x[1]}s+=1}v[0][1].indexOf("--")>-1&&(v[0][1]=v[0][1].replace(/--*/,"–"))}else v[0][1]=v[0][1].replace(/\\/,"","g")}else-1===r[h].indexOf(" ")&&(s+=1);for(var y=r[h].split(/\s+/),j=0,k=y.length;k>j;j+=1)this.opt.development_extensions.strict_page_numbers&&"page"===d&&!y[j].match(/^-*[0-9]/)?t=!1:y[j].match(/[-0-9]/)||(t=!1);if(r[h].match(/^[1-9][0-9]*$/))r[h]=parseInt(r[h],10),a&&"undefined"==typeof a.gender&&(a.gender=this.locale[this.opt.lang]["noun-genders"][d],a.gender||(a.gender="")),this.tmp.shadow_numbers[d].values.push(["NumericBlob",r[h],a]);else{var z=r[h];this.tmp.shadow_numbers[d].values.push(["Blob",z,a])}}}else r[h]&&this.tmp.shadow_numbers[d].values.push(["Blob",r[h],void 0])}this.opt.development_extensions.strict_page_numbers&&"page"===d?-1===f.indexOf(" ")&&f.match(/^-*[0-9]/)?this.tmp.shadow_numbers[d].numeric=!0:this.tmp.shadow_numbers[d].numeric=t:-1===f.indexOf(" ")&&f.match(/[0-9]/)?this.tmp.shadow_numbers[d].numeric=!0:this.tmp.shadow_numbers[d].numeric=t,this.tmp.shadow_numbers[d].numeric||this.transform.loadAbbreviation(b.jurisdiction,"number",f),s>1&&(this.tmp.shadow_numbers[d].plural=1),1===b.force_pluralism?this.tmp.shadow_numbers[d].plural=1:0===b.force_pluralism&&(this.tmp.shadow_numbers[d].plural=0)}}},c.Util.PageRangeMangler={},c.Util.PageRangeMangler.getFunction=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=a.getTerm(b+"-range-delimiter");c=/([a-zA-Z]*)([0-9]+)\s*(?:\u2013|-)\s*([a-zA-Z]*)([0-9]+)/,f=function(c){for(e=c.length,d=1;e>d;d+=2)"object"==typeof c[d]&&(c[d]=c[d].join(""));var f=c.join("");return f=f.replace(/([^\\])\-/g,"$1"+a.getTerm(b+"-range-delimiter"))},g=function(a){var b,c,f,g="\\s+\\-\\s+",h=new RegExp("([^\\\\])["+t+"\\u2013]","g");a=a.replace(h,"$1 - ").replace(/\s+-\s+/g," - ");var i=new RegExp("([a-zA-Z]*[0-9]+"+g+"[a-zA-Z]*[0-9]+)","g"),j=new RegExp("[a-zA-Z]*[0-9]+"+g+"[a-zA-Z]*[0-9]+");if(b=a.match(i),c=a.split(j),0===c.length)f=b;else for(f=[c[0]],d=1,e=c.length;e>d;d+=1)f.push(b[d-1].replace(/\s*\-\s*/,"-","g")),f.push(c[d]);return f},h=function(a){for(a=""+a,l=g(a),e=l.length,d=1;e>d;d+=2)m=l[d].match(c),m&&(m[3]&&m[1]!==m[3]||(m[4].length<m[2].length&&(m[4]=m[2].slice(0,m[2].length-m[4].length)+m[4]),parseInt(m[2],10)<parseInt(m[4],10)&&(m[3]=t+m[1],l[d]=m.slice(1)))),
"string"==typeof l[d]&&(l[d]=l[d].replace("-",t,"g"));return l},i=function(a,b,c){e=a.length;for(var d=1,g=a.length;g>d;d+=2)a[d][3]=j(a[d][1],a[d][3],b,c),a[d][2].slice(1)===a[d][0]&&(a[d][2]=t);return f(a)},j=function(a,b,c,d){if(c||(c=0),n=(""+a).split(""),o=(""+b).split(""),p=o.slice(),p.reverse(),n.length===o.length)for(var e=0,f=n.length;f>e;e+=1){if(!(n[e]===o[e]&&p.length>c)){if(c&&d&&3===p.length){var g=n.slice(0,e);g.reverse(),p=p.concat(g)}break}p.pop()}return p.reverse(),p.join("")},k=function(a){for(e=a.length,d=1;e>d;d+=2)"object"==typeof a[d]&&(m=a[d],q=parseInt(m[1],10),r=parseInt(m[3],10),q>100&&q%100&&parseInt(q/100,10)===parseInt(r/100,10)?m[3]=""+r%100:q>=1e4&&(m[3]=""+r%1e3)),m[2].slice(1)===m[0]&&(m[2]=t);return f(a)};var u=function(a,b,c,d){var e;a=""+a;var f=h(a),e=b(f,c,d);return e};return a.opt[b+"-range-format"]?"expanded"===a.opt[b+"-range-format"]?s=function(a){return u(a,f)}:"minimal"===a.opt[b+"-range-format"]?s=function(a){return u(a,i)}:"minimal-two"===a.opt[b+"-range-format"]?s=function(a,b){return u(a,i,2,b)}:"chicago"===a.opt[b+"-range-format"]&&(s=function(a){return u(a,k)}):s=function(a){return a},s},c.Util.FlipFlopper=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;for(this.state=a,this.blob=!1,this.quotechars=['"',"'"],b=[["<i>","</i>","italics","@font-style",["italic","normal","normal"],!0],["<b>","</b>","bold","@font-weight",["bold","normal","normal"],!0],["<sup>","</sup>","superscript","@vertical-align",["sup","sup","baseline"],!0],["<sub>","</sub>","subscript","@vertical-align",["sub","sub","baseline"],!0],["<sc>","</sc>","smallcaps","@font-variant",["small-caps","small-caps","normal"],!0],['<span style="font-variant:small-caps;">',"</span>","smallcaps","@font-variant",["small-caps","normal","normal"],!0],['<span class="nocase">',"</span>","passthrough","@passthrough",["true","true","true"],!0],['<span class="nodecor">',"</span>","passthrough","@passthrough",["true","true","true"],!0],['"','"',"quotes","@quotes",["true","inner","true"],"'"],[" '","'","quotes","@quotes",["inner","true","true"],'"']],c=0;2>c;c+=1){e=["-","-inner-"][c],f=[];var t=a.getTerm("open"+e+"quote");f.push(t),this.quotechars.push(t);var u=a.getTerm("close"+e+"quote");f.push(u),this.quotechars.push(u),f.push("quotes"),f.push("@quotes"),"-"===e?f.push(["true","inner"]):f.push(["inner","true"]),f.push(!0),"-"===e?f.push(a.getTerm("close-inner-quote")):f.push(a.getTerm("close-quote")),b.push(f)}for(g=function(a){for(h=[],d=a.length,c=0;d>c;c+=1)i=a[c],-1===h.indexOf(i[0])&&(j="",["(",")","[","]"].indexOf(i[0])>-1&&(j="\\"),h.push(j+i[0])),-1===h.indexOf(i[1])&&(j="",["(",")","[","]"].indexOf(i[1])>-1&&(j="\\"),h.push(j+i[1]));return h},r=g(b),s=[],c=0,d=r.length;d>c;c+=1)r[c]&&s.push(r[c]);r=s.slice(),this.allTagsRexMatch=new RegExp("("+r.join("|")+")","g"),this.allTagsRexSplit=new RegExp("(?:"+r.join("|")+")"),k=function(a){for(l={},m={},n={},o={},p={},d=a.length,c=0;d>c;c+=1)l[a[c][1]]=!0,m[a[c][1]]=a[c][5],n[a[c][0]]=a[c][1],o[a[c][0]]=[a[c][3],a[c][4]],p[a[c][3]]=[a[c][3],[a[c][4][2],a[c][1]]];return[l,m,n,o,p]},q=k(b),this.closeTagsHash=q[0],this.flipTagsHash=q[1],this.openToCloseHash=q[2],this.openToDecorations=q[3],this.okReverseHash=q[4]},c.Util.FlipFlopper.prototype.init=function(a,b){this.txt_esc=c.getSafeEscape(this.state),b?(this.blob=b,this.strs=this.getSplitStrings(this.blob.blobs),this.blob.blobs=[]):(this.strs=this.getSplitStrings(a),this.blob=new c.Blob),this.blobstack=new c.Stack(this.blob)},c.Util.FlipFlopper.prototype._normalizeString=function(a){var b,c;if(a=a.replace(/\s+'\s+/," ’ ","g"),a.indexOf(this.quotechars[0])>-1)for(b=0,c=2;c>b;b+=1)this.quotechars[b+2]&&(a=a.replace(this.quotechars[b+2],this.quotechars[0]));if(a.indexOf(this.quotechars[1])>-1)for(b=0,c=2;c>b;b+=1)this.quotechars[b+4]&&(a=0===b?a.replace(this.quotechars[b+4]," "+this.quotechars[1]):a.replace(this.quotechars[b+4],this.quotechars[1]));return a},c.Util.FlipFlopper.prototype.getSplitStrings=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;for(a=this._normalizeString(a),C=a.match(this.allTagsRexMatch),b=a.split(this.allTagsRexSplit),D=[b[0]],c=1,d=b.length;d>c;c+=1)D.push(C[c-1]),D.push(b[c]);for(b=D.slice(),d=b.length-2,c=d;c>0;c+=-2)"\\"===b[c-1].slice(b[c-1].length-1)&&(e=b[c-1].slice(0,b[c-1].length-1)+b[c]+b[c+1],f=b.slice(0,c-1),g=b.slice(c+2),f.push(e),b=f.concat(g));for(h=[],i=[],j=[],k=[],l=[],y=b.length-1,m=1;y>m;m+=2)if(q=b[m],this.closeTagsHash[q]&&(h.reverse(),n=this.openToCloseHash[q],o=h.indexOf(q),p=j.indexOf(q),h.reverse(),!n||o>-1&&(p>o||-1===p))){for(r=!1,z=h.length-1,s=z;s>-1;s+=-1){if(r=!0,t=h[s],q===t){h.pop(),i.pop(),j.pop(),k.pop();break}l.push(m)}r||l.push(m)}else this.openToCloseHash[q]&&(h.push(this.openToCloseHash[q]),i.push(q),j.push(this.flipTagsHash[q]),k.push(m));for(A=h.length-1,u=A;u>-1;u+=-1)h.pop(),j.pop(),i.pop(),l.push(k.pop());for(l.sort(function(a,b){return b>a?1:a>b?-1:0}),d=l.length,c=0;d>c;c+=1)B=l[c],f=b.slice(0,B-1),g=b.slice(B+2),v=b[B],v.length&&"<"!==v[0]&&this.openToDecorations[v]&&-1===this.quotechars.indexOf(v.replace(/\s+/g,""))&&(x=this.openToDecorations[v],v=this.state.fun.decorate[x[0]][x[1][0]](this.state)),w=b[B-1]+v+b[B+1],f.push(w),b=f.concat(g);for(d=b.length,c=0;d>c;c+=2)b[c]=b[c].replace("'","’","g"),b[c]=b[c].replace("  ’"," ’","g");return b},c.Util.FlipFlopper.prototype.processTags=function(){var a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;if(a=[],b=[],d=[],e=[],f="",1===this.strs.length)this.blob.blobs=this.strs[0];else if(this.strs.length>2){for(v=this.strs.length-1,g=1;v>g;g+=2)if(h=this.strs[g],i=this.strs[g-1],i&&(j=new c.Blob(i),k=this.blobstack.value(),k.push(j)),this.closeTagsHash[h]&&(a.reverse(),l=this.openToCloseHash[h],m=a.indexOf(h),n=d.indexOf(h),a.reverse(),!l||m>-1&&(n>m||-1===n))){for(w=a.length,o=w;o>-1;o+=-1)if(p=a[o],h===p){a.pop(),b.pop(),d.pop(),e.pop(),this.blobstack.pop();break}}else if(this.openToCloseHash[h]){if(a.push(this.openToCloseHash[h]),b.push(h),d.push(this.flipTagsHash[h]),k=this.blobstack.value(),q=new c.Blob,k.push(q),r=this.addFlipFlop(q,this.openToDecorations[h]),'<span class="nodecor">'===h)for(s=this.state[this.state.tmp.area].opt.topdecor.concat(this.blob.alldecor).concat([[["@quotes","inner"]]]),w=s.length,o=0;w>o;o+=1)for(t=s[o],y=t.length,x=0;y>x;x+=1)u=t[x],["@font-style","@font-weight","@font-variant"].indexOf(u[0])>-1&&(r=this.addFlipFlop(q,this.okReverseHash[u[0]]));e.push(this.state.fun.decorate[r[0]][r[1]](this.state)),this.blobstack.push(q)}this.strs.length>2&&(f=this.strs[this.strs.length-1],f&&(k=this.blobstack.value(),j=new c.Blob(f),k.push(j)))}return this.blob},c.Util.FlipFlopper.prototype.addFlipFlop=function(a,b){var c,d,e,f,g,h,i,j,k,l;for(d=0,e=this.state[this.state.tmp.area].opt.topdecor.concat(a.alldecor).concat([[["@quotes","inner"]]]),f=e.length,c=0;f>c;c+=1){for(g=e[c],h=!1,l=g.length-1,j=l;j>-1;j+=-1)if(i=g[j],i[0]===b[0]){i[1]===b[1][0]&&(d=1),h=!0;break}if(h)break}return k=[b[0],b[1][d]],a.decorations.reverse(),a.decorations.push(k),a.decorations.reverse(),k},c.Output.Formatters={},c.getSafeEscape=function(a){if(["bibliography","citation"].indexOf(a.tmp.area)>-1){var b=[];return a.opt.development_extensions.thin_non_breaking_space_html_hack&&"html"===a.opt.mode&&b.push(function(a){return a.replace(/\u202f/g,'<span style="white-space:nowrap">&thinsp;</span>')}),b.length?function(d){for(var e=0,f=b.length;f>e;e+=1)d=b[e](d);return c.Output.Formats[a.opt.mode].text_escape(d)}:c.Output.Formats[a.opt.mode].text_escape}return function(a){return a}},c.Output.Formatters.passthrough=function(a,b){return b},c.Output.Formatters.lowercase=function(a,b){var d=c.Output.Formatters.doppelString(b,c.TAG_USEALL);return d.string=d.string.toLowerCase(),c.Output.Formatters.undoppelString(d)},c.Output.Formatters.uppercase=function(a,b){var d=c.Output.Formatters.doppelString(b,c.TAG_USEALL);return d.string=d.string.toUpperCase(),c.Output.Formatters.undoppelString(d)},c.Output.Formatters["capitalize-first"]=function(a,b){var d=c.Output.Formatters.doppelString(b,c.TAG_ESCAPE);return d.string.length?(d.string=d.string.slice(0,1).toUpperCase()+d.string.substr(1),c.Output.Formatters.undoppelString(d)):""},c.Output.Formatters.sentence=function(a,b){var d=c.Output.Formatters.doppelString(b,c.TAG_ESCAPE);return d.string=d.string.slice(0,1).toUpperCase()+d.string.substr(1).toLowerCase(),c.Output.Formatters.undoppelString(d)},c.Output.Formatters["capitalize-all"]=function(a,b){for(var d=c.Output.Formatters.doppelString(b,c.TAG_ESCAPE),e=d.string.split(" "),f=0,g=e.length;g>f;f+=1)e[f].length>1?a.opt.development_extensions.allow_force_lowercase?e[f]=e[f].slice(0,1).toUpperCase()+e[f].substr(1).toLowerCase():e[f]=e[f].slice(0,1).toUpperCase()+e[f].substr(1):1===e[f].length&&(e[f]=e[f].toUpperCase());return d.string=e.join(" "),c.Output.Formatters.undoppelString(d)},c.Output.Formatters.title=function(a,b){function d(a){var b=a.match(/([:?!]+\s+|-|^)(.)(.*)/);return b?b[1]+b[2].toUpperCase()+b[3]:a}var e,f,g,h,i;a.locale[a.opt.lang].opts["skip-words"];if(!b)return"";var j=c.Output.Formatters.doppelString(b,c.TAG_ESCAPE),e=j.string,i=e.split(a.locale[a.opt.lang].opts["skip-words-regexp"]);for(k=1,l=i.length;l>k;k+=2)i[k].match(/^[:?!]/)&&(i[k]=d(i[k]));i[0]||(i[1]=d(i[1])),i.length>2&&!i[i.length-1]&&(i[i.length-2]=d(i[i.length-2]));for(var k=0,l=i.length;l>k;k+=2){for(var f=i[k].split(/([:?!]*\s+|-)/),m=0,n=f.length;n>m;m+=2)if(0!==f[m].length){if(g=f[m].toUpperCase(),h=f[m].toLowerCase(),f[m].match(/[0-9]/))continue;f[m]===h&&(f[m]=d(f[m]))}i[k]=f.join("")}j.string=i.join("");var o=c.Output.Formatters.undoppelString(j);return o},c.Output.Formatters.doppelString=function(a,b){var c;c={},c.array=b(a),c.string="";for(var d=0,e=c.array.length;e>d;d+=2)"-"===c.array[d-1],c.string+=c.array[d];return c},c.Output.Formatters.undoppelString=function(a){var b;b="";for(var c=0,d=a.array.length;d>c;c+=1)c%2?b+=a.array[c]:("-"===a.array[c-1],b+=a.string.slice(0,a.array[c].length),a.string=a.string.slice(a.array[c].length));return b},c.Output.Formatters.serializeItemAsRdf=function(a){return""},c.Output.Formatters.serializeItemAsRdfA=function(a){return""},c.demoteNoiseWords=function(a,b,c){var d=a.locale[a.opt.lang].opts["leading-noise-words"];if(b&&c){b=b.split(/\s+/),b.reverse();for(var e=[],f=b.length-1;f>-1&&d.indexOf(b[f].toLowerCase())>-1;f+=-1)e.push(b.pop());b.reverse();var g=b.join(" "),h=e.join(" ");"drop"!==c&&h?"demote"===c&&(b=[g,h].join(", ")):b=g}return b},c.Output.Formats=function(){},c.Output.Formats.prototype.html={text_escape:function(a){return a||(a=""),a.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace("  ","&#160; ","g").replace(c.SUPERSCRIPTS_REGEXP,function(a){return"<sup>"+c.SUPERSCRIPTS[a]+"</sup>"})},bibstart:'<div class="csl-bib-body">\n',bibend:"</div>","@font-style/italic":"<i>%%STRING%%</i>","@font-style/oblique":"<em>%%STRING%%</em>","@font-style/normal":'<span style="font-style:normal;">%%STRING%%</span>',"@font-variant/small-caps":'<span style="font-variant:small-caps;">%%STRING%%</span>',"@passthrough/true":c.Output.Formatters.passthrough,"@font-variant/normal":'<span style="font-variant:normal;">%%STRING%%</span>',"@font-weight/bold":"<b>%%STRING%%</b>","@font-weight/normal":'<span style="font-weight:normal;">%%STRING%%</span>',"@font-weight/light":!1,"@text-decoration/none":'<span style="text-decoration:none;">%%STRING%%</span>',"@text-decoration/underline":'<span style="text-decoration:underline;">%%STRING%%</span>',"@vertical-align/sup":"<sup>%%STRING%%</sup>","@vertical-align/sub":"<sub>%%STRING%%</sub>","@vertical-align/baseline":'<span style="baseline">%%STRING%%</span>',"@strip-periods/true":c.Output.Formatters.passthrough,"@strip-periods/false":c.Output.Formatters.passthrough,"@quotes/true":function(a,b){return"undefined"==typeof b?a.getTerm("open-quote"):a.getTerm("open-quote")+b+a.getTerm("close-quote")},"@quotes/inner":function(a,b){return"undefined"==typeof b?"’":a.getTerm("open-inner-quote")+b+a.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(a,b){return a.sys.wrapCitationEntry(b,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(a,b){var c="";return a.sys.embedBibliographyEntry&&(c=a.sys.embedBibliographyEntry(this.item_id)+"\n"),'  <div class="csl-entry">'+b+"</div>\n"+c},"@display/block":function(a,b){return'\n\n    <div class="csl-block">'+b+"</div>\n"},"@display/left-margin":function(a,b){return'\n    <div class="csl-left-margin">'+b+"</div>"},"@display/right-inline":function(a,b){return'<div class="csl-right-inline">'+b+"</div>\n  "},"@display/indent":function(a,b){return'<div class="csl-indent">'+b+"</div>\n  "},"@showid/true":function(a,b,d){if(a.tmp.just_looking||a.tmp.suppress_decorations)return b;if(d)return'<span class="'+a.opt.nodenames[d]+'" cslid="'+d+'">'+b+"</span>";if("string"==typeof b){var e="";if(b){var f=b.match(c.VARIABLE_WRAPPER_PREPUNCT_REX);e=f[1],b=f[2]}var g="";return b&&c.SWAPPING_PUNCTUATION.indexOf(b.slice(-1))>-1&&(g=b.slice(-1),b=b.slice(0,-1)),a.sys.variableWrapper(this.params,e,b,g)}return b},"@URL/true":function(a,b){return'<a href="'+b+'">'+b+"</a>"},"@DOI/true":function(a,b){return'<a href="http://dx.doi.org/'+b+'">'+b+"</a>"}},c.Output.Formats.prototype.text={text_escape:function(a){return a||(a=""),a},bibstart:"",bibend:"","@font-style/italic":!1,"@font-style/oblique":!1,"@font-style/normal":!1,"@font-variant/small-caps":!1,"@passthrough/true":c.Output.Formatters.passthrough,"@font-variant/normal":!1,"@font-weight/bold":!1,"@font-weight/normal":!1,"@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":!1,"@vertical-align/baseline":!1,"@vertical-align/sup":!1,"@vertical-align/sub":!1,"@strip-periods/true":c.Output.Formatters.passthrough,"@strip-periods/false":c.Output.Formatters.passthrough,"@quotes/true":function(a,b){return"undefined"==typeof b?a.getTerm("open-quote"):a.getTerm("open-quote")+b+a.getTerm("close-quote")},"@quotes/inner":function(a,b){return"undefined"==typeof b?"’":a.getTerm("open-inner-quote")+b+a.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(a,b){return a.sys.wrapCitationEntry(b,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(a,b){return b+"\n"},"@display/block":function(a,b){return"\n"+b},"@display/left-margin":function(a,b){return b},"@display/right-inline":function(a,b){return b},"@display/indent":function(a,b){return"\n    "+b},"@showid/true":function(a,b,c){return b},"@URL/true":function(a,b){return b},"@DOI/true":function(a,b){return b}},c.Output.Formats.prototype.rtf={text_escape:function(a){return a||(a=""),a.replace(/([\\{}])/g,"\\$1","g").replace(c.SUPERSCRIPTS_REGEXP,function(a){return"\\super "+c.SUPERSCRIPTS[a]+"\\nosupersub{}"}).replace(/[\u007F-\uFFFF]/g,function(a){return"\\uc0\\u"+a.charCodeAt(0).toString()+"{}"}).replace("	","\\tab{}","g")},"@passthrough/true":c.Output.Formatters.passthrough,"@font-style/italic":"\\i %%STRING%%\\i0{}","@font-style/normal":"\\i0{}%%STRING%%\\i{}","@font-style/oblique":"\\i %%STRING%%\\i0{}","@font-variant/small-caps":"\\scaps %%STRING%%\\scaps0{}","@font-variant/normal":"\\scaps0{}%%STRING%%\\scaps{}","@font-weight/bold":"\\b %%STRING%%\\b0{}","@font-weight/normal":"\\b0{}%%STRING%%\\b{}","@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":"\\ul %%STRING%%\\ul0{}","@vertical-align/baseline":!1,"@vertical-align/sup":"\\super %%STRING%%\\nosupersub{}","@vertical-align/sub":"\\sub %%STRING%%\\nosupersub{}","@strip-periods/true":c.Output.Formatters.passthrough,"@strip-periods/false":c.Output.Formatters.passthrough,"@quotes/true":function(a,b){return"undefined"==typeof b?c.Output.Formats.rtf.text_escape(a.getTerm("open-quote")):c.Output.Formats.rtf.text_escape(a.getTerm("open-quote"))+b+c.Output.Formats.rtf.text_escape(a.getTerm("close-quote"))},"@quotes/inner":function(a,b){return"undefined"==typeof b?c.Output.Formats.rtf.text_escape("’"):c.Output.Formats.rtf.text_escape(a.getTerm("open-inner-quote"))+b+c.Output.Formats.rtf.text_escape(a.getTerm("close-inner-quote"))},"@quotes/false":!1,bibstart:"{\\rtf ",bibend:"}","@display/block":"\\line{}%%STRING%%\\line\r\n","@cite/entry":function(a,b){return b},"@cite/entry":function(a,b){return a.sys.wrapCitationEntry(b,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(a,b){return b},"@display/left-margin":function(a,b){return b+"\\tab "},"@display/right-inline":function(a,b){return b+"\n"},"@display/indent":function(a,b){return"\n\\tab "+b},"@showid/true":function(a,b,d){if(a.tmp.just_looking||a.tmp.suppress_decorations)return b;var e="";if(b){var f=b.match(c.VARIABLE_WRAPPER_PREPUNCT_REX);e=f[1],b=f[2]}var g="";return b&&c.SWAPPING_PUNCTUATION.indexOf(b.slice(-1))>-1&&(g=b.slice(-1),b=b.slice(0,-1)),a.sys.variableWrapper(this.params,e,b,g)},"@URL/true":function(a,b){return b},"@DOI/true":function(a,b){return b}},c.Output.Formats=new c.Output.Formats,c.Registry=function(a){var b,d,e;this.debug=!1,this.state=a,this.registry={},this.reflist=[],this.namereg=new c.Registry.NameReg(a),this.citationreg=new c.Registry.CitationReg(a),this.authorstrings={},this.mylist=[],this.myhash={},this.deletes=[],this.inserts=[],this.uncited={},this.refreshes={},this.akeys={},this.oldseq={},this.return_data={},this.ambigcites={},this.ambigresets={},this.sorter=new c.Registry.Comparifier(a,"bibliography_sort"),this.getSortedIds=function(){for(b=[],d=0,e=this.reflist.length;e>d;d+=1)b.push(""+this.reflist[d].id);return b},this.getSortedRegistryItems=function(){for(b=[],d=0,e=this.reflist.length;e>d;d+=1)b.push(this.reflist[d]);return b}},c.Registry.prototype.init=function(a,b){var c,d;if(this.oldseq={},b){this.uncited={};for(var c=0,d=a.length;d>c;c+=1)this.myhash[a[c]]||this.mylist.push(""+a[c]),this.uncited[a[c]]=!0,this.myhash[a[c]]=!0}else{for(var e in this.uncited)a.push(e);var f={};for(c=a.length-1;c>-1;c+=-1)f[a[c]]?a=a.slice(0,c).concat(a.slice(c+1)):f[a[c]]=!0;this.mylist=[];for(var c=0,d=a.length;d>c;c+=1)this.mylist.push(""+a[c]);this.myhash=f}this.refreshes={},this.touched={},this.ambigsTouched={},this.ambigresets={}},c.Registry.prototype.dopurge=function(a){for(var b=this.mylist.length-1;b>-1;b+=-1)this.citationreg.citationsByItemId&&(this.citationreg.citationsByItemId[this.mylist[b]]||a[this.mylist[b]]||(delete this.myhash[this.mylist[b]],this.mylist=this.mylist.slice(0,b).concat(this.mylist.slice(b+1))));this.dodeletes(this.myhash)},c.Registry.prototype.dodeletes=function(a){var b,c,d,e,f,g,h,i,j;"string"==typeof a&&(a={},a[a]=!0);for(c in this.registry)if(!a[c]){if(this.uncited[c])continue;b=this.namereg.delitems(c);for(h in b)this.refreshes[h]=!0;for(d=this.registry[c].ambig,i=this.ambigcites[d].indexOf(c),i>-1&&(g=this.ambigcites[d].slice(),this.ambigcites[d]=g.slice(0,i).concat(g.slice(i+1,g.length)),this.ambigresets[d]=this.ambigcites[d].length),f=this.ambigcites[d].length,e=0;f>e;e+=1)j=""+this.ambigcites[d][e],this.refreshes[j]=!0;if(this.registry[c].siblings)if(1==this.registry[c].siblings.length){var k=this.registry[c].siblings[0];this.registry[k].master=!0,this.registry[k].siblings.pop(),this.registry[k].parallel=!1}else if(this.registry[c].siblings.length>1){var l=[c];if(this.registry[c].master){var m=this.registry[c].siblings[0],n=this.registry[m];n.master=!0,n.parallel=!1,l.push(m);for(var o=0,p=this.registry[c].siblings.length;p>o;o+=1)this.registry[this.registry[c].siblings[o]].parallel=m}for(var q=[],o=this.registry[c].siblings.length-1;o>-1;o+=-1){var r=this.registry[c].siblings.pop();-1===l.indexOf(r)&&q.push(r)}for(var o=q.length-1;o>-1;o+=-1)this.registry[c].siblings.push(q[o])}delete this.registry[c],this.return_data.bibchange=!0}},c.Registry.prototype.doinserts=function(a){var b,d,e,f,g,h,i;for("string"==typeof a&&(a=[a]),h=0,i=a.length;i>h;h+=1)b=a[h],this.registry[b]||(d=this.state.retrieveItem(b),e=c.getAmbiguousCite.call(this.state,d),this.ambigsTouched[e]=!0,d.legislation_id||(this.akeys[e]=!0),f={id:""+b,seq:0,offset:0,sortkeys:!1,ambig:!1,rendered:!1,disambig:!1,ref:d},this.registry[b]=f,this.citationreg.citationsByItemId&&this.citationreg.citationsByItemId[b]&&(this.registry[b]["first-reference-note-number"]=this.citationreg.citationsByItemId[b][0].properties.noteIndex),g=c.getAmbigConfig.call(this.state),this.registerAmbigToken(e,b,g),this.touched[b]=!0,this.return_data.bibchange=!0)},c.Registry.prototype.rebuildlist=function(){var a,b,d;for(this.reflist=[],this.state.opt.citation_number_sort_direction===c.DESCENDING&&this.state.opt.citation_number_sort_used,a=this.mylist.length,b=0;a>b;b+=1)d=this.mylist[b],this.reflist.push(this.registry[d]),this.oldseq[d]=this.registry[d].seq,this.registry[d].seq=b+1;this.state.opt.citation_number_sort_direction===c.DESCENDING&&this.state.opt.citation_number_sort_used},c.Registry.prototype.dorefreshes=function(){var a,b,d,e,f;for(a in this.refreshes)if(b=this.registry[a]){b.sortkeys=void 0,d=this.state.retrieveItem(a);var e=b.ambig;"undefined"==typeof e&&(this.state.tmp.disambig_settings=!1,e=c.getAmbiguousCite.call(this.state,d),f=c.getAmbigConfig.call(this.state),this.registerAmbigToken(e,a,f));for(var g in this.ambigresets)if(1===this.ambigresets[g]){var h=this.ambigcites[e][0],d=this.state.retrieveItem(h);this.registry[h].disambig=new c.AmbigConfig,this.state.tmp.disambig_settings=!1;var e=c.getAmbiguousCite.call(this.state,d),f=c.getAmbigConfig.call(this.state);this.registerAmbigToken(e,h,f)}this.state.tmp.taintedItemIDs[a]=!0,this.ambigsTouched[e]=!0,d.legislation_id||(this.akeys[e]=!0),this.touched[a]=!0}},c.Registry.prototype.setdisambigs=function(){var a;this.leftovers=[];for(a in this.ambigsTouched)this.state.disambiguate.run(a);this.ambigsTouched={},this.akeys={}},c.Registry.prototype.renumber=function(){var a,b,d;for(this.state.opt.citation_number_sort_direction===c.DESCENDING&&this.state.opt.citation_number_sort_used,a=this.reflist.length,b=0;a>b;b+=1)d=this.reflist[b],d.seq=b+1,this.state.opt.update_mode===c.NUMERIC&&d.seq!=this.oldseq[d.id]&&(this.state.tmp.taintedItemIDs[d.id]=!0),this.state.opt.bib_mode===c.NUMERIC&&d.seq!=this.oldseq[d.id]&&(this.return_data.bibchange=!0);this.state.opt.citation_number_sort_direction===c.DESCENDING&&this.state.opt.citation_number_sort_used&&this.reflist.reverse()},c.Registry.prototype.setsortkeys=function(){for(var a,b=0,d=this.mylist.length;d>b;b+=1){var a=this.mylist[b];(this.touched[a]||this.state.tmp.taintedItemIDs[a]||!this.registry[a].sortkeys)&&(this.registry[a].sortkeys=c.getSortKeys.call(this.state,this.state.retrieveItem(a),"bibliography_sort"))}},c.Registry.prototype.sorttokens=function(){this.reflist.sort(this.sorter.compareKeys)},c.Registry.Comparifier=function(a,b){var d,e,f,g,h=c.getSortCompare(a.opt["default-locale-sort"]);d=a[b].opt.sort_directions,this.compareKeys=function(a,b){for(e=a.sortkeys?a.sortkeys.length:0,f=0;e>f;f+=1){var c=0;if(c=a.sortkeys[f]===b.sortkeys[f]?0:"undefined"==typeof a.sortkeys[f]?d[f][1]:"undefined"==typeof b.sortkeys[f]?d[f][0]:h(a.sortkeys[f],b.sortkeys[f]),c>0)return d[f][1];if(0>c)return d[f][0]}return a.seq>b.seq?1:a.seq<b.seq?-1:0},g=this.compareKeys,this.compareCompositeKeys=function(a,b){return g(a[1],b[1])}},c.Registry.prototype.compareRegistryTokens=function(a,b){return a.seq>b.seq?1:a.seq<b.seq?-1:0},c.Registry.prototype.registerAmbigToken=function(a,b,d){if(this.registry[b]&&this.registry[b].disambig&&this.registry[b].disambig.names)for(var e=0,f=d.names.length;f>e;e+=1){var g=d.names[e],h=this.registry[b].disambig.names[e];if(g!==h)this.state.tmp.taintedItemIDs[b]=!0;else if(d.givens[e])for(var i=0,j=d.givens[e].length;j>i;i+=1){var k=d.givens[e][i],l=this.registry[b].disambig.givens[e][i];k!==l&&(this.state.tmp.taintedItemIDs[b]=!0)}}this.ambigcites[a]||(this.ambigcites[a]=[]),-1===this.ambigcites[a].indexOf(""+b)&&this.ambigcites[a].push(""+b),this.registry[b].ambig=a;this.registry[b].disambig=c.cloneAmbigConfig(d)},c.getSortKeys=function(a,b){var d,e,f,g,h,i;for(d=this.tmp.area,e=this.tmp.extension,f=c.Util.Sort.strip_prepositions,this.tmp.area=b,this.tmp.extension="_sort",this.tmp.disambig_override=!0,this.tmp.disambig_request=!1,g=this.parallel.use_parallels,this.parallel.use_parallels=!1,this.tmp.suppress_decorations=!0,c.getCite.call(this,a),this.tmp.suppress_decorations=!1,this.parallel.use_parallels=g,this.tmp.disambig_override=!1,h=this[b].keys.length,i=0;h>i;i+=1)this[b].keys[i]=f(this[b].keys[i]);return this.tmp.area=d,this.tmp.extension=e,this[b].keys},c.Registry.NameReg=function(a){var b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;this.state=a,this.namereg={},this.nameind={},this.nameindpkeys={},this.itemkeyreg={},j=function(a){return a||(a=""),a.replace("."," ","g").replace(/\s+/g," ").replace(/\s+$/,"")},k=function(a,f,g){b=j(g.family),e=j(g.given);var h=e.match(/[,\!]* ([^,]+)$/);h&&h[1]===h[1].toLowerCase()&&(e=e.replace(/[,\!]* [^,]+$/,"")),d=c.Util.Names.initializeWith(a,e,"%s"),"by-cite"===a.citation.opt["givenname-disambiguation-rule"]&&(b=""+f+b)},l=function(c,e,h,i,j,l){var m;if("bibliography"===a.tmp.area.slice(0,12)&&!j)return"string"==typeof l?1:2;var n=a.nameOutput.getName(e,"locale-translit",!0);e=n.name,k(this.state,""+c,e),m=2,f=a.opt["disambiguate-add-givenname"],g=a.citation.opt["givenname-disambiguation-rule"];var o=g;return"by-cite"===g&&(g="all-names"),"short"===j?m=0:"string"==typeof l&&(m=1),"undefined"==typeof this.namereg[b]||"undefined"==typeof this.namereg[b].ikey[d]?m:"by-cite"===o&&i>=m?i:f?"string"==typeof g&&"primary-name"===g.slice(0,12)&&h>0?m:(g&&"all-names"!==g&&"primary-name"!==g?("all-names-with-initials"===g||"primary-name-with-initials"===g)&&(m=this.namereg[b].count>1?1:0):(this.namereg[b].count>1&&(m=1),(this.namereg[b].ikey&&this.namereg[b].ikey[d].count>1||this.namereg[b].count>1&&"string"!=typeof l)&&(m=2)),a.registry.registry[c]?m:"short"==j?0:"string"==typeof l?1:void 0):m},m=function(c){var f,g,j,k,l;for(("string"==typeof c||"number"==typeof c)&&(c=[""+c]),h={},g=c.length,f=0;g>f;f+=1)if(k=""+c[f],this.nameind[k]){for(l in this.nameind[k])if(this.nameind[k].hasOwnProperty(l)){if(o=l.split("::"),b=o[0],d=o[1],e=o[2],"undefined"==typeof this.namereg[b])continue;if(i=this.namereg[b].items,e&&this.namereg[b].ikey[d]&&this.namereg[b].ikey[d].skey[e]&&(p=this.namereg[b].ikey[d].skey[e].items,j=p.indexOf(""+k),j>-1&&(this.namereg[b].ikey[d].skey[e].items=p.slice(0,j).concat(p.slice([j+1]))),0===this.namereg[b].ikey[d].skey[e].items.length&&(delete this.namereg[b].ikey[d].skey[e],this.namereg[b].ikey[d].count+=-1,this.namereg[b].ikey[d].count<2)))for(q=0,r=this.namereg[b].ikey[d].items.length;r>q;q+=1)a.tmp.taintedItemIDs[this.namereg[b].ikey[d].items[q]]=!0;if(d&&this.namereg[b].ikey[d]&&(j=this.namereg[b].ikey[d].items.indexOf(""+k),j>-1&&(i=this.namereg[b].ikey[d].items.slice(),this.namereg[b].ikey[d].items=i.slice(0,j).concat(i.slice([j+1]))),0===this.namereg[b].ikey[d].items.length&&(delete this.namereg[b].ikey[d],this.namereg[b].count+=-1,this.namereg[b].count<2)))for(q=0,r=this.namereg[b].items.length;r>q;q+=1)a.tmp.taintedItemIDs[this.namereg[b].items[q]]=!0;b&&(j=this.namereg[b].items.indexOf(""+k),j>-1&&(i=this.namereg[b].items.slice(),this.namereg[b].items=i.slice(0,j).concat(i.slice([j+1],i.length))),this.namereg[b].items.length<2&&delete this.namereg[b]),delete this.nameind[k][l]}delete this.nameind[k],delete this.nameindpkeys[k]}return h},n=function(c,f,g){var h,i,j=a.nameOutput.getName(f,"locale-translit",!0);if(f=j.name,!a.citation.opt["givenname-disambiguation-rule"]||"primary-"!==a.citation.opt["givenname-disambiguation-rule"].slice(0,8)||0===g){if(k(this.state,""+c,f),b&&("undefined"==typeof this.namereg[b]?(this.namereg[b]={},this.namereg[b].count=0,this.namereg[b].ikey={},this.namereg[b].items=[c]):-1===this.namereg[b].items.indexOf(c)&&this.namereg[b].items.push(c)),b&&d)if("undefined"==typeof this.namereg[b].ikey[d]){if(this.namereg[b].ikey[d]={},this.namereg[b].ikey[d].count=0,this.namereg[b].ikey[d].skey={},this.namereg[b].ikey[d].items=[c],this.namereg[b].count+=1,2===this.namereg[b].count)for(h=0,i=this.namereg[b].items.length;i>h;h+=1)a.tmp.taintedItemIDs[this.namereg[b].items[h]]=!0}else-1===this.namereg[b].ikey[d].items.indexOf(c)&&this.namereg[b].ikey[d].items.push(c);if(b&&d&&e)if("undefined"==typeof this.namereg[b].ikey[d].skey[e]){if(this.namereg[b].ikey[d].skey[e]={},this.namereg[b].ikey[d].skey[e].items=[c],this.namereg[b].ikey[d].count+=1,2===this.namereg[b].ikey[d].count)for(h=0,i=this.namereg[b].ikey[d].items.length;i>h;h+=1)a.tmp.taintedItemIDs[this.namereg[b].ikey[d].items[h]]=!0}else-1===this.namereg[b].ikey[d].skey[e].items.indexOf(c)&&this.namereg[b].ikey[d].skey[e].items.push(c);"undefined"==typeof this.nameind[c]&&(this.nameind[c]={},this.nameindpkeys[c]={}),b&&(this.nameind[c][b+"::"+d+"::"+e]=!0,this.nameindpkeys[c][b]=this.namereg[b])}},this.addname=n,this.delitems=m,this.evalname=l},c.Registry.CitationReg=function(a){this.citationById={},this.citationByIndex=[]},c.Disambiguation=function(a){this.state=a,this.sys=this.state.sys,this.registry=a.registry.registry,this.ambigcites=a.registry.ambigcites,this.configModes(),this.debug=!1},c.Disambiguation.prototype.run=function(a){this.modes.length&&(this.akey=a,this.initVars(a)&&this.runDisambig())},c.Disambiguation.prototype.runDisambig=function(){var a;for(this.initGivens=!0;this.lists.length;){for(this.gnameset=0,this.gname=0,this.clashes=[1,0];this.lists[0][1].length;){this.listpos=0,this.base||(this.base=this.lists[0][0]);a=this.incrementDisambig(),this.scanItems(this.lists[0]),this.evalScan(a)}this.lists=this.lists.slice(1)}},c.Disambiguation.prototype.scanItems=function(a){var b,d,e;this.Item=a[1][0],this.ItemCite=c.getAmbiguousCite.call(this.state,this.Item,this.base,!0),this.scanlist=a[1],this.partners=[],this.partners.push(this.Item),this.nonpartners=[];var f=0;for(b=1,d=a[1].length;d>b;b+=1){e=a[1][b];var g=c.getAmbiguousCite.call(this.state,e,this.base,!0);this.ItemCite===g?(f+=1,this.partners.push(e)):this.nonpartners.push(e)}this.clashes[0]=this.clashes[1],this.clashes[1]=f},c.Disambiguation.prototype.evalScan=function(a){this[this.modes[this.modeindex]](a),a&&(this.modeindex<this.modes.length-1?this.modeindex+=1:this.lists[this.listpos+1]=[this.base,[]])},c.Disambiguation.prototype.disNames=function(a){var b,c;if(0===this.clashes[1]&&1===this.nonpartners.length)this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase),this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,[]];else if(0===this.clashes[1])this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,this.nonpartners],this.nonpartners.length&&(this.initGivens=!0);else if(1===this.nonpartners.length)this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,this.partners];else if(this.clashes[1]<this.clashes[0])this.captureStepToBase(),this.lists[this.listpos]=[this.betterbase,this.partners],this.lists.push([this.betterbase,this.nonpartners]);else if(a&&(this.lists[this.listpos]=[this.betterbase,this.nonpartners],this.lists.push([this.betterbase,this.partners]),this.modeindex===this.modes.length-1)){for(b=0,c=this.partners.length;c>b;b+=1)this.state.registry.registerAmbigToken(this.akey,""+this.partners[b].id,this.betterbase);this.lists[this.listpos]=[this.betterbase,[]]}},c.Disambiguation.prototype.disExtraText=function(){var a=!1;if(0===this.clashes[1]&&this.nonpartners.length<2&&(a=!0),a||this.base.disambiguate&&this.state.tmp.disambiguate_count===this.state.tmp.disambiguate_maxMax){if(a||this.state.tmp.disambiguate_count===this.state.tmp.disambiguate_maxMax)if(a||this.modeindex===this.modes.length-1){for(var b=this.lists[this.listpos][0],c=0,d=this.lists[this.listpos][1].length;d>c;c+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][c].id]=!0,
this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][c].id,b);this.lists[this.listpos]=[this.betterbase,[]]}else{this.modeindex=this.modes.length-1;var b=this.lists[this.listpos][0];b.disambiguate=!0;for(var c=0,d=this.lists[this.listpos][1].length;d>c;c+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][c].id]=!0,this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][c].id,b)}}else if(this.modeindex=0,this.base.disambiguate=this.state.tmp.disambiguate_count,this.betterbase.disambiguate=this.state.tmp.disambiguate_count,this.base.disambiguate)this.disNames();else{this.initGivens=!0,this.base.disambiguate=1;for(var c=0,d=this.lists[this.listpos][1].length;d>c;c+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][c].id]=!0}},c.Disambiguation.prototype.disYears=function(){var a,b,d,e;d=[];var f=this.lists[this.listpos][0];if(this.clashes[1])for(var g=0,h=this.state.registry.mylist.length;h>g;g+=1)for(var i=this.state.registry.mylist[g],j=0,k=this.lists[this.listpos][1].length;k>j;j+=1){var e=this.lists[this.listpos][1][j];if(e.id==i){d.push(this.registry[e.id]);break}}for(d.sort(this.state.registry.sorter.compareKeys),a=0,b=d.length;b>a;a+=1){f.year_suffix=""+a;var l=this.state.registry.registry[d[a].id].disambig;this.state.registry.registerAmbigToken(this.akey,""+d[a].id,f),c.ambigConfigDiff(l,f)&&(this.state.tmp.taintedItemIDs[d[a].id]=!0)}this.lists[this.listpos]=[this.betterbase,[]]},c.Disambiguation.prototype.incrementDisambig=function(){if(this.initGivens)return this.initGivens=!1,!1;var a=!1,b=!0;if("disNames"===this.modes[this.modeindex]){b=!1,"number"!=typeof this.givensMax&&(b=!0);var c=!1;if("number"!=typeof this.namesMax&&(c=!0),"number"==typeof this.givensMax&&(this.base.givens.length&&this.base.givens[this.gnameset][this.gname]<this.givensMax?this.base.givens[this.gnameset][this.gname]+=1:b=!0),"number"==typeof this.namesMax&&b&&(this.state.opt["disambiguate-add-names"]?(c=!1,this.gname<this.namesMax?(this.base.names[this.gnameset]+=1,this.gname+=1):c=!0):c=!0),"number"==typeof this.namesetsMax&&c)if(this.gnameset<this.namesetsMax)this.gnameset+=1,this.base.names[this.gnameset]=1,this.gname=0;else;"number"==typeof this.namesetsMax&&-1!==this.namesetsMax&&this.gnameset!==this.namesetsMax||this.state.opt["disambiguate-add-names"]&&"number"==typeof this.namesMax&&this.gname!==this.namesMax||"number"==typeof this.givensMax&&"undefined"!=typeof this.base.givens[this.gnameset]&&"undefined"!=typeof this.base.givens[this.gnameset][this.gname]&&this.base.givens[this.gnameset][this.gname]!==this.givensMax||(a=!0)}else"disExtraText"===this.modes[this.modeindex]&&(this.base.disambiguate+=1,this.betterbase.disambiguate+=1);return a},c.Disambiguation.prototype.initVars=function(a){var b,d,e,f,g;if(this.lists=[],this.base=!1,this.betterbase=!1,this.akey=a,this.maxNamesByItemId={},f=[],e=this.ambigcites[a],!e||!e.length)return!1;var h=this.state.retrieveItem(""+e[0]);if(this.getCiteData(h),this.base=c.getAmbigConfig.call(this.state),e&&e.length>1){for(f.push([this.maxNamesByItemId[h.id],h]),b=1,d=e.length;d>b;b+=1)h=this.state.retrieveItem(""+e[b]),this.getCiteData(h,this.base),f.push([this.maxNamesByItemId[h.id],h]);for(f.sort(function(a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:a[1].id>b[1].id?1:a[1].id<b[1].id?-1:0}),g=[],b=0,d=f.length;d>b;b+=1)g.push(f[b][1]);this.lists.push([this.base,g]),this.Item=this.lists[0][1][0]}else this.Item=this.state.retrieveItem(""+e[0]);if(this.modeindex=0,this.state.citation.opt["disambiguate-add-names"],0)for(var i=this.base.names[0],b=1,d=this.base.names.length;d>b;b+=1)i=Math.max(i,this.base.names.names[b]);else this.namesMax=this.maxNamesByItemId[this.Item.id][0];return this.padBase(this.base),this.padBase(this.betterbase),this.base.year_suffix=!1,this.base.disambiguate=!1,this.betterbase.year_suffix=!1,this.betterbase.disambiguate=!1,"by-cite"===this.state.citation.opt["givenname-disambiguation-rule"]&&this.state.opt["disambiguate-add-givenname"]&&(this.givensMax=2),!0},c.Disambiguation.prototype.padBase=function(a){for(var b=0,c=a.names.length;c>b;b+=1){a.givens[b]||(a.givens[b]=[]);for(var d=0,e=a.names[b];e>d;d+=1)a.givens[b][d]||(a.givens[b][d]=0)}},c.Disambiguation.prototype.configModes=function(){var a,b;this.modes=[],a=this.state.opt["disambiguate-add-givenname"],b=this.state.citation.opt["givenname-disambiguation-rule"],(this.state.opt["disambiguate-add-names"]||a&&"by-cite"===b)&&this.modes.push("disNames"),this.state.opt.has_disambiguate&&this.modes.push("disExtraText"),this.state.opt["disambiguate-add-year-suffix"]&&this.modes.push("disYears")},c.Disambiguation.prototype.getCiteData=function(a,b){if(!this.maxNamesByItemId[a.id]){c.getAmbiguousCite.call(this.state,a,b),b=c.getAmbigConfig.call(this.state),this.maxNamesByItemId[a.id]=c.getMaxVals.call(this.state),this.state.registry.registry[a.id].disambig.givens=this.state.tmp.disambig_settings.givens.slice();for(var d=0,e=this.state.registry.registry[a.id].disambig.givens.length;e>d;d+=1)this.state.registry.registry[a.id].disambig.givens[d]=this.state.tmp.disambig_settings.givens[d].slice();this.namesetsMax=this.state.registry.registry[a.id].disambig.names.length-1,this.base||(this.base=b,this.betterbase=c.cloneAmbigConfig(b)),b.names.length<this.base.names.length&&(this.base=b);for(var d=0,e=b.names.length;e>d;d+=1)b.names[d]>this.base.names[d]&&(this.base.givens[d]=b.givens[d].slice(),this.base.names[d]=b.names[d],this.betterbase.names=this.base.names.slice(),this.betterbase.givens=this.base.givens.slice(),this.padBase(this.base),this.padBase(this.betterbase));this.betterbase.givens=this.base.givens.slice();for(var f=0,g=this.base.givens.length;g>f;f+=1)this.betterbase.givens[f]=this.base.givens[f].slice()}},c.Disambiguation.prototype.captureStepToBase=function(){"by-cite"===this.state.citation.opt["givenname-disambiguation-rule"]&&this.base.givens&&this.base.givens.length&&"undefined"!=typeof this.base.givens[this.gnameset][this.gname]&&(this.betterbase.givens[this.gnameset][this.gname]=this.base.givens[this.gnameset][this.gname]),this.betterbase.names[this.gnameset]=this.base.names[this.gnameset]};var g={style:'<?xml version="1.0" encoding="utf-8"?>     <style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0" demote-non-dropping-particle="never">     <!-- This style was edited with the Visual CSL Editor (http://steveridout.com/csl/visualEditor/) -->     <info>         <title>American Psychological Association 6th edition</title>         <title-short>APA</title-short>         <id>http://www.zotero.org/styles/apa</id>         <link href="http://www.zotero.org/styles/apa" rel="self"/>         <link href="http://owl.english.purdue.edu/owl/resource/560/01/" rel="documentation"/>         <author>         <name>Simon Kornblith</name>         <email>simon@simonster.com</email>         </author>         <contributor>         <name>Bruce DArcus</name>         </contributor>         <contributor>         <name>Curtis M. Humphrey</name>         </contributor>         <contributor>         <name>Richard Karnesky</name>         <email>karnesky+zotero@gmail.com</email>         <uri>http://arc.nucapt.northwestern.edu/Richard_Karnesky</uri>         </contributor>         <contributor>         <name>Sebastian Karcher</name>         </contributor>         <category citation-format="author-date"/>         <category field="psychology"/>         <category field="generic-base"/>         <updated>2014-08-23T06:25:45+00:00</updated>         <rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights>     </info>     <locale xml:lang="en">         <terms>         <term name="editortranslator" form="short">             <single>ed. &amp; trans.</single>             <multiple>eds. &amp; trans.</multiple>         </term>         <term name="translator" form="short">             <single>trans.</single>             <multiple>trans.</multiple>         </term>         </terms>     </locale>     <macro name="container-contributors">         <choose>         <if type="chapter paper-conference" match="any">             <names variable="editor translator container-author" delimiter=", " suffix=", ">             <name and="symbol" initialize-with=". " delimiter=", "/>             <label form="short" prefix=" (" text-case="title" suffix=")"/>             </names>         </if>         </choose>     </macro>     <macro name="secondary-contributors">         <choose>         <if type="article-journal chapter paper-conference" match="none">             <names variable="translator editor container-author" delimiter=", " prefix=" (" suffix=")">             <name and="symbol" initialize-with=". " delimiter=", "/>             <label form="short" prefix=", " text-case="title"/>             </names>         </if>         </choose>     </macro>     <macro name="author">         <names variable="author">         <name name-as-sort-order="all" and="symbol" sort-separator=", " initialize-with=". " delimiter=", " delimiter-precedes-last="always"/>         <label form="short" prefix=" (" suffix=")" text-case="capitalize-first"/>         <substitute>             <names variable="editor"/>             <names variable="translator"/>             <choose>             <if type="report">                 <text variable="publisher"/>                 <text macro="title"/>             </if>             <else>                 <text macro="title"/>             </else>             </choose>         </substitute>         </names>     </macro>     <macro name="author-short">         <names variable="author">         <name form="short" and="symbol" delimiter=", " initialize-with=". "/>         <substitute>             <names variable="editor"/>             <names variable="translator"/>             <choose>             <if type="report">                 <text variable="publisher"/>                 <text variable="title" form="short" font-style="italic"/>             </if>             <else-if type="legal_case">                 <text variable="title" font-style="italic"/>             </else-if>             <else-if type="bill book graphic legislation motion_picture song" match="any">                 <text variable="title" form="short" font-style="italic"/>             </else-if>             <else>                 <text variable="title" form="short" quotes="true"/>             </else>             </choose>         </substitute>         </names>     </macro>     <macro name="access">         <choose>         <if type="thesis">             <choose>             <if variable="archive" match="any">                 <group>                 <text term="retrieved" text-case="capitalize-first" suffix=" "/>                 <text term="from" suffix=" "/>                 <text variable="archive" suffix="."/>                 <text variable="archive_location" prefix=" (" suffix=")"/>                 </group>             </if>             <else>                 <group>                 <text term="retrieved" text-case="capitalize-first" suffix=" "/>                 <text term="from" suffix=" "/>                 <text variable="URL"/>                 </group>             </else>             </choose>         </if>         <else>             <choose>             <if variable="DOI">                 <text variable="DOI" prefix="doi:"/>             </if>             <else>                 <choose>                 <if type="webpage">                     <group delimiter=" ">                     <text term="retrieved" text-case="capitalize-first" suffix=" "/>                     <group>                         <date variable="accessed" form="text" suffix=", "/>                     </group>                     <text term="from"/>                     <text variable="URL"/>                     </group>                 </if>                 <else>                     <group>                     <text term="retrieved" text-case="capitalize-first" suffix=" "/>                     <text term="from" suffix=" "/>                     <text variable="URL"/>                     </group>                 </else>                 </choose>             </else>             </choose>         </else>         </choose>     </macro>     <macro name="title">         <choose>         <if type="report thesis book graphic motion_picture report song manuscript speech" match="any">             <choose>             <if variable="version">                 <!---This is a hack until we have a computer program type -->                 <text variable="title"/>             </if>             <else>                 <text variable="title" font-style="italic"/>             </else>             </choose>         </if>         <else>             <text variable="title"/>         </else>         </choose>     </macro>     <macro name="title-plus-extra">         <text macro="title"/>         <choose>         <if type="report thesis" match="any">             <group prefix=" (" suffix=")" delimiter=" ">             <text variable="genre"/>             <text variable="number" prefix="No. "/>             </group>         </if>         <else-if type="post-weblog webpage" match="any">             <text variable="genre" prefix=" [" suffix="]"/>         </else-if>         <else-if variable="version">             <group delimiter=" " prefix=" (" suffix=")">             <text term="version" text-case="capitalize-first"/>             <text variable="version"/>             </group>         </else-if>         </choose>     </macro>     <macro name="publisher">         <choose>         <if type="report" match="any">             <group delimiter=": ">             <text variable="publisher-place"/>             <text variable="publisher"/>             </group>         </if>         <else-if type="thesis" match="any">             <group delimiter=", ">             <text variable="publisher"/>             <text variable="publisher-place"/>             </group>         </else-if>         <else-if type="post-weblog webpage" match="none">             <group delimiter=", ">             <choose>                 <if variable="event" type="speech" match="none">                 <text variable="genre"/>                 </if>             </choose>             <choose>                 <if type="article-journal article-magazine" match="none">                 <group delimiter=": ">                     <choose>                     <if variable="publisher-place">                         <text variable="publisher-place"/>                     </if>                     <else>                         <text variable="event-place"/>                     </else>                     </choose>                     <text variable="publisher"/>                 </group>                 </if>             </choose>             </group>         </else-if>         </choose>     </macro>     <macro name="event">         <choose>         <if variable="container-title" match="none">             <choose>             <if variable="event">                 <choose>                 <if variable="genre" match="none">                     <text term="presented at" text-case="capitalize-first" suffix=" "/>                     <text variable="event"/>                 </if>                 <else>                     <group delimiter=" ">                     <text variable="genre" text-case="capitalize-first"/>                     <text term="presented at"/>                     <text variable="event"/>                     </group>                 </else>                 </choose>             </if>             <else-if type="speech">                 <text variable="genre" text-case="capitalize-first"/>             </else-if>             </choose>         </if>         </choose>     </macro>     <macro name="issued">         <choose>         <if type="bill legal_case legislation" match="none">             <choose>             <if variable="issued">                 <group prefix=" (" suffix=")">                 <date variable="issued">                     <date-part name="year"/>                 </date>                 <text variable="year-suffix"/>                 <choose>                     <if type="article-journal bill book chapter graphic legal_case legislation motion_picture paper-conference report song" match="none">                     <date variable="issued">                         <date-part prefix=", " name="month"/>                         <date-part prefix=" " name="day"/>                     </date>                     </if>                 </choose>                 </group>             </if>             <else>                 <group prefix=" (" suffix=")">                 <text term="no date" form="short"/>                 <text variable="year-suffix" prefix="-"/>                 </group>             </else>             </choose>         </if>         </choose>     </macro>     <macro name="issued-sort">         <choose>         <if type="article-journal bill book chapter graphic legal_case legislation motion_picture paper-conference report song" match="none">             <date variable="issued">             <date-part name="year"/>             <date-part name="month"/>             <date-part name="day"/>             </date>         </if>         <else>             <date variable="issued">             <date-part name="year"/>             </date>         </else>         </choose>     </macro>     <macro name="issued-year">         <choose>         <if variable="issued">             <date variable="issued">             <date-part name="year"/>             </date>             <text variable="year-suffix"/>         </if>         <else>             <text term="no date" form="short"/>             <text variable="year-suffix" prefix="-"/>         </else>         </choose>     </macro>     <macro name="edition">         <choose>         <if is-numeric="edition">             <group delimiter=" ">             <number variable="edition" form="ordinal"/>             <text term="edition" form="short"/>             </group>         </if>         <else>             <text variable="edition" suffix="."/>         </else>         </choose>     </macro>     <macro name="locators">         <choose>         <if type="article-journal article-magazine" match="any">             <group prefix=", " delimiter=", ">             <group>                 <text variable="volume" font-style="italic"/>                 <text variable="issue" prefix="(" suffix=")"/>             </group>             <text variable="page"/>             </group>         </if>         <else-if type="article-newspaper">             <group delimiter=" " prefix=", ">             <label variable="page" form="short"/>             <text variable="page"/>             </group>         </else-if>         <else-if type="book graphic motion_picture report song chapter paper-conference" match="any">             <group prefix=" (" suffix=")" delimiter=", ">             <text macro="edition"/>             <group>                 <text term="volume" form="short" plural="true" text-case="capitalize-first" suffix=" "/>                 <number variable="number-of-volumes" form="numeric" prefix="1-"/>             </group>             <group>                 <text term="volume" form="short" text-case="capitalize-first" suffix=" "/>                 <number variable="volume" form="numeric"/>             </group>             <group>                 <label variable="page" form="short" suffix=" "/>                 <text variable="page"/>             </group>             </group>         </else-if>         <else-if type="legal_case">             <group prefix=" (" suffix=")" delimiter=" ">             <text variable="authority"/>             <date variable="issued" form="text"/>             </group>         </else-if>         <else-if type="bill legislation" match="any">             <date variable="issued" prefix=" (" suffix=")">             <date-part name="year"/>             </date>         </else-if>         </choose>     </macro>     <macro name="citation-locator">         <group>         <choose>             <if locator="chapter">             <label variable="locator" form="long" text-case="capitalize-first"/>             </if>             <else>             <label variable="locator" form="short"/>             </else>         </choose>         <text variable="locator" prefix=" "/>         </group>     </macro>     <macro name="container">         <choose>         <if type="post-weblog webpage" match="none">             <group>             <choose>                 <if type="chapter paper-conference entry-encyclopedia" match="any">                 <text term="in" text-case="capitalize-first" suffix=" "/>                 </if>             </choose>             <text macro="container-contributors"/>             <text macro="secondary-contributors"/>             <text macro="container-title"/>             </group>         </if>         </choose>     </macro>     <macro name="container-title">         <choose>         <if type="article article-journal article-magazine article-newspaper" match="any">             <text variable="container-title" font-style="italic" text-case="title"/>         </if>         <else-if type="bill legal_case legislation" match="none">             <text variable="container-title" font-style="italic"/>         </else-if>         </choose>     </macro>     <macro name="legal-cites">         <choose>         <if type="bill legal_case legislation" match="any">             <group delimiter=" " prefix=", ">             <choose>                 <if variable="container-title">                 <text variable="volume"/>                 <text variable="container-title"/>                 <group delimiter=" ">                     <!--change to label variable="section" as that becomes available -->                     <text term="section" form="symbol"/>                     <text variable="section"/>                 </group>                 <text variable="page"/>                 </if>                 <else>                 <choose>                     <if type="legal_case">                     <text variable="number" prefix="No. "/>                     </if>                     <else>                     <text variable="number" prefix="Pub. L. No. "/>                     <group delimiter=" ">                         <!--change to label variable="section" as that becomes available -->                         <text term="section" form="symbol"/>                         <text variable="section"/>                     </group>                     </else>                 </choose>                 </else>             </choose>             </group>         </if>         </choose>     </macro>     <citation et-al-min="6" et-al-use-first="1" et-al-subsequent-min="3" et-al-subsequent-use-first="1" disambiguate-add-year-suffix="true" disambiguate-add-names="true" disambiguate-add-givenname="true" collapse="year" givenname-disambiguation-rule="primary-name">         <sort>         <key macro="author"/>         <key macro="issued-sort"/>         </sort>         <layout prefix="(" suffix=")" delimiter="; ">         <group delimiter=", ">             <text macro="author-short"/>             <text macro="issued-year"/>             <text macro="citation-locator"/>         </group>         </layout>     </citation>     <bibliography hanging-indent="true" et-al-min="8" et-al-use-first="6" et-al-use-last="true" entry-spacing="0" line-spacing="2">         <sort>         <key macro="author"/>         <key macro="issued-sort" sort="ascending"/>         <key macro="title"/>         </sort>         <layout>         <group suffix=".">             <group delimiter=". ">             <text macro="author"/>             <text macro="issued"/>             <text macro="title-plus-extra"/>             <text macro="container"/>             </group>             <text macro="legal-cites"/>             <text macro="locators"/>             <group delimiter=", " prefix=". ">             <text macro="event"/>             <text macro="publisher"/>             </group>         </group>         <text macro="access" prefix=" "/>         </layout>     </bibliography>     </style>     ',localsUsEn:'<?xml version="1.0" encoding="utf-8"?>     <locale xmlns="http://purl.org/net/xbiblio/csl" version="1.0" xml:lang="en-US">     <info>         <rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights>         <updated>2012-07-04T23:31:02+00:00</updated>     </info>     <style-options punctuation-in-quote="true"                     leading-noise-words="a,an,the"                     name-as-sort-order="ja zh kr my hu vi"                     name-never-short="ja zh kr my hu vi"/>     <date form="text">         <date-part name="month" suffix=" "/>         <date-part name="day" suffix=", "/>         <date-part name="year"/>     </date>     <date form="numeric">         <date-part name="month" form="numeric-leading-zeros" suffix="/"/>         <date-part name="day" form="numeric-leading-zeros" suffix="/"/>         <date-part name="year"/>     </date>     <terms>         <term name="radio-broadcast">radio broadcast</term>         <term name="television-broadcast">television broadcast</term>         <term name="podcast">podcast</term>         <term name="instant-message">instant message</term>         <term name="email">email</term>         <term name="number-of-volumes">         <single>volume</single>         <multiple>volumes</multiple>         </term>         <term name="accessed">accessed</term>         <term name="and">and</term>         <term name="and" form="symbol">&amp;</term>         <term name="and others">and others</term>         <term name="anonymous">anonymous</term>         <term name="anonymous" form="short">anon.</term>         <term name="at">at</term>         <term name="available at">available at</term>         <term name="by">by</term>         <term name="circa">circa</term>         <term name="circa" form="short">c.</term>         <term name="cited">cited</term>         <term name="edition">         <single>edition</single>         <multiple>editions</multiple>         </term>         <term name="edition" form="short">ed.</term>         <term name="et-al">et al.</term>         <term name="forthcoming">forthcoming</term>         <term name="from">from</term>         <term name="ibid">ibid.</term>         <term name="in">in</term>         <term name="in press">in press</term>         <term name="internet">internet</term>         <term name="interview">interview</term>         <term name="letter">letter</term>         <term name="no date">no date</term>         <term name="no date" form="short">n.d.</term>         <term name="online">online</term>         <term name="presented at">presented at the</term>         <term name="reference">         <single>reference</single>         <multiple>references</multiple>         </term>         <term name="reference" form="short">         <single>ref.</single>         <multiple>refs.</multiple>         </term>         <term name="retrieved">retrieved</term>         <term name="scale">scale</term>         <term name="version">version</term>             <!-- ANNO DOMINI; BEFORE CHRIST -->         <term name="ad">AD</term>         <term name="bc">BC</term>             <!-- PUNCTUATION -->         <term name="open-quote">“</term>         <term name="close-quote">”</term>         <term name="open-inner-quote">‘</term>         <term name="close-inner-quote">’</term>         <term name="page-range-delimiter">–</term>             <!-- ORDINALS -->         <term name="ordinal">th</term>         <term name="ordinal-01">st</term>         <term name="ordinal-02">nd</term>         <term name="ordinal-03">rd</term>         <term name="ordinal-11">th</term>         <term name="ordinal-12">th</term>         <term name="ordinal-13">th</term>             <!-- LONG ORDINALS -->         <term name="long-ordinal-01">first</term>         <term name="long-ordinal-02">second</term>         <term name="long-ordinal-03">third</term>         <term name="long-ordinal-04">fourth</term>         <term name="long-ordinal-05">fifth</term>         <term name="long-ordinal-06">sixth</term>         <term name="long-ordinal-07">seventh</term>         <term name="long-ordinal-08">eighth</term>         <term name="long-ordinal-09">ninth</term>         <term name="long-ordinal-10">tenth</term>             <!-- LONG LOCATOR FORMS -->         <term name="book">         <single>book</single>         <multiple>books</multiple>         </term>         <term name="chapter">         <single>chapter</single>         <multiple>chapters</multiple>         </term>         <term name="column">         <single>column</single>         <multiple>columns</multiple>         </term>         <term name="figure">         <single>figure</single>         <multiple>figures</multiple>         </term>         <term name="folio">         <single>folio</single>         <multiple>folios</multiple>         </term>         <term name="issue">         <single>number</single>         <multiple>numbers</multiple>         </term>         <term name="line">         <single>line</single>         <multiple>lines</multiple>         </term>         <term name="note">         <single>note</single>         <multiple>notes</multiple>         </term>         <term name="opus">         <single>opus</single>         <multiple>opera</multiple>         </term>         <term name="page">         <single>page</single>         <multiple>pages</multiple>         </term>         <term name="paragraph">         <single>paragraph</single>         <multiple>paragraph</multiple>         </term>         <term name="part">         <single>part</single>         <multiple>parts</multiple>         </term>         <term name="section">         <single>section</single>         <multiple>sections</multiple>         </term>         <term name="sub verbo">         <single>sub verbo</single>         <multiple>sub verbis</multiple>         </term>         <term name="verse">         <single>verse</single>         <multiple>verses</multiple>         </term>         <term name="volume">         <single>volume</single>         <multiple>volumes</multiple>         </term>             <!-- SHORT LOCATOR FORMS -->         <term name="book" form="short">bk.</term>         <term name="chapter" form="short">chap.</term>         <term name="column" form="short">col.</term>         <term name="figure" form="short">fig.</term>         <term name="folio" form="short">f.</term>         <term name="issue" form="short">no.</term>         <term name="line" form="short">l.</term>         <term name="note" form="short">n.</term>         <term name="opus" form="short">op.</term>         <term name="page" form="short">         <single>p.</single>         <multiple>pp.</multiple>         </term>         <term name="paragraph" form="short">para.</term>         <term name="part" form="short">pt.</term>         <term name="section" form="short">sec.</term>         <term name="sub verbo" form="short">         <single>s.v.</single>         <multiple>s.vv.</multiple>         </term>         <term name="verse" form="short">         <single>v.</single>         <multiple>vv.</multiple>         </term>         <term name="volume" form="short">         <single>vol.</single>         <multiple>vols.</multiple>         </term>             <!-- SYMBOL LOCATOR FORMS -->         <term name="paragraph" form="symbol">         <single>¶</single>         <multiple>¶¶</multiple>         </term>         <term name="section" form="symbol">         <single>§</single>         <multiple>§§</multiple>         </term>             <!-- LONG ROLE FORMS -->         <term name="director">         <single>director</single>         <multiple>directors</multiple>         </term>         <term name="editor">         <single>editor</single>         <multiple>editors</multiple>         </term>         <term name="editorial-director">         <single>editor</single>         <multiple>editors</multiple>         </term>         <term name="illustrator">         <single>illustrator</single>         <multiple>illustrators</multiple>         </term>         <term name="translator">         <single>translator</single>         <multiple>translators</multiple>         </term>         <term name="editortranslator">         <single>editor &amp; translator</single>         <multiple>editors &amp; translators</multiple>         </term>             <!-- SHORT ROLE FORMS -->         <term name="director" form="short">         <single>dir.</single>         <multiple>dirs.</multiple>         </term>         <term name="editor" form="short">         <single>ed.</single>         <multiple>eds.</multiple>         </term>         <term name="editorial-director" form="short">         <single>ed.</single>         <multiple>eds.</multiple>         </term>         <term name="illustrator" form="short">         <single>ill.</single>         <multiple>ills.</multiple>         </term>         <term name="translator" form="short">         <single>tran.</single>         <multiple>trans.</multiple>         </term>         <term name="editortranslator" form="short">         <single>ed. &amp; tran.</single>         <multiple>eds. &amp; trans.</multiple>         </term>             <!-- VERB ROLE FORMS -->         <term name="director" form="verb">directed by</term>         <term name="editor" form="verb">edited by</term>         <term name="editorial-director" form="verb">edited by</term>         <term name="illustrator" form="verb">illustrated by</term>         <term name="interviewer" form="verb">interview by</term>         <term name="recipient" form="verb">to</term>         <term name="reviewed-author" form="verb">by</term>         <term name="translator" form="verb">translated by</term>         <term name="editortranslator" form="verb">edited &amp; translated by</term>             <!-- SHORT VERB ROLE FORMS -->         <term name="container-author" form="verb-short">by</term>         <term name="director" form="verb-short">dir.</term>         <term name="editor" form="verb-short">ed.</term>         <term name="editorial-director" form="verb-short">ed.</term>         <term name="illustrator" form="verb-short">illus.</term>         <term name="translator" form="verb-short">trans.</term>         <term name="editortranslator" form="verb-short">ed. &amp; trans.</term>             <!-- LONG MONTH FORMS -->         <term name="month-01">January</term>         <term name="month-02">February</term>         <term name="month-03">March</term>         <term name="month-04">April</term>         <term name="month-05">May</term>         <term name="month-06">June</term>         <term name="month-07">July</term>         <term name="month-08">August</term>         <term name="month-09">September</term>         <term name="month-10">October</term>         <term name="month-11">November</term>         <term name="month-12">December</term>             <!-- SHORT MONTH FORMS -->         <term name="month-01" form="short">Jan.</term>         <term name="month-02" form="short">Feb.</term>         <term name="month-03" form="short">Mar.</term>         <term name="month-04" form="short">Apr.</term>         <term name="month-05" form="short">May</term>         <term name="month-06" form="short">Jun.</term>         <term name="month-07" form="short">Jul.</term>         <term name="month-08" form="short">Aug.</term>         <term name="month-09" form="short">Sep.</term>         <term name="month-10" form="short">Oct.</term>         <term name="month-11" form="short">Nov.</term>         <term name="month-12" form="short">Dec.</term>             <!-- SEASONS -->         <term name="season-01">Spring</term>         <term name="season-02">Summer</term>         <term name="season-03">Autumn</term>         <term name="season-04">Winter</term>     </terms>     </locale>     '
},h=function(a,b,d){"undefined"==typeof b&&(b=g.localsUsEn),"undefined"==typeof d&&(d=g.style);var a=a,e={context:this,retrieveLocale:function(a){return b},retrieveItem:function(b){return a[b]}},f=function(a){return a.replace(/^\<[^\>]*\>/,"").replace(/\<\/[^\>]*\>$/,"")},h=function(a){var b=new c.Engine(e,d);if(null!=b){var g=[];for(var h in a)g.push(h);b.updateItems(g);var j=b.makeBibliography();for(i=0;i<j[1].length;i++)j[1][i]=f(j[1][i].trim());return j[1]}throw new Error("Couldn't get CSL Processor. Style or locale parameters might be falsely")};return h(a)};return h});